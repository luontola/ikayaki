<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Squid: My Documents/squid/src/ikayaki/squid/Magnetometer.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">My Documents</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">squid</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ikayaki</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">squid</a></div>
<h1>Magnetometer.java</h1><a href="_magnetometer_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Magnetometer.java</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (C) 2005 Project SQUID, http://www.cs.helsinki.fi/group/squid/</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This file is part of Ikayaki.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * Ikayaki is free software; you can redistribute it and/or modify</span>
00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00011 <span class="comment"> * (at your option) any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Ikayaki is distributed in the hope that it will be useful,</span>
00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
00016 <span class="comment"> * GNU General Public License for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> * along with Ikayaki; if not, write to the Free Software</span>
00020 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="keyword">package </span>ikayaki.squid;
00024 
00025 <span class="keyword">import</span> ikayaki.Settings;
00026 
00027 <span class="keyword">import</span> java.util.Stack;
00028 <span class="keyword">import</span> java.util.concurrent.SynchronousQueue;
00029 <span class="keyword">import</span> java.util.concurrent.TimeUnit;
00030 
<a name="l00036"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html">00036</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html">Magnetometer</a> <span class="keyword">implements</span> <a class="code" href="interfaceikayaki_1_1squid_1_1_serial_i_o_listener.html">SerialIOListener</a> {
00037 
<a name="l00041"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r0">00041</a>     <span class="keyword">private</span> Stack&lt;String&gt; <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r0">messageBuffer</a>;
00042 
<a name="l00046"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r1">00046</a>     <span class="keyword">private</span> SynchronousQueue&lt;String&gt; <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r1">queue</a>;
<a name="l00047"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r2">00047</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r2">pollTimeout</a> = 60;
00048 
<a name="l00052"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">00052</a>     <span class="keyword">protected</span> <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html">SerialIO</a> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>;
00053 
<a name="l00054"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r3">00054</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r3">waitingForMessage</a> = <span class="keyword">false</span>;
00055 
<a name="l00056"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r4">00056</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r4">measuring</a> = <span class="keyword">false</span>;
00057 
00058 
<a name="l00065"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a0">00065</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a0">Magnetometer</a>() throws <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> {
00066         <span class="keyword">this</span>.serialIO = <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html">SerialIO</a>.openPort(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1squid_1_1_serial_parameters.html">SerialParameters</a>(<a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getMagnetometerPort(), 1200, 0, 0, 8, 1, 0));
00067         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a3">addSerialIOListener</a>(<span class="keyword">this</span>);
00068         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r0">messageBuffer</a> = <span class="keyword">new</span> Stack&lt;String&gt;();
00069         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r1">queue</a> = <span class="keyword">new</span> SynchronousQueue&lt;String&gt;();
00070         <span class="keywordflow">try</span> {
00071             <span class="comment">//Original sets range and filter to 1x and disable fast-slew, TODO: check if right, do we need status confirm?</span>
00072             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"XCR1\r"</span>);
00073             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"XCF1\r"</span>);
00074             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"XCSE\r"</span>);
00075             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"YCR1\r"</span>);
00076             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"YCF1\r"</span>);
00077             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"YCSE\r"</span>);
00078             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"ZCR1\r"</span>);
00079             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"ZCF1\r"</span>);
00080             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(<span class="stringliteral">"ZCSE\r"</span>);
00081             <span class="comment">//and original resets all</span>
00082             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">configure</a>(<span class="charliteral">'A'</span>, <span class="charliteral">'L'</span>, <span class="charliteral">'P'</span>);
00083             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">configure</a>(<span class="charliteral">'A'</span>, <span class="charliteral">'L'</span>, <span class="charliteral">'C'</span>);
00084             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b1">resetCounter</a>(<span class="charliteral">'A'</span>);
00085 
00086         } <span class="keywordflow">catch</span> (SerialIOException e) {
00087             System.err.println(<span class="stringliteral">"Error using port in degausser:"</span>);
00088             e.printStackTrace();
00089         }
00090     }
00091 
<a name="l00096"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a1">00096</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a1">updateSettings</a>() {
00097         <span class="comment">//no settings for this.. really. Only COM port.</span>
00098     }
00099 
<a name="l00105"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b0">00105</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b0">reset</a>(<span class="keywordtype">char</span> axis) {
00106         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span> &amp;&amp; axis != <span class="charliteral">'A'</span>) {
00107             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00108         }
00109         <span class="keywordflow">try</span> {
00110             <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"R\r"</span>);
00111         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00112             e.printStackTrace();
00113         }
00114     }
00115 
<a name="l00121"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b1">00121</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b1">resetCounter</a>(<span class="keywordtype">char</span> axis) {
00122         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span> &amp;&amp; axis != <span class="charliteral">'A'</span>) {
00123             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00124         }
00125         <span class="keywordflow">try</span> {
00126             <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"RC\r"</span>);
00127         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex) {
00128             System.err.println(ex);
00129         }
00130     }
00131 
<a name="l00149"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">00149</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">configure</a>(<span class="keywordtype">char</span> axis, <span class="keywordtype">char</span> subcommand, <span class="keywordtype">char</span> option) {
00150         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span> &amp;&amp; axis != <span class="charliteral">'A'</span>) {
00151             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00152         }
00153         <span class="keywordflow">try</span> {
00154             <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"C"</span> + subcommand + option + <span class="stringliteral">"\r"</span>);
00155         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex) {
00156             System.err.println(ex);
00157         }
00158     }
00159 
<a name="l00163"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b3">00163</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b3">latchAnalog</a>(<span class="keywordtype">char</span> axis) {
00164         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span> &amp;&amp; axis != <span class="charliteral">'A'</span>) {
00165             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00166         }
00167         <span class="keywordflow">try</span> {
00168             <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"LD\r"</span>);
00169         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00170             e.printStackTrace();
00171         }
00172     }
00173 
<a name="l00177"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b4">00177</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b4">latchCounter</a>(<span class="keywordtype">char</span> axis) {
00178         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span> &amp;&amp; axis != <span class="charliteral">'A'</span>) {
00179             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00180         }
00181         <span class="keywordflow">try</span> {
00182             <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"LC\r"</span>);
00183         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00184             e.printStackTrace();
00185         }
00186     }
00187 
<a name="l00201"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">00201</a>     <span class="keyword">protected</span> String <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="keywordtype">char</span> axis, <span class="keywordtype">char</span> command, String datavalues) {
00202         <span class="keywordflow">if</span> (axis != <span class="charliteral">'X'</span> &amp;&amp; axis != <span class="charliteral">'Y'</span> &amp;&amp; axis != <span class="charliteral">'Z'</span>) {
00203             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"axis = "</span> + axis);
00204         }
00205         <span class="keywordflow">if</span> (command == <span class="charliteral">'D'</span> || command == <span class="charliteral">'C'</span>) {
00206             <span class="keywordflow">try</span> {
00207                 <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"S"</span> + command + <span class="stringliteral">"\r"</span>);
00208             } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex) {
00209                 System.err.println(ex);
00210                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00211             }
00212         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == <span class="charliteral">'S'</span>) {
00213             <span class="keywordflow">try</span> {
00214                 <span class="keyword">this</span>.serialIO.writeMessage(axis + <span class="stringliteral">"S"</span> + command + datavalues + <span class="stringliteral">"\r"</span>);
00215             } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex) {
00216                 System.err.println(ex);
00217                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00218             }
00219         } <span class="keywordflow">else</span> {
00220             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"command = "</span> + command);
00221         }
00222         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r3">waitingForMessage</a> = <span class="keyword">true</span>;
00223         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00224         <span class="keywordflow">try</span> {
00225             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00226         } <span class="keywordflow">catch</span> (InterruptedException e) {
00227             e.printStackTrace();
00228         }
00229         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r3">waitingForMessage</a> = <span class="keyword">false</span>;
00230         <span class="keywordflow">return</span> answer;
00231     }
00232 
<a name="l00238"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a2">00238</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a2">pulseReset</a>(<span class="keywordtype">char</span> axis) {
00239         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">configure</a>(axis, <span class="charliteral">'L'</span>, <span class="charliteral">'P'</span>);
00240         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b2">configure</a>(axis, <span class="charliteral">'L'</span>, <span class="charliteral">'C'</span>);
00241     }
00242 
<a name="l00248"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a3">00248</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a3">clearFlux</a>(<span class="keywordtype">char</span> axis) {
00249         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b1">resetCounter</a>(axis);
00250     }
00251 
<a name="l00257"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a4">00257</a>     <span class="keyword">public</span> <span class="keywordtype">double</span>[] <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a4">readData</a>() {
00258 
00259         <span class="comment">// wait for magnetometer to settle down</span>
00260         <span class="keywordflow">try</span> {
00261             Thread.sleep(1000);
00262         } <span class="keywordflow">catch</span> (InterruptedException e) {
00263             e.printStackTrace();
00264         }
00265 
00266         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r4">measuring</a> = <span class="keyword">true</span>;
00267         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b4">latchCounter</a>(<span class="charliteral">'A'</span>);
00268 
00269         <span class="comment">//read all latched counter values</span>
00270         <span class="keywordtype">double</span> counterX = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'X'</span>, <span class="charliteral">'C'</span>, <span class="stringliteral">""</span>));
00271         <span class="keywordtype">double</span> counterY = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Y'</span>, <span class="charliteral">'C'</span>, <span class="stringliteral">""</span>));
00272         <span class="keywordtype">double</span> counterZ = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Z'</span>, <span class="charliteral">'C'</span>, <span class="stringliteral">""</span>));
00273 
00274         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b3">latchAnalog</a>(<span class="charliteral">'A'</span>);
00275 
00276         <span class="comment">//Maybe need to read many times and take mean value.</span>
00277         <span class="comment">//But we do it only ones (default for old software)</span>
00278         <span class="comment">//read all latched analog values</span>
00279         <span class="keywordtype">double</span> analogX = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'X'</span>, <span class="charliteral">'D'</span>, <span class="stringliteral">""</span>));
00280         <span class="keywordtype">double</span> analogY = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Y'</span>, <span class="charliteral">'D'</span>, <span class="stringliteral">""</span>));
00281         <span class="keywordtype">double</span> analogZ = Double.parseDouble(<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Z'</span>, <span class="charliteral">'D'</span>, <span class="stringliteral">""</span>));
00282 
00283         <span class="keywordtype">double</span>[] result = <span class="keyword">new</span> <span class="keywordtype">double</span>[3];
00284 
00285         <span class="comment">//when to use flux counting and when not? TODO</span>
00286         result[0] = (counterX + analogX) * <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getMagnetometerXAxisCalibration();
00287         result[1] = (counterY + analogY) * <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getMagnetometerYAxisCalibration();
00288         result[2] = (counterZ + analogZ) * <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getMagnetometerZAxisCalibration();
00289 
00290         <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r4">measuring</a> = <span class="keyword">false</span>;
00291         <span class="keywordflow">return</span> result;
00292     }
00293 
<a name="l00294"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a5">00294</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a5">isMeasuring</a>() {
00295         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r4">measuring</a>;
00296     }
00297 
<a name="l00304"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a6">00304</a>     <span class="keyword">public</span> <span class="keywordtype">char</span>[] <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a6">getFilters</a>() {
00305         <span class="keywordtype">char</span>[] <a class="code" href="namespaceikayaki_1_1gui.html#a26a4">data</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[3];
00306 
00307         String answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'X'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"F"</span>);
00308         data[0] = answer.charAt(1);
00309 
00310         answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Y'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"F"</span>);
00311         data[1] = answer.charAt(1);
00312 
00313         answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Z'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"F"</span>);
00314         data[2] = answer.charAt(1);
00315 
00316         <span class="keywordflow">return</span> data;
00317     }
00318 
<a name="l00325"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a7">00325</a>     <span class="keyword">public</span> <span class="keywordtype">char</span>[] <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a7">getRange</a>() {
00326         <span class="keywordtype">char</span>[] <a class="code" href="namespaceikayaki_1_1gui.html#a26a4">data</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[3];
00327 
00328         String answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'X'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"R"</span>);
00329         data[0] = answer.charAt(1);
00330 
00331         answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Y'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"R"</span>);
00332         data[1] = answer.charAt(1);
00333 
00334         answer = <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#b5">getData</a>(<span class="charliteral">'Z'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"R"</span>);
00335         data[2] = answer.charAt(1);
00336 
00337         <span class="keywordflow">return</span> data;
00338 
00339     }
00340 
<a name="l00346"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a8">00346</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span>[] <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a8">getSlew</a>() {
00347         <span class="keywordtype">boolean</span>[] <a class="code" href="namespaceikayaki_1_1gui.html#a26a4">data</a> = <span class="keyword">new</span> <span class="keywordtype">boolean</span>[3];
00348 
00349         String answer = <span class="keyword">this</span>.getData(<span class="charliteral">'X'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"S"</span>);
00350         data[0] = (!answer.equals(<span class="stringliteral">"SD"</span>));
00351 
00352         answer = <span class="keyword">this</span>.getData(<span class="charliteral">'Y'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"S"</span>);
00353         data[1] = (!answer.equals(<span class="stringliteral">"SD"</span>));
00354 
00355         answer = <span class="keyword">this</span>.getData(<span class="charliteral">'Z'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"S"</span>);
00356         data[2] = (!answer.equals(<span class="stringliteral">"SD"</span>));
00357 
00358         <span class="keywordflow">return</span> data;
00359     }
00360 
<a name="l00366"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a9">00366</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span>[] <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a9">getLoop</a>() {
00367         <span class="keywordtype">boolean</span>[] <a class="code" href="namespaceikayaki_1_1gui.html#a26a4">data</a> = <span class="keyword">new</span> <span class="keywordtype">boolean</span>[3];
00368 
00369         String answer = <span class="keyword">this</span>.getData(<span class="charliteral">'X'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"L"</span>);
00370         data[0] = (answer.equals(<span class="stringliteral">"LO"</span>));
00371 
00372         answer = <span class="keyword">this</span>.getData(<span class="charliteral">'Y'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"L"</span>);
00373         data[1] = (answer.equals(<span class="stringliteral">"LO"</span>));
00374 
00375         answer = <span class="keyword">this</span>.getData(<span class="charliteral">'Z'</span>, <span class="charliteral">'S'</span>, <span class="stringliteral">"L"</span>);
00376         data[2] = (answer.equals(<span class="stringliteral">"LO"</span>));
00377 
00378         <span class="keywordflow">return</span> data;
00379     }
00380 
<a name="l00386"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a10">00386</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a10">isOK</a>() {
00387         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#p0">serialIO</a> != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00388             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00389         }
00390         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00391     }
00392 
<a name="l00393"></a><a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a11">00393</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#a11">serialIOEvent</a>(<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_event.html">SerialIOEvent</a> event) {
00394         <span class="comment">//TODO: problem when Degausser and Magnetometer uses same port :/</span>
00395         String message = event.getCleanMessage();
00396         <span class="keywordflow">if</span> (message != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00397             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r3">waitingForMessage</a>) {
00398                 <span class="keywordflow">try</span> {
00399                     <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r1">queue</a>.put(message);
00400                 } <span class="keywordflow">catch</span> (InterruptedException e) {
00401                     System.err.println(<span class="stringliteral">"Interrupted Magnetometer message event"</span>);
00402                 } <span class="keywordflow">catch</span> (NullPointerException e) {
00403                     System.err.println(<span class="stringliteral">"Null from SerialEvent in Magnetometer"</span>);
00404                 }
00405             }
00406             <a class="code" href="classikayaki_1_1squid_1_1_magnetometer.html#r0">messageBuffer</a>.add(message);
00407         }
00408     }
00409 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed May 4 13:11:05 2005 for Squid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
