<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Squid: My Documents/squid/src/ikayaki/Project.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">My Documents</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">squid</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ikayaki</a></div>
<h1>Project.java</h1><a href="_project_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Project.java</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (C) 2005 Project SQUID, http://www.cs.helsinki.fi/group/squid/</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This file is part of Ikayaki.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * Ikayaki is free software; you can redistribute it and/or modify</span>
00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00011 <span class="comment"> * (at your option) any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Ikayaki is distributed in the hope that it will be useful,</span>
00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
00016 <span class="comment"> * GNU General Public License for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> * along with Ikayaki; if not, write to the Free Software</span>
00020 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="keyword">package </span>ikayaki;
00024 
00025 <span class="keyword">import</span> ikayaki.squid.Squid;
00026 <span class="keyword">import</span> ikayaki.util.DocumentUtilities;
00027 <span class="keyword">import</span> ikayaki.util.LastExecutor;
00028 <span class="keyword">import</span> org.w3c.dom.Document;
00029 <span class="keyword">import</span> org.w3c.dom.Element;
00030 <span class="keyword">import</span> org.w3c.dom.NodeList;
00031 
00032 <span class="keyword">import</span> javax.swing.*;
00033 <span class="keyword">import</span> javax.swing.event.EventListenerList;
00034 <span class="keyword">import</span> javax.vecmath.Matrix3d;
00035 <span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;
00036 <span class="keyword">import</span> javax.xml.parsers.ParserConfigurationException;
00037 <span class="keyword">import</span> java.io.*;
00038 <span class="keyword">import</span> java.text.DecimalFormat;
00039 <span class="keyword">import</span> java.text.DecimalFormatSymbols;
00040 <span class="keyword">import</span> java.text.FieldPosition;
00041 <span class="keyword">import</span> java.util.*;
00042 
00043 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.MeasurementStep.State.READY;
00044 <span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.sin;
00045 <span class="keyword">import</span> <span class="keyword">static</span> java.lang.Math.cos;
00046 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.MeasurementEvent.Type.*;
00047 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.MeasurementResult.Type.*;
00048 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.Project.Normalization.*;
00049 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.Project.Orientation.*;
00050 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.Project.State.*;
00051 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.Project.SampleType.*;
00052 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.Project.Type.*;
00053 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.ProjectEvent.Type.*;
00054 
<a name="l00066"></a><a class="code" href="classikayaki_1_1_project.html">00066</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project.html">Project</a> {
00067 
<a name="l00068"></a><a class="code" href="classikayaki_1_1_project.html#v0">00068</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#v0">DEBUG</a> = <span class="keyword">false</span>;      <span class="comment">// TODO: used for testing the measurements without a Squid</span>
00069 
00070     <span class="comment">/* Property names for saving values to Project */</span>
<a name="l00071"></a><a class="code" href="classikayaki_1_1_project.html#s0">00071</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s0">MEASUREMENT_TYPE_PROPERTY</a> = <span class="stringliteral">"measurementType"</span>;
<a name="l00072"></a><a class="code" href="classikayaki_1_1_project.html#s1">00072</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s1">MEASUREMENT_TYPE_AUTO_VALUE</a> = <span class="stringliteral">"AUTO"</span>;
<a name="l00073"></a><a class="code" href="classikayaki_1_1_project.html#s2">00073</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s2">MEASUREMENT_TYPE_MANUAL_VALUE</a> = <span class="stringliteral">"MANUAL"</span>;
<a name="l00074"></a><a class="code" href="classikayaki_1_1_project.html#s3">00074</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s3">OPERATOR_PROPERTY</a> = <span class="stringliteral">"operator"</span>;
<a name="l00075"></a><a class="code" href="classikayaki_1_1_project.html#s4">00075</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s4">DATE_PROPERTY</a> = <span class="stringliteral">"date"</span>;
<a name="l00076"></a><a class="code" href="classikayaki_1_1_project.html#s5">00076</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s5">ROCK_TYPE_PROPERTY</a> = <span class="stringliteral">"rockType"</span>;
<a name="l00077"></a><a class="code" href="classikayaki_1_1_project.html#s6">00077</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s6">AREA_PROPERTY</a> = <span class="stringliteral">"area"</span>;
<a name="l00078"></a><a class="code" href="classikayaki_1_1_project.html#s7">00078</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s7">SITE_PROPERTY</a> = <span class="stringliteral">"site"</span>;
<a name="l00079"></a><a class="code" href="classikayaki_1_1_project.html#s8">00079</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s8">COMMENT_PROPERTY</a> = <span class="stringliteral">"comment"</span>;
<a name="l00080"></a><a class="code" href="classikayaki_1_1_project.html#s9">00080</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s9">LATITUDE_PROPERTY</a> = <span class="stringliteral">"latitude"</span>;
<a name="l00081"></a><a class="code" href="classikayaki_1_1_project.html#s10">00081</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classikayaki_1_1_project.html#s10">LONGITUDE_PROPERTY</a> = <span class="stringliteral">"longitude"</span>;
00082 
<a name="l00087"></a><a class="code" href="classikayaki_1_1_project.html#v1">00087</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Hashtable&lt;File, Project&gt; <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a> = <span class="keyword">new</span> Hashtable&lt;File, Project&gt;();
00088 
<a name="l00093"></a><a class="code" href="classikayaki_1_1_project.html#v2">00093</a>     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Hashtable&lt;File, Object&gt; <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a> = <span class="keyword">new</span> Hashtable&lt;File, Object&gt;();
00094 
<a name="l00098"></a><a class="code" href="classikayaki_1_1_project.html#r0">00098</a>     <span class="keyword">private</span> <span class="keyword">final</span> File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>;
<a name="l00102"></a><a class="code" href="classikayaki_1_1_project.html#r1">00102</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#r1">type</a>;
00103 
<a name="l00108"></a><a class="code" href="classikayaki_1_1_project.html#r2">00108</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#w6">State</a> <a class="code" href="classikayaki_1_1_project.html#r2">state</a> = <a class="code" href="classikayaki_1_1_project.html#w6w1">IDLE</a>;
00109 
<a name="l00113"></a><a class="code" href="classikayaki_1_1_project.html#r3">00113</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#r3">closed</a> = <span class="keyword">false</span>;
00114 
<a name="l00118"></a><a class="code" href="classikayaki_1_1_project.html#r4">00118</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1squid_1_1_squid.html">Squid</a> <a class="code" href="classikayaki_1_1_project.html#r4">squid</a> = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00119 
<a name="l00124"></a><a class="code" href="classikayaki_1_1_project.html#r5">00124</a>     <span class="keyword">private</span> <span class="keyword">final</span> Properties <a class="code" href="classikayaki_1_1_project.html#r5">properties</a> = <span class="keyword">new</span> Properties();
00125 
<a name="l00130"></a><a class="code" href="classikayaki_1_1_project.html#r6">00130</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a>();   <span class="comment">// this instance will be dumped by the constructor Project(File,Document)</span>
00131 
<a name="l00135"></a><a class="code" href="classikayaki_1_1_project.html#r7">00135</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r7">strike</a> = 0.0;
00136 
<a name="l00140"></a><a class="code" href="classikayaki_1_1_project.html#r8">00140</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r8">dip</a> = 0.0;
00141 
<a name="l00145"></a><a class="code" href="classikayaki_1_1_project.html#r9">00145</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#w7">SampleType</a> <a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a> = <a class="code" href="classikayaki_1_1_project.html#w7">HAND</a>;
00146 
<a name="l00150"></a><a class="code" href="classikayaki_1_1_project.html#r10">00150</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#w8">Orientation</a> <a class="code" href="classikayaki_1_1_project.html#r10">orientation</a> = <a class="code" href="classikayaki_1_1_project.html#w8">MINUS_Z</a>;
00151 
<a name="l00155"></a><a class="code" href="classikayaki_1_1_project.html#r11">00155</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#w9">Normalization</a> <a class="code" href="classikayaki_1_1_project.html#r11">normalization</a> = <a class="code" href="classikayaki_1_1_project.html#w9w4">VOLUME</a>;
00156 
<a name="l00161"></a><a class="code" href="classikayaki_1_1_project.html#r12">00161</a>     <span class="keyword">private</span> Matrix3d <a class="code" href="classikayaki_1_1_project.html#r12">transform</a> = <span class="keyword">new</span> Matrix3d();
00162 
<a name="l00166"></a><a class="code" href="classikayaki_1_1_project.html#r13">00166</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r13">mass</a> = -1.0;
00167 
<a name="l00171"></a><a class="code" href="classikayaki_1_1_project.html#r14">00171</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r14">volume</a> = -1.0;
00172 
<a name="l00176"></a><a class="code" href="classikayaki_1_1_project.html#r15">00176</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r15">susceptibility</a> = -1.0;
00177 
<a name="l00181"></a><a class="code" href="classikayaki_1_1_project.html#r16">00181</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> <a class="code" href="classikayaki_1_1_project.html#r16">currentStep</a> = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00182 
<a name="l00186"></a><a class="code" href="classikayaki_1_1_project.html#r17">00186</a>     <span class="keyword">private</span> <span class="keyword">final</span> EventListenerList <a class="code" href="classikayaki_1_1_project.html#r17">listenerList</a> = <span class="keyword">new</span> EventListenerList();
00187 
<a name="l00191"></a><a class="code" href="classikayaki_1_1_project.html#r18">00191</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#r18">modified</a> = <span class="keyword">false</span>;
00192 
<a name="l00196"></a><a class="code" href="classikayaki_1_1_project.html#r19">00196</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1util_1_1_last_executor.html">LastExecutor</a> <a class="code" href="classikayaki_1_1_project.html#r19">autosaveQueue</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1util_1_1_last_executor.html">LastExecutor</a>(500, <span class="keyword">true</span>);
00197 
<a name="l00201"></a><a class="code" href="classikayaki_1_1_project.html#r20">00201</a>     <span class="keyword">private</span> Runnable <a class="code" href="classikayaki_1_1_project.html#r20">autosaveRunnable</a> = <span class="keyword">new</span> Runnable() {
00202         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00203             <a class="code" href="classikayaki_1_1_project.html#a3">saveNow</a>();
00204         }
00205     };
00206 
<a name="l00214"></a><a class="code" href="classikayaki_1_1_project.html#e0">00214</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e0">createCalibrationProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00215         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#e4">createProject</a>(file, CALIBRATION);
00216     }
00217 
<a name="l00225"></a><a class="code" href="classikayaki_1_1_project.html#e1">00225</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e1">createAFProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00226         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#e4">createProject</a>(file, <a class="code" href="classikayaki_1_1_project.html#w5">AF</a>);
00227     }
00228 
<a name="l00236"></a><a class="code" href="classikayaki_1_1_project.html#e2">00236</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e2">createThellierProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00237         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#e4">createProject</a>(file, THELLIER);
00238     }
00239 
<a name="l00247"></a><a class="code" href="classikayaki_1_1_project.html#e3">00247</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e3">createThermalProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00248         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#e4">createProject</a>(file, THERMAL);
00249     }
00250 
<a name="l00260"></a><a class="code" href="classikayaki_1_1_project.html#e4">00260</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e4">createProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>, <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#r1">type</a>) {
00261         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || type == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00262             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00263         }
00264 
00265         <span class="comment">// must use only canonical file paths. otherwise the cache could include the same file twise.</span>
00266         <span class="keywordflow">try</span> {
00267             file = file.getCanonicalFile();
00268         } <span class="keywordflow">catch</span> (IOException e) {
00269             e.printStackTrace();
00270             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00271         }
00272 
00273         <span class="comment">// create a new file, do not overwrite an old one</span>
00274         <span class="keywordflow">try</span> {
00275             <span class="keywordflow">if</span> (!file.createNewFile()) {
00276                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00277             }
00278         } <span class="keywordflow">catch</span> (IOException e) {
00279             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00280         }
00281 
00282         <span class="comment">// create project, write to file and add to cache</span>
00283         <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project.html#d0">Project</a>(file, type);
00284         <span class="keywordflow">if</span> (!project.<a class="code" href="classikayaki_1_1_project.html#a3">saveNow</a>()) {
00285             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00286         }
00287         <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a>.put(file, project);
00288         <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a>.put(file, project.<a class="code" href="classikayaki_1_1_project.html#e8">getType</a>());
00289         <span class="keywordflow">return</span> project;
00290     }
00291 
<a name="l00300"></a><a class="code" href="classikayaki_1_1_project.html#e5">00300</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1_project.html#e5">loadProject</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00301         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00302             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00303         }
00304         <span class="keywordflow">if</span> (!file.canRead() || !file.isFile()) {
00305             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00306         }
00307 
00308         <span class="comment">// must use only canonical file paths. otherwise the cache could include the same file twise.</span>
00309         <span class="keywordflow">try</span> {
00310             file = file.getCanonicalFile();
00311         } <span class="keywordflow">catch</span> (IOException e) {
00312             e.printStackTrace();
00313             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00314         }
00315 
00316         <span class="comment">// check cache</span>
00317         <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a> = <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a>.get(file);
00318         <span class="keywordflow">if</span> (project != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00319             <span class="keywordflow">return</span> project;
00320         }
00321 
00322         <span class="comment">// load file and add to cache</span>
00323         <span class="keywordflow">try</span> {
00324             Document document = <a class="code" href="classikayaki_1_1util_1_1_document_utilities.html">DocumentUtilities</a>.loadFromXML(file);
00325             <span class="keywordflow">if</span> (document == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00326                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00327             }
00328             project = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project.html#d0">Project</a>(file, document);
00329             <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a>.put(file, project);
00330             <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a>.put(file, project.<a class="code" href="classikayaki_1_1_project.html#e8">getType</a>());
00331 
00332         } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00333             e.printStackTrace();
00334             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00335         }
00336         <span class="keywordflow">return</span> project;
00337     }
00338 
<a name="l00352"></a><a class="code" href="classikayaki_1_1_project.html#e6">00352</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#e6">closeProject</a>(<a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a>) {
00353         <span class="keywordflow">if</span> (project == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00354             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00355         }
00356 
00357         <span class="keyword">synchronized</span> (project) {
00358             <span class="comment">// save the project to file and remove it from cache</span>
00359             <span class="keywordflow">if</span> (project.isClosed()) {
00360                 <span class="keyword">new</span> Exception(<span class="stringliteral">"closeProject success: the project is already closed!"</span>).printStackTrace();
00361                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00362             }
00363             <span class="keywordflow">if</span> (project.getState() != <a class="code" href="classikayaki_1_1_project.html#w6w1">IDLE</a>) {
00364                 System.err.println(<span class="stringliteral">"closeProject failed: the project's state is "</span> + project.getState());
00365                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00366             }
00367             <span class="keywordflow">if</span> (!project.setSquid(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) || !project.saveNow()) {
00368                 System.err.println(<span class="stringliteral">"closeProject failed: unable to detatch the squid or save the file"</span>);
00369                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00370             }
00371             <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a>.remove(project.getFile());
00372 
00373             <span class="comment">// mark the project as closed</span>
00374             project.closed = <span class="keyword">true</span>;
00375             project.autosaveRunnable = <span class="keyword">new</span> Runnable() {
00376                 <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00377                     assert <span class="keyword">false</span>;
00378                     <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"Tried to save a closed project!"</span>);
00379                 }
00380             };
00381         }
00382         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00383     }
00384 
<a name="l00388"></a><a class="code" href="classikayaki_1_1_project.html#e7">00388</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html">Project</a>[] <a class="code" href="classikayaki_1_1_project.html#e7">getCachedProjects</a>() {
00389         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#v1">projectCache</a>.values().toArray(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project.html">Project</a>[0]);
00390     }
00391 
<a name="l00401"></a><a class="code" href="classikayaki_1_1_project.html#e8">00401</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#a8">getType</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00402         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00403             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00404         }
00405 
00406         <span class="comment">// check the cache</span>
00407         Object <a class="code" href="namespaceikayaki_1_1gui.html#a26a3">value</a> = <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a>.get(file);
00408         <span class="keywordflow">if</span> (value != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00409             <span class="keywordflow">if</span> (value instanceof <a class="code" href="classikayaki_1_1_project.html#w5">Type</a>) {
00410                 <span class="keywordflow">return</span> (Type) value;
00411             } <span class="keywordflow">else</span> {
00412                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00413             }
00414         }
00415         <span class="comment">// NOTE: Should the cache be emptied at some point? I suppose not. In normal use it won't get very big.</span>
00416 
00417         <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#r1">type</a> = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00418         BufferedReader reader = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00419         <span class="keywordflow">try</span> {
00420             reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(file));
00421 
00422             <span class="comment">// check that it is a XML file</span>
00423             String line = reader.readLine();
00424             <span class="keywordflow">if</span> (line == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || line.indexOf(<span class="stringliteral">"&lt;?xml"</span>) &lt; 0) {
00425                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00426             }
00427 
00428             <span class="comment">// the second line of the file should be something like:</span>
00429             <span class="comment">// &lt;project type="TYPE" version="1.0"&gt;</span>
00430             line = reader.readLine();
00431             <span class="keywordflow">if</span> (line == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00432                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00433             }
00434             <span class="keywordtype">int</span> start = line.indexOf(<span class="stringliteral">"&lt;project type=\""</span>);
00435             <span class="keywordflow">if</span> (start &lt; 0) {
00436                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00437             }
00438             start += 15;
00439             <span class="keywordtype">int</span> end = line.indexOf(<span class="stringliteral">"\""</span>, start);
00440             <span class="keywordflow">if</span> (end &lt; 0) {
00441                 <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00442             }
00443             type = <a class="code" href="classikayaki_1_1_project.html#w5">Type</a>.valueOf(line.substring(start, end));
00444         } <span class="keywordflow">catch</span> (FileNotFoundException e) {
00445             e.printStackTrace();
00446         } <span class="keywordflow">catch</span> (IOException e) {
00447             e.printStackTrace();
00448         } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00449             e.printStackTrace();
00450         } finally {
00451 
00452             <span class="comment">// close the file</span>
00453             <span class="keywordflow">if</span> (reader != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00454                 <span class="keywordflow">try</span> {
00455                     reader.close();
00456                 } <span class="keywordflow">catch</span> (IOException e) {
00457                     e.printStackTrace();
00458                 }
00459             }
00460 
00461             <span class="comment">// save the results to cache</span>
00462             <span class="keywordflow">if</span> (type != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00463                 <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a>.put(file, type);
00464             } <span class="keywordflow">else</span> {
00465                 <a class="code" href="classikayaki_1_1_project.html#v2">projectTypeCache</a>.put(file, <span class="keyword">new</span> Object());
00466             }
00467         }
00468         <span class="keywordflow">return</span> type;
00469     }
00470 
<a name="l00480"></a><a class="code" href="classikayaki_1_1_project.html#d0">00480</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#d0">Project</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>, <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#r1">type</a>) {
00481         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || type == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00482             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00483         }
00484         <span class="keyword">this</span>.file = file.getAbsoluteFile();
00485         <span class="keyword">this</span>.type = type;
00486         <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();
00487         <a class="code" href="classikayaki_1_1_project.html#r18">modified</a> = <span class="keyword">true</span>;
00488     }
00489 
<a name="l00500"></a><a class="code" href="classikayaki_1_1_project.html#d1">00500</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1_project.html#d0">Project</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>, Document document) {
00501         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || document == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00502             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00503         }
00504         <span class="keyword">this</span>.file = file.getAbsoluteFile();
00505         String s = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00506 
00507         <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {
00508             <span class="keywordflow">try</span> {
00509 
00510                 <span class="comment">// verify project file's version</span>
00511                 Element root = document.getDocumentElement();
00512                 <span class="keywordflow">if</span> (!root.getTagName().equals(<span class="stringliteral">"project"</span>)) {
00513                     <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid tag name: "</span> + root.getTagName());
00514                 }
00515                 String version = root.getAttribute(<span class="stringliteral">"version"</span>);
00516 
00517                 <span class="keywordflow">if</span> (version.equals(<span class="stringliteral">"1.0"</span>)) {
00518 
00519                     <span class="comment">/* Begin importing version 1.0 */</span>
00520 
00521                     <span class="comment">// get type</span>
00522                     s = root.getAttribute(<span class="stringliteral">"type"</span>);
00523                     <span class="keywordflow">try</span> {
00524                         <a class="code" href="classikayaki_1_1_project.html#r1">type</a> = <a class="code" href="classikayaki_1_1_project.html#w5">Type</a>.valueOf(s);
00525                     } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00526                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Unknown project type: "</span> + s, e);
00527                     }
00528 
00529                     <span class="comment">// get properties element</span>
00530                     NodeList propertiesList = root.getElementsByTagName(<span class="stringliteral">"properties"</span>);
00531                     <span class="keywordflow">if</span> (propertiesList.getLength() != 1) {
00532                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(
00533                                 <span class="stringliteral">"One properties required, found "</span> + propertiesList.getLength());
00534                     }
00535                     Element <a class="code" href="classikayaki_1_1_project.html#r5">properties</a> = (Element) propertiesList.item(0);
00536 
00537                     <span class="comment">// get default properties</span>
00538                     s = properties.getAttribute(<span class="stringliteral">"strike"</span>);
00539                     <span class="keywordflow">try</span> {
00540                         <a class="code" href="classikayaki_1_1_project.html#r7">strike</a> = Double.parseDouble(s);
00541                     } <span class="keywordflow">catch</span> (NumberFormatException e) {
00542                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid strike: "</span> + s, e);
00543                     }
00544                     s = properties.getAttribute(<span class="stringliteral">"dip"</span>);
00545                     <span class="keywordflow">try</span> {
00546                         <a class="code" href="classikayaki_1_1_project.html#r8">dip</a> = Double.parseDouble(s);
00547                     } <span class="keywordflow">catch</span> (NumberFormatException e) {
00548                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid dip: "</span> + s, e);
00549                     }
00550                     s = properties.getAttribute(<span class="stringliteral">"mass"</span>);
00551                     <span class="keywordflow">try</span> {
00552                         <a class="code" href="classikayaki_1_1_project.html#r13">mass</a> = Double.parseDouble(s);
00553                     } <span class="keywordflow">catch</span> (NumberFormatException e) {
00554                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid mass: "</span> + s, e);
00555                     }
00556                     s = properties.getAttribute(<span class="stringliteral">"volume"</span>);
00557                     <span class="keywordflow">try</span> {
00558                         <a class="code" href="classikayaki_1_1_project.html#r14">volume</a> = Double.parseDouble(s);
00559                     } <span class="keywordflow">catch</span> (NumberFormatException e) {
00560                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid volume: "</span> + s, e);
00561                     }
00562                     s = properties.getAttribute(<span class="stringliteral">"susceptibility"</span>);
00563                     <span class="keywordflow">try</span> {
00564                         <a class="code" href="classikayaki_1_1_project.html#r15">susceptibility</a> = Double.parseDouble(s);
00565                     } <span class="keywordflow">catch</span> (NumberFormatException e) {
00566                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid susceptibility: "</span> + s, e);
00567                     }
00568                     s = properties.getAttribute(<span class="stringliteral">"sampletype"</span>);
00569                     <span class="keywordflow">try</span> {
00570                         <a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a> = <a class="code" href="classikayaki_1_1_project.html#w7">SampleType</a>.valueOf(s);
00571                     } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00572                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid sampletype: "</span> + s, e);
00573                     }
00574                     s = properties.getAttribute(<span class="stringliteral">"orientation"</span>);
00575                     <span class="keywordflow">try</span> {
00576                         <a class="code" href="classikayaki_1_1_project.html#r10">orientation</a> = <a class="code" href="classikayaki_1_1_project.html#w8">Orientation</a>.valueOf(s);
00577                     } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00578                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid orientation: "</span> + s, e);
00579                     }
00580                     s = properties.getAttribute(<span class="stringliteral">"normalization"</span>);
00581                     <span class="keywordflow">try</span> {
00582                         <a class="code" href="classikayaki_1_1_project.html#r11">normalization</a> = <a class="code" href="classikayaki_1_1_project.html#w9">Normalization</a>.valueOf(s);
00583                     } <span class="keywordflow">catch</span> (IllegalArgumentException e) {
00584                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Invalid normalization: "</span> + s, e);
00585                     }
00586 
00587                     <span class="comment">// get custom properties</span>
00588                     NodeList propertyList = properties.getElementsByTagName(<span class="stringliteral">"property"</span>);
00589                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; propertyList.getLength(); i++) {
00590                         Element property = (Element) propertyList.item(i);
00591                         <span class="keyword">this</span>.properties.put(property.getAttribute(<span class="stringliteral">"key"</span>), property.getAttribute(<span class="stringliteral">"value"</span>));
00592                     }
00593 
00594                     <span class="comment">// get sequence</span>
00595                     NodeList sequenceList = root.getElementsByTagName(<span class="stringliteral">"sequence"</span>);
00596                     <span class="keywordflow">if</span> (sequenceList.getLength() != 1) {
00597                         <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"One sequence required, found "</span> + sequenceList.getLength());
00598                     }
00599                     <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();     <span class="comment">// transforms must be updated before running MeasurementSequence's constructor</span>
00600                     <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a>((Element) sequenceList.item(0), <span class="keyword">this</span>);
00601 
00602                     <span class="comment">// check from the measurement step's timestamps and states that the steps are in the right order</span>
00603                     Date lastTimestamp = <span class="keyword">new</span> Date(0);
00604                     <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>.State lastState = <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>.State.DONE;
00605                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a7">getSteps</a>(); i++) {
00606                         <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step = <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a8">getStep</a>(i);
00607                         Date currentTimestamp = step.<a class="code" href="classikayaki_1_1_measurement_step.html#a8">getTimestamp</a>();
00608                         <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>.State currentState = step.<a class="code" href="classikayaki_1_1_measurement_step.html#a7">getState</a>();
00609 
00610                         <span class="comment">// check the order of the timestamps</span>
00611                         <span class="keywordflow">if</span> (lastTimestamp != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; currentTimestamp != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>
00612                                 &amp;&amp; currentTimestamp.before(lastTimestamp)) {
00613                             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"The timestamp of step "</span> + i + <span class="stringliteral">" is too early."</span>);
00614                         }
00615                         <span class="keywordflow">if</span> (lastTimestamp == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; currentTimestamp != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00616                             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(
00617                                     <span class="stringliteral">"The non-null timestamp of step "</span> + i + <span class="stringliteral">" follows a null timestamp."</span>);
00618                         }
00619 
00620                         <span class="comment">// check the order of the states</span>
00621                         <span class="keywordflow">switch</span> (currentState) {
00622                         <span class="keywordflow">case</span> DONE_RECENTLY:
00623                         <span class="keywordflow">case</span> <a class="code" href="classikayaki_1_1_project.html#w6">MEASURING</a>:
00624                             <span class="comment">// the state of a just opened step can not be DONE_RECENTLY or MEASURING</span>
00625                             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"The state of step "</span> + i + <span class="stringliteral">" is "</span> + currentState);
00626                         <span class="keywordflow">case</span> DONE:
00627                             <span class="keywordflow">if</span> (lastState == READY) {
00628                                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"The state of step "</span> + i + <span class="stringliteral">" is "</span>
00629                                         + currentState + <span class="stringliteral">" after a "</span> + READY);
00630                             }
00631                             <span class="keywordflow">break</span>;
00632                         <span class="keywordflow">case</span> READY:
00633                             <span class="comment">// lastState is DONE or READY, so everything is OK</span>
00634                             <span class="keywordflow">break</span>;
00635                         <span class="keywordflow">default</span>:
00636                             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(
00637                                     <span class="stringliteral">"The step "</span> + i + <span class="stringliteral">" has an unknown state: "</span> + currentState);
00638                         }
00639 
00640                         lastTimestamp = currentTimestamp;
00641                         lastState = currentState;
00642                     }
00643 
00644                     <span class="comment">/* End of importing version 1.0 */</span>
00645 
00646 <span class="comment">//              } else if (version.equals("x.y")) {</span>
00647 <span class="comment">//                  ... importing of file version x.y ...</span>
00648                     <span class="comment">/*</span>
00649 <span class="comment">                     * FUTURE IMPLEMENTATION NOTE:</span>
00650 <span class="comment">                     *</span>
00651 <span class="comment">                     * It is recommended to import old versions so that the Document object is first modified to the</span>
00652 <span class="comment">                     * format of the latest project file version, after which the importing of the latest version is</span>
00653 <span class="comment">                     * used. This avoids the need to change the importing of older versions.</span>
00654 <span class="comment">                     *</span>
00655 <span class="comment">                     */</span>
00656                 } <span class="keywordflow">else</span> {
00657                     <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"Unknown version: "</span> + version);
00658                 }
00659 
00660             } <span class="keywordflow">catch</span> (RuntimeException e) {
00661                 <span class="comment">/*</span>
00662 <span class="comment">                 * Catch and rethrow any exceptions, so that the finally block would prevent</span>
00663 <span class="comment">                 * the overwriting of a project file whose loading failed.</span>
00664 <span class="comment">                 */</span>
00665                 <span class="keywordflow">throw</span> e;
00666             } finally {
00667                 <a class="code" href="classikayaki_1_1_project.html#r18">modified</a> = <span class="keyword">false</span>;   <span class="comment">// prevent the automatic save() operations that the importing created</span>
00668             }
00669         }
00670     }
00671 
<a name="l00677"></a><a class="code" href="classikayaki_1_1_project.html#a0">00677</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> Document <a class="code" href="classikayaki_1_1_project.html#a0">getDocument</a>() {
00678         Document document = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00679         <span class="keywordflow">try</span> {
00680             document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
00681         } <span class="keywordflow">catch</span> (ParserConfigurationException e) {
00682             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00683         }
00684 
00685         <span class="comment">// TODO: use a DTD for the document</span>
00686 
00687         <span class="comment">// create document's root element</span>
00688         Element root = document.createElement(<span class="stringliteral">"project"</span>);
00689         root.setAttribute(<span class="stringliteral">"version"</span>, <span class="stringliteral">"1.0"</span>);
00690         root.setAttribute(<span class="stringliteral">"type"</span>, <a class="code" href="classikayaki_1_1_project.html#r1">type</a>.name());
00691 
00692         <span class="comment">// create default properties</span>
00693         Element <a class="code" href="classikayaki_1_1_project.html#r5">properties</a> = document.createElement(<span class="stringliteral">"properties"</span>);
00694         properties.setAttribute(<span class="stringliteral">"strike"</span>, Double.toString(<a class="code" href="classikayaki_1_1_project.html#r7">strike</a>));
00695         properties.setAttribute(<span class="stringliteral">"dip"</span>, Double.toString(<a class="code" href="classikayaki_1_1_project.html#r8">dip</a>));
00696         properties.setAttribute(<span class="stringliteral">"mass"</span>, Double.toString(<a class="code" href="classikayaki_1_1_project.html#r13">mass</a>));
00697         properties.setAttribute(<span class="stringliteral">"volume"</span>, Double.toString(<a class="code" href="classikayaki_1_1_project.html#r14">volume</a>));
00698         properties.setAttribute(<span class="stringliteral">"susceptibility"</span>, Double.toString(<a class="code" href="classikayaki_1_1_project.html#r15">susceptibility</a>));
00699         properties.setAttribute(<span class="stringliteral">"sampletype"</span>, <a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a>.name());
00700         properties.setAttribute(<span class="stringliteral">"orientation"</span>, <a class="code" href="classikayaki_1_1_project.html#r10">orientation</a>.name());
00701         properties.setAttribute(<span class="stringliteral">"normalization"</span>, <a class="code" href="classikayaki_1_1_project.html#r11">normalization</a>.name());
00702 
00703         <span class="comment">// create custom properties</span>
00704         Set&lt;Map.Entry&lt;Object, Object&gt;&gt; entries = <span class="keyword">this</span>.properties.entrySet();
00705         <span class="keywordflow">for</span> (Map.Entry&lt;Object, Object&gt; entry : entries) {
00706             Element property = document.createElement(<span class="stringliteral">"property"</span>);
00707             property.setAttribute(<span class="stringliteral">"key"</span>, entry.getKey().toString());
00708             property.setAttribute(<span class="stringliteral">"value"</span>, entry.getValue().toString());
00709             properties.appendChild(property);
00710         }
00711 
00712         <span class="comment">// create sequence</span>
00713         Element <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a> = <span class="keyword">this</span>.sequence.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a4">getElement</a>(document);
00714 
00715         <span class="comment">// put all together</span>
00716         root.appendChild(properties);
00717         root.appendChild(sequence);
00718         document.appendChild(root);
00719         <span class="keywordflow">return</span> document;
00720     }
00721 
<a name="l00725"></a><a class="code" href="classikayaki_1_1_project.html#a1">00725</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a1">isModified</a>() {
00726         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r18">modified</a>;
00727     }
00728 
<a name="l00735"></a><a class="code" href="classikayaki_1_1_project.html#a2">00735</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a2">save</a>() {
00736         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a11">isClosed</a>()) {
00737             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"The project is closed"</span>);
00738         }
00739         <a class="code" href="classikayaki_1_1_project.html#r18">modified</a> = <span class="keyword">true</span>;
00740         <a class="code" href="classikayaki_1_1_project.html#r19">autosaveQueue</a>.<a class="code" href="classikayaki_1_1util_1_1_last_executor.html#a8">execute</a>(<a class="code" href="classikayaki_1_1_project.html#r20">autosaveRunnable</a>);
00741     }
00742 
<a name="l00750"></a><a class="code" href="classikayaki_1_1_project.html#a3">00750</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a3">saveNow</a>() {
00751         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a11">isClosed</a>()) {
00752             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"The project is closed"</span>);
00753         }
00754         File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>;
00755         Document document;
00756         <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {
00757             <span class="comment">// clear any delaying autosave operations</span>
00758             <a class="code" href="classikayaki_1_1_project.html#r19">autosaveQueue</a>.<a class="code" href="classikayaki_1_1util_1_1_last_executor.html#a10">clear</a>();
00759 
00760             <span class="comment">// do not save if this has already been saved</span>
00761             <span class="keywordflow">if</span> (!<a class="code" href="classikayaki_1_1_project.html#a1">isModified</a>()) {
00762                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00763             }
00764             file = <a class="code" href="classikayaki_1_1_project.html#a7">getFile</a>();
00765             document = <a class="code" href="classikayaki_1_1_project.html#a0">getDocument</a>();
00766         }
00767         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1util_1_1_document_utilities.html">DocumentUtilities</a>.storeToXML(file, document)) {
00768             <a class="code" href="classikayaki_1_1_project.html#r18">modified</a> = <span class="keyword">false</span>;
00769             <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(FILE_SAVED);
00770             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00771         } <span class="keywordflow">else</span> {
00772             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00773         }
00774     }
00775 
<a name="l00783"></a><a class="code" href="classikayaki_1_1_project.html#a4">00783</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a4">exportToDAT</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
00784         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00785             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00786         }
00787         PrintStream out = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00788         <span class="keywordflow">try</span> {
00789             out = <span class="keyword">new</span> PrintStream(file, <span class="stringliteral">"ISO-8859-1"</span>);
00790             <span class="keywordtype">double</span> d;
00791             Double dd;
00792             String s;
00793 
00794             <span class="comment">// locales and formatters for numbers</span>
00795             Locale locale = <span class="keyword">new</span> Locale(<span class="stringliteral">"en"</span>);
00796             DecimalFormat format2Frac = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"###0.00"</span>, <span class="keyword">new</span> DecimalFormatSymbols(locale));
00797             DecimalFormat format3Frac = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"##0.000"</span>, <span class="keyword">new</span> DecimalFormatSymbols(locale));
00798             DecimalFormat format5Numb = <span class="keyword">new</span> DecimalFormat(<span class="stringliteral">"###0.0000"</span>, <span class="keyword">new</span> DecimalFormatSymbols(locale)) {
00799                 @Override <span class="keyword">public</span> StringBuffer format(<span class="keywordtype">double</span> number, StringBuffer result, FieldPosition fieldPosition) {
00800                     StringBuffer sb = super.format(number, result, fieldPosition);
00801                     <span class="keywordflow">if</span> (number &lt; 0) {
00802                         sb.delete(7, sb.length());
00803                     } <span class="keywordflow">else</span> {
00804                         sb.delete(6, sb.length());
00805                     }
00806                     <span class="keywordflow">return</span> sb;
00807                 }
00808             };
00809 
00810             <span class="comment">// generic headers</span>
00811             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"SQUID"</span>, 11, -1));
00812             out.println(<a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.APP_NAME + <span class="stringliteral">" "</span> + <a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.APP_VERSION);
00813 
00814             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Name"</span>, 10, -1));
00815             out.print(<span class="stringliteral">":"</span>);
00816             out.println(<a class="code" href="classikayaki_1_1_project.html#a12">getName</a>());
00817 
00818             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Rocktype"</span>, 10, -1));
00819             out.print(<span class="stringliteral">":"</span>);
00820             out.println(<a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s5">ROCK_TYPE_PROPERTY</a>, <span class="stringliteral">""</span>));
00821 
00822             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Site"</span>, 10, -1));
00823             out.print(<span class="stringliteral">":"</span>);
00824             s = <a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s6">AREA_PROPERTY</a>, <span class="stringliteral">""</span>);
00825             <span class="keywordflow">if</span> (s.length() &gt; 0) {
00826                 s += <span class="stringliteral">"/"</span>;
00827             }
00828             s += <a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s7">SITE_PROPERTY</a>, <span class="stringliteral">""</span>);
00829             out.println(s);
00830 
00831             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Sampletype"</span>, 10, -1));
00832             out.print(<span class="stringliteral">":"</span>);
00833             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a23">getSampleType</a>() == <a class="code" href="classikayaki_1_1_project.html#w7w2">CORE</a>) {
00834                 out.println(<span class="stringliteral">"core sample"</span>);
00835             } <span class="keywordflow">else</span> {
00836                 out.println(<span class="stringliteral">"hand sample"</span>);
00837             }
00838 
00839             out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Comment"</span>, 10, -1));
00840             out.print(<span class="stringliteral">":"</span>);
00841             out.println(<a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s8">COMMENT_PROPERTY</a>, <span class="stringliteral">""</span>).replaceAll(<span class="stringliteral">"\\s"</span>, <span class="stringliteral">" "</span>));
00842 
00843             <span class="comment">// value headers</span>
00844             String header = <span class="stringliteral">""</span>;
00845             String values = <span class="stringliteral">""</span>;
00846 
00847             <span class="keywordflow">try</span> {
00848                 d = Double.parseDouble(<a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s9">LATITUDE_PROPERTY</a>, <span class="stringliteral">"0.0"</span>));
00849             } <span class="keywordflow">catch</span> (NumberFormatException e) {
00850                 d = 0.0;
00851             }
00852             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Lat "</span>, 8, 1);
00853             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00854 
00855             <span class="keywordflow">try</span> {
00856                 d = Double.parseDouble(<a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(<a class="code" href="classikayaki_1_1_project.html#s10">LONGITUDE_PROPERTY</a>, <span class="stringliteral">"0.0"</span>));
00857             } <span class="keywordflow">catch</span> (NumberFormatException e) {
00858                 d = 0.0;
00859             }
00860             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Lon "</span>, 8, 1);
00861             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00862 
00863             d = <a class="code" href="classikayaki_1_1_project.html#a19">getStrike</a>();
00864             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Str "</span>, 8, 1);
00865             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00866 
00867             d = <a class="code" href="classikayaki_1_1_project.html#a21">getDip</a>();
00868             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Dip "</span>, 8, 1);
00869             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00870 
00871             d = 0.0;
00872             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Bstr"</span>, 8, 1);
00873             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00874 
00875             d = 0.0;
00876             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Bdip"</span>, 8, 1);
00877             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format2Frac.format(d), 8, 1);
00878 
00879             d = Math.min(<a class="code" href="classikayaki_1_1_project.html#a31">getVolume</a>(), 0.0);
00880             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Vol  "</span>, 8, 1);
00881             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format3Frac.format(d), 8, 1);
00882 
00883             d = Math.min(<a class="code" href="classikayaki_1_1_project.html#a29">getMass</a>(), 0.0);
00884             header += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(<span class="stringliteral">"Mass "</span>, 8, 1);
00885             values += <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(format3Frac.format(d), 8, 1);
00886 
00887             out.println(header);
00888             out.println(values);
00889 
00890             <span class="comment">// measurement headers</span>
00891             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a8">getType</a>() == THELLIER || <a class="code" href="classikayaki_1_1_project.html#a8">getType</a>() == THERMAL) {
00892                 out.print(<span class="stringliteral">"TH"</span>);
00893             } <span class="keywordflow">else</span> {
00894                 out.print(<span class="stringliteral">"AF"</span>);
00895             }
00896             out.println(<span class="stringliteral">"      Dec    Inc       Int       Sus    T63       Xkomp      Ykomp      Zkomp"</span>);
00897 
00898             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classikayaki_1_1_project.html#a47">getCompletedSteps</a>(); i++) {
00899                 <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step = <a class="code" href="classikayaki_1_1_project.html#a48">getStep</a>(i);
00900 
00901                 <span class="comment">// AF/TF</span>
00902                 s = <span class="stringliteral">""</span> + Math.max((<span class="keywordtype">int</span>) Math.round(step.<a class="code" href="classikayaki_1_1_measurement_step.html#a9">getStepValue</a>()), 0);
00903                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 4, 1));
00904 
00905                 <span class="comment">// Dec</span>
00906                 dd = MeasurementValue.DECLINATION.getValue(step);
00907                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00908                 s = format2Frac.format(d);
00909                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 8, 1));
00910 
00911                 <span class="comment">// Inc</span>
00912                 dd = MeasurementValue.INCLINATION.getValue(step);
00913                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00914                 s = format2Frac.format(d);
00915                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 7, 1));
00916 
00917                 <span class="comment">// Int</span>
00918                 dd = MeasurementValue.MAGNETIZATION.getValue(step);
00919                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00920                 s = format5Numb.format(d);
00921                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 11, 1));
00922 
00923                 <span class="comment">// Sus</span>
00924                 d = step.<a class="code" href="classikayaki_1_1_measurement_step.html#a15">getSusceptibility</a>();
00925                 d = d &gt;= 0.0 ? d : Math.max(<a class="code" href="classikayaki_1_1_project.html#a33">getSusceptibility</a>(), 0.0);
00926                 s = format5Numb.format(d);
00927                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 9, 1));
00928 
00929                 <span class="comment">// T63</span>
00930                 dd = MeasurementValue.THETA63.getValue(step);
00931                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00932                 s = format2Frac.format(d);
00933                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 7, 1));
00934 
00935                 <span class="comment">// Xkomp</span>
00936                 dd = MeasurementValue.SAMPLE_X.getValue(step);
00937                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00938                 s = format5Numb.format(d);
00939                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 11, 1));
00940 
00941                 <span class="comment">// Ykomp</span>
00942                 dd = MeasurementValue.SAMPLE_Y.getValue(step);
00943                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00944                 s = format5Numb.format(d);
00945                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 11, 1));
00946 
00947                 <span class="comment">// Zkomp</span>
00948                 dd = MeasurementValue.SAMPLE_Z.getValue(step);
00949                 d = dd != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> ? dd : 0.0;
00950                 s = format5Numb.format(d);
00951                 out.print(<a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(s, 11, 1));
00952 
00953                 out.println();
00954             }
00955 
00956             <span class="comment">// exporting finished</span>
00957             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00958 
00959         } <span class="keywordflow">catch</span> (FileNotFoundException e) {
00960             e.printStackTrace();
00961         } <span class="keywordflow">catch</span> (UnsupportedEncodingException e) {
00962             e.printStackTrace();
00963         } finally {
00964             <span class="keywordflow">if</span> (out != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00965                 out.close();
00966             }
00967         }
00968         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00969     }
00970 
<a name="l00979"></a><a class="code" href="classikayaki_1_1_project.html#h0">00979</a>     <span class="keyword">private</span> <span class="keyword">static</span> String <a class="code" href="classikayaki_1_1_project.html#h0">pad</a>(String s, <span class="keywordtype">int</span> length, <span class="keywordtype">int</span> alignment) {
00980         <span class="keywordflow">while</span> (s.length() &lt; length) {
00981             <span class="keywordflow">if</span> (alignment &lt; 0) {
00982                 <span class="comment">// left align</span>
00983                 s = s + <span class="stringliteral">" "</span>;
00984             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (alignment &gt; 0) {
00985                 <span class="comment">// right align</span>
00986                 s = <span class="stringliteral">" "</span> + s;
00987             } <span class="keywordflow">else</span> {
00988                 <span class="comment">// center</span>
00989                 <span class="keywordflow">if</span> (s.length() % 2 == 0) {
00990                     s = s + <span class="stringliteral">" "</span>;
00991                 } <span class="keywordflow">else</span> {
00992                     s = <span class="stringliteral">" "</span> + s;
00993                 }
00994             }
00995         }
00996         <span class="keywordflow">return</span> s;
00997     }
00998 
<a name="l01006"></a><a class="code" href="classikayaki_1_1_project.html#a5">01006</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a5">exportToSRM</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
01007         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01008             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01009         }
01010         <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TODO</span>
01011     }
01012 
<a name="l01020"></a><a class="code" href="classikayaki_1_1_project.html#a6">01020</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a6">exportToTDT</a>(File <a class="code" href="classikayaki_1_1_project.html#r0">file</a>) {
01021         <span class="keywordflow">if</span> (file == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01022             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01023         }
01024         <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TODO</span>
01025     }
01026 
<a name="l01030"></a><a class="code" href="classikayaki_1_1_project.html#a7">01030</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> File <a class="code" href="classikayaki_1_1_project.html#a7">getFile</a>() {
01031         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r0">file</a>;
01032     }
01033 
<a name="l01037"></a><a class="code" href="classikayaki_1_1_project.html#a8">01037</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html#w5">Type</a> <a class="code" href="classikayaki_1_1_project.html#a8">getType</a>() {
01038         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r1">type</a>;
01039     }
01040 
<a name="l01044"></a><a class="code" href="classikayaki_1_1_project.html#a9">01044</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a9">isHolderCalibration</a>() {
01045         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a8">getType</a>() == CALIBRATION &amp;&amp; <a class="code" href="classikayaki_1_1_project.html#a7">getFile</a>().equals(<a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getHolderCalibrationFile())) {
01046             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01047         } <span class="keywordflow">else</span> {
01048             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01049         }
01050     }
01051 
<a name="l01057"></a><a class="code" href="classikayaki_1_1_project.html#a10">01057</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html#w6">State</a> <a class="code" href="classikayaki_1_1_project.html#a10">getState</a>() {
01058         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r2">state</a>;
01059     }
01060 
<a name="l01066"></a><a class="code" href="classikayaki_1_1_project.html#d2">01066</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#d2">setState</a>(<a class="code" href="classikayaki_1_1_project.html#w6">State</a> <a class="code" href="classikayaki_1_1_project.html#r2">state</a>) {
01067         <span class="keyword">this</span>.state = state;
01068         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(STATE_CHANGED);
01069     }
01070 
<a name="l01075"></a><a class="code" href="classikayaki_1_1_project.html#a11">01075</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a11">isClosed</a>() {
01076         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r3">closed</a>;
01077     }
01078 
<a name="l01082"></a><a class="code" href="classikayaki_1_1_project.html#a12">01082</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> String <a class="code" href="classikayaki_1_1_project.html#a12">getName</a>() {
01083         String <a class="code" href="classikayaki_1_1_project.html#w5">name</a> = <a class="code" href="classikayaki_1_1_project.html#a7">getFile</a>().getName();
01084         <span class="keywordflow">if</span> (name.endsWith(<a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.FILE_TYPE)) {
01085             name = name.substring(0, name.length() - <a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.FILE_TYPE.length());
01086         }
01087         <span class="keywordflow">return</span> name;
01088     }
01089 
<a name="l01096"></a><a class="code" href="classikayaki_1_1_project.html#a13">01096</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> Date <a class="code" href="classikayaki_1_1_project.html#a13">getTimestamp</a>() {
01097         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a7">getSteps</a>() - 1; i &gt;= 0; i--) {
01098             Date d = <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a8">getStep</a>(i).getTimestamp();
01099             <span class="keywordflow">if</span> (d != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01100                 <span class="keywordflow">return</span> d;
01101             }
01102         }
01103         <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
01104     }
01105 
<a name="l01112"></a><a class="code" href="classikayaki_1_1_project.html#a14">01112</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1squid_1_1_squid.html">Squid</a> <a class="code" href="classikayaki_1_1_project.html#a14">getSquid</a>() {
01113         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r4">squid</a>;
01114     }
01115 
<a name="l01128"></a><a class="code" href="classikayaki_1_1_project.html#a15">01128</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1_project.html#a15">setSquid</a>(<a class="code" href="classikayaki_1_1squid_1_1_squid.html">Squid</a> <a class="code" href="classikayaki_1_1_project.html#r4">squid</a>) {
01129         <span class="comment">// detach the squid from this project</span>
01130         <span class="keywordflow">if</span> (squid == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01131             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a14">getSquid</a>() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01132                 <span class="keywordflow">return</span> <span class="keyword">true</span>;        <span class="comment">// already detached</span>
01133             }
01134             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#a10">getState</a>() == <a class="code" href="classikayaki_1_1_project.html#w6w1">IDLE</a> &amp;&amp; <a class="code" href="classikayaki_1_1_project.html#a14">getSquid</a>().setOwner(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>)) {
01135                 <span class="keyword">this</span>.squid = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
01136                 <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(STATE_CHANGED);
01137                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01138             }
01139             <span class="keywordflow">return</span> <span class="keyword">false</span>;       <span class="comment">// a measurement is running - can not detach</span>
01140         }
01141 
01142         <span class="comment">// attach the squid to this project</span>
01143         <span class="keyword">synchronized</span> (squid) {
01144             <span class="keywordflow">if</span> (squid.<a class="code" href="classikayaki_1_1squid_1_1_squid.html#a6">getOwner</a>() == <span class="keyword">this</span>) {
01145                 <span class="keywordflow">return</span> <span class="keyword">true</span>;        <span class="comment">// already attached</span>
01146             }
01147             <span class="keywordflow">if</span> (squid.<a class="code" href="classikayaki_1_1squid_1_1_squid.html#a6">getOwner</a>() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01148                 squid.<a class="code" href="classikayaki_1_1squid_1_1_squid.html#a6">getOwner</a>().setSquid(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);        <span class="comment">// try to detach from the old project</span>
01149             }
01150             <span class="keywordflow">if</span> (squid.<a class="code" href="classikayaki_1_1squid_1_1_squid.html#a6">getOwner</a>() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; squid.<a class="code" href="classikayaki_1_1squid_1_1_squid.html#a5">setOwner</a>(<span class="keyword">this</span>)) {
01151                 <span class="keyword">this</span>.squid = squid;
01152                 <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(STATE_CHANGED);
01153                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01154             }
01155             <span class="keywordflow">return</span> <span class="keyword">false</span>;       <span class="comment">// the old project has a measurement running - can not attach to this one</span>
01156         }
01157     }
01158 
<a name="l01165"></a><a class="code" href="classikayaki_1_1_project.html#a16">01165</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> String <a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(String key) {
01166         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r5">properties</a>.getProperty(key);
01167     }
01168 
<a name="l01176"></a><a class="code" href="classikayaki_1_1_project.html#a17">01176</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> String <a class="code" href="classikayaki_1_1_project.html#a16">getProperty</a>(String key, String defaultValue) {
01177         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r5">properties</a>.getProperty(key, defaultValue);
01178     }
01179 
<a name="l01186"></a><a class="code" href="classikayaki_1_1_project.html#a18">01186</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a18">setProperty</a>(String key, String <a class="code" href="namespaceikayaki_1_1gui.html#a26a3">value</a>) {
01187         <a class="code" href="classikayaki_1_1_project.html#r5">properties</a>.setProperty(key, value);
01188         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01189     }
01190 
<a name="l01194"></a><a class="code" href="classikayaki_1_1_project.html#a19">01194</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#a19">getStrike</a>() {
01195         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r7">strike</a>;
01196     }
01197 
<a name="l01201"></a><a class="code" href="classikayaki_1_1_project.html#a20">01201</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a20">setStrike</a>(<span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r7">strike</a>) {
01202         <span class="keyword">this</span>.strike = strike;
01203         <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();
01204         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01205         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01206     }
01207 
<a name="l01211"></a><a class="code" href="classikayaki_1_1_project.html#a21">01211</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#a21">getDip</a>() {
01212         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r8">dip</a>;
01213     }
01214 
<a name="l01218"></a><a class="code" href="classikayaki_1_1_project.html#a22">01218</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a22">setDip</a>(<span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r8">dip</a>) {
01219         <span class="keyword">this</span>.dip = dip;
01220         <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();
01221         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01222         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01223     }
01224 
<a name="l01228"></a><a class="code" href="classikayaki_1_1_project.html#a23">01228</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html#w7">SampleType</a> <a class="code" href="classikayaki_1_1_project.html#a23">getSampleType</a>() {
01229         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a>;
01230     }
01231 
<a name="l01237"></a><a class="code" href="classikayaki_1_1_project.html#a24">01237</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a24">setSampleType</a>(<a class="code" href="classikayaki_1_1_project.html#w7">SampleType</a> <a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a>) {
01238         <span class="keywordflow">if</span> (sampleType == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01239             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01240         }
01241         <span class="keyword">this</span>.sampleType = sampleType;
01242         <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();
01243         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01244         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01245     }
01246 
<a name="l01250"></a><a class="code" href="classikayaki_1_1_project.html#a25">01250</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_project.html#w8">Orientation</a> <a class="code" href="classikayaki_1_1_project.html#a25">getOrientation</a>() {
01251         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r10">orientation</a>;
01252     }
01253 
<a name="l01259"></a><a class="code" href="classikayaki_1_1_project.html#a26">01259</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a26">setOrientation</a>(<a class="code" href="classikayaki_1_1_project.html#w8">Orientation</a> <a class="code" href="classikayaki_1_1_project.html#r10">orientation</a>) {
01260         <span class="keywordflow">if</span> (orientation == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01261             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01262         }
01263         <span class="keyword">this</span>.orientation = orientation;
01264         <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>();
01265         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01266         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01267     }
01268 
<a name="l01272"></a><a class="code" href="classikayaki_1_1_project.html#a27">01272</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1_project.html#w9">Normalization</a> <a class="code" href="classikayaki_1_1_project.html#a27">getNormalization</a>() {
01273         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r11">normalization</a>;
01274     }
01275 
<a name="l01281"></a><a class="code" href="classikayaki_1_1_project.html#a28">01281</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a28">setNormalization</a>(<a class="code" href="classikayaki_1_1_project.html#w9">Normalization</a> <a class="code" href="classikayaki_1_1_project.html#r11">normalization</a>) {
01282         <span class="keywordflow">if</span> (normalization == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01283             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01284         }
01285         <span class="keyword">this</span>.normalization = normalization;
01286         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01287         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01288     }
01289 
<a name="l01299"></a><a class="code" href="classikayaki_1_1_project.html#b0">01299</a>     <span class="keyword">protected</span> <span class="keyword">synchronized</span> Matrix3d <a class="code" href="classikayaki_1_1_project.html#b0">getTransform</a>() {
01300         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>;
01301     }
01302 
<a name="l01307"></a><a class="code" href="classikayaki_1_1_project.html#d3">01307</a>     <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#d3">updateTransforms</a>() {
01308         <span class="keywordtype">double</span> s;
01309         <span class="keywordtype">double</span> d;
01310 <span class="comment">//        if (orientation == MINUS_Z) {</span>
01311 <span class="comment">//            s = Math.toRadians(getStrike());</span>
01312 <span class="comment">//            d = Math.toRadians(getDip() + 180.0);   // TODO: this might be wrong. just flip the sign of Z and Y.</span>
01313 <span class="comment">//        } else {</span>
01314         s = Math.toRadians(<a class="code" href="classikayaki_1_1_project.html#a19">getStrike</a>());
01315         d = Math.toRadians(<a class="code" href="classikayaki_1_1_project.html#a21">getDip</a>());
01316 <span class="comment">//        }</span>
01317 
01318         <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a> == <a class="code" href="classikayaki_1_1_project.html#w7w2">CORE</a>) {
01319             <span class="comment">// core sample: sample -&gt; geographic</span>
01320             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(0, sin(d) * cos(s), -sin(s), cos(s) * cos(d));
01321             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(1, sin(s) * sin(d), cos(s), cos(d) * sin(s));
01322             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(2, -cos(d), 0, sin(d));
01323         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1_project.html#r9">sampleType</a> == <a class="code" href="classikayaki_1_1_project.html#w7">HAND</a>) {
01324             <span class="comment">// hand sample: sample -&gt; geographic</span>
01325             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(0, cos(s), -sin(s) * cos(d), sin(s) * sin(d));
01326             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(1, sin(s), cos(s) * cos(d), -sin(d) * cos(s));
01327             <a class="code" href="classikayaki_1_1_project.html#r12">transform</a>.setRow(2, 0, sin(d), cos(d));
01328         } <span class="keywordflow">else</span> {
01329             assert <span class="keyword">false</span>;
01330         }
01331 <span class="comment">//        System.out.println(transform.m00 + "\t" + transform.m01 + "\t" + transform.m02);</span>
01332 <span class="comment">//        System.out.println(transform.m10 + "\t" + transform.m11 + "\t" + transform.m12);</span>
01333 <span class="comment">//        System.out.println(transform.m20 + "\t" + transform.m21 + "\t" + transform.m22);</span>
01334 <span class="comment">//        System.out.println();</span>
01335 <span class="comment">//        if (orientation == PLUS_Z) {</span>
01336 <span class="comment">//            // TODO: this method might give wrong values. check the matrices. appears that the +/-Z is not working right.</span>
01337 <span class="comment">//            // +Z position -&gt; -Z position</span>
01338 <span class="comment">//</span>
01339 <span class="comment">//            /*</span>
01340 <span class="comment">//             *  transform multipied by</span>
01341 <span class="comment">//             *   [[-1  0  0 ]</span>
01342 <span class="comment">//             *    [ 0 -1  0 ]</span>
01343 <span class="comment">//             *    [ 0  0  1 ]]</span>
01344 <span class="comment">//             */</span>
01347 <span class="comment"></span><span class="comment">//</span>
01348 <span class="comment">//            /*</span>
01349 <span class="comment">//             *  transform multipied by</span>
01350 <span class="comment">//             *   [[ 1  0  0 ]</span>
01351 <span class="comment">//             *    [ 0 -1  0 ]</span>
01352 <span class="comment">//             *    [ 0  0 -1 ]]</span>
01353 <span class="comment">//             */</span>
01356 <span class="comment"></span><span class="comment">//        }</span>
01357         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a7">getSteps</a>(); i++) {
01358             <a class="code" href="classikayaki_1_1_project.html#r6">sequence</a>.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a8">getStep</a>(i).updateTransforms();
01359         }
01360     }
01361 
<a name="l01367"></a><a class="code" href="classikayaki_1_1_project.html#a29">01367</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#a29">getMass</a>() {
01368         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r13">mass</a>;
01369     }
01370 
<a name="l01376"></a><a class="code" href="classikayaki_1_1_project.html#a30">01376</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a30">setMass</a>(<span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r13">mass</a>) {
01377         <span class="keywordflow">if</span> (mass &lt; 0.0) {
01378             mass = -1.0;
01379         }
01380         <span class="keyword">this</span>.mass = mass;
01381         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01382         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01383     }
01384 
<a name="l01390"></a><a class="code" href="classikayaki_1_1_project.html#a31">01390</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#a31">getVolume</a>() {
01391         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r14">volume</a>;
01392     }
01393 
<a name="l01399"></a><a class="code" href="classikayaki_1_1_project.html#a32">01399</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a32">setVolume</a>(<span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r14">volume</a>) {
01400         <span class="keywordflow">if</span> (volume &lt; 0.0) {
01401             volume = -1.0;
01402         }
01403         <span class="keyword">this</span>.volume = volume;
01404         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01405         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01406     }
01407 
<a name="l01413"></a><a class="code" href="classikayaki_1_1_project.html#a33">01413</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#a33">getSusceptibility</a>() {
01414         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_project.html#r15">susceptibility</a>;
01415     }
01416 
<a name="l01422"></a><a class="code" href="classikayaki_1_1_project.html#a34">01422</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a34">setSusceptibility</a>(<span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1_project.html#r15">susceptibility</a>) {
01423         <span class="keywordflow">if</span> (susceptibility &lt; 0.0) {
01424             susceptibility = -1.0;
01425         }
01426         <span class="keyword">this</span>.susceptibility = susceptibility;
01427         <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(DATA_CHANGED);
01428         <a class="code" href="classikayaki_1_1_project.html#a2">save</a>();
01429     }
01430 
<a name="l01436"></a><a class="code" href="classikayaki_1_1_project.html#a35">01436</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a35">addProjectListener</a>(<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a> l) {
01437         <a class="code" href="classikayaki_1_1_project.html#r17">listenerList</a>.add(<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a>.class, l);
01438     }
01439 
<a name="l01445"></a><a class="code" href="classikayaki_1_1_project.html#a36">01445</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#a36">removeProjectListener</a>(<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a> l) {
01446         <a class="code" href="classikayaki_1_1_project.html#r17">listenerList</a>.remove(<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a>.class, l);
01447     }
01448 
<a name="l01454"></a><a class="code" href="classikayaki_1_1_project.html#b1">01454</a>     <span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1_project.html#b1">fireProjectEvent</a>(<a class="code" href="classikayaki_1_1_project_event.html">ProjectEvent</a>.Type <a class="code" href="classikayaki_1_1_project.html#r1">type</a>) {
01455         <span class="keyword">final</span> <a class="code" href="classikayaki_1_1_project_event.html">ProjectEvent</a> event = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_event.html">ProjectEvent</a>(<span class="keyword">this</span>, type);
01456         <span class="keyword">final</span> <a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a>[] listeners = <a class="code" href="classikayaki_1_1_project.html#r17">listenerList</a>.getListeners(<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a>.class);
01457         SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
01458             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
01459                 <span class="keywordflow">for</span> (<a class="code" href="interfaceikayaki_1_1_project_listener.html">ProjectListener</a> l : listeners) {
01460                     <span class="keywordflow">try</span> {
01461                         l.projectUpdated(event);
01462                     } <span class="keywordflow">catch</span> (Throwable t) {
01463                         t.printStackTrace();
01464                     }
01465                 }
01466             }
01467         });
01468     }
01469 
<a name="l01475"></a><a class="code" href="classikayaki_1_1_project.html#a37">01475</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> addMeasurementListener(<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a> l) {
01476         listenerList.add(<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a>.class, l);
01477     }
01478 
<a name="l01484"></a><a class="code" href="classikayaki_1_1_project.html#a38">01484</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> removeMeasurementListener(<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a> l) {
01485         listenerList.remove(<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a>.class, l);
01486     }
01487 
<a name="l01494"></a><a class="code" href="classikayaki_1_1_project.html#b2">01494</a>     <span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> fireMeasurementEvent(<a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step, <a class="code" href="classikayaki_1_1_measurement_event.html">MeasurementEvent</a>.Type type) {
01495         <span class="keyword">final</span> <a class="code" href="classikayaki_1_1_measurement_event.html">MeasurementEvent</a> event = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_event.html">MeasurementEvent</a>(<span class="keyword">this</span>, step, type);
01496         <span class="keyword">final</span> <a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a>[] listeners = listenerList.getListeners(<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a>.class);
01497         SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
01498             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
01499                 <span class="keywordflow">for</span> (<a class="code" href="interfaceikayaki_1_1_measurement_listener.html">MeasurementListener</a> l : listeners) {
01500                     <span class="keywordflow">try</span> {
01501                         l.measurementUpdated(event);
01502                     } <span class="keywordflow">catch</span> (Throwable t) {
01503                         t.printStackTrace();
01504                     }
01505                 }
01506             }
01507         });
01508     }
01509 
<a name="l01520"></a><a class="code" href="classikayaki_1_1_project.html#a39">01520</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> addSequence(<a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> append) {
01521         <span class="keywordflow">if</span> (append == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01522             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01523         }
01524         <span class="keywordflow">if</span> (!isSequenceEditEnabled()) {
01525             <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// TODO: maybe its better to throw an exception</span>
01526         }
01527         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; append.getSteps(); i++) {
01528             <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<span class="keyword">this</span>);
01529             step.<a class="code" href="classikayaki_1_1_measurement_step.html#a10">setStepValue</a>(append.getStep(i).getStepValue());
01530             sequence.addStep(step);
01531         }
01532         fireProjectEvent(DATA_CHANGED);
01533         save();
01534         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01535     }
01536 
<a name="l01546"></a><a class="code" href="classikayaki_1_1_project.html#a40">01546</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> copySequence(<span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end) {
01547         <span class="keywordflow">if</span> (start &lt; 0 || end &gt;= getSteps()) {
01548             <span class="keywordflow">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();
01549         }
01550         <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> copy = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a>();
01551         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = start; i &lt;= end; i++) {
01552             <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>();
01553             step.<a class="code" href="classikayaki_1_1_measurement_step.html#a10">setStepValue</a>(sequence.getStep(i).getStepValue());
01554             copy.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a9">addStep</a>(step);
01555         }
01556         <span class="keywordflow">return</span> copy;
01557     }
01558 
<a name="l01568"></a><a class="code" href="classikayaki_1_1_project.html#a41">01568</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> copySequence(<span class="keywordtype">int</span>... indices) {
01569         <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a> copy = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_sequence.html">MeasurementSequence</a>();
01570         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i : indices) {
01571             <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>();
01572             step.<a class="code" href="classikayaki_1_1_measurement_step.html#a10">setStepValue</a>(sequence.getStep(i).getStepValue());
01573             copy.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a9">addStep</a>(step);
01574         }
01575         <span class="keywordflow">return</span> copy;
01576     }
01577 
<a name="l01586"></a><a class="code" href="classikayaki_1_1_project.html#a42">01586</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> addStep(<a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step) {
01587         <span class="keywordflow">if</span> (step == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01588             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01589         }
01590         <span class="keywordtype">double</span> stepValue = step.getStepValue();
01591         step = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<span class="keyword">this</span>);
01592         step.setStepValue(stepValue);
01593         sequence.addStep(step);
01594 
01595         fireProjectEvent(DATA_CHANGED);
01596         save();
01597         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01598     }
01599 
<a name="l01615"></a><a class="code" href="classikayaki_1_1_project.html#a43">01615</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> addStep(<span class="keywordtype">int</span> index, <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> step) {
01616         <span class="keywordflow">if</span> (step == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01617             <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
01618         }
01619         <span class="keywordflow">if</span> (index &lt; getCompletedSteps() || index &gt; getSteps()) {
01620             <span class="keywordflow">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();
01621         }
01622         <span class="keywordflow">if</span> (!isSequenceEditEnabled()) {
01623             <span class="keywordflow">return</span> <span class="keyword">false</span>;    <span class="comment">// TODO: maybe its better to throw an exception</span>
01624         }
01625         <span class="keywordtype">double</span> stepValue = step.<a class="code" href="classikayaki_1_1_measurement_step.html#a9">getStepValue</a>();
01626         step = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<span class="keyword">this</span>);
01627         step.<a class="code" href="classikayaki_1_1_measurement_step.html#a10">setStepValue</a>(stepValue);
01628         sequence.addStep(index, step);
01629 
01630         fireProjectEvent(DATA_CHANGED);
01631         save();
01632         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01633     }
01634 
<a name="l01645"></a><a class="code" href="classikayaki_1_1_project.html#a44">01645</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> removeStep(<span class="keywordtype">int</span> index) {
01646         <span class="keywordflow">if</span> (index &lt; getCompletedSteps() || index &gt;= getSteps()) {
01647             <span class="keywordflow">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();
01648         }
01649         <span class="keywordflow">if</span> (!isSequenceEditEnabled()) {
01650             <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// TODO: maybe its better to throw an exception</span>
01651         }
01652         sequence.removeStep(index);
01653 
01654         fireProjectEvent(DATA_CHANGED);
01655         save();
01656         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01657     }
01658 
<a name="l01670"></a><a class="code" href="classikayaki_1_1_project.html#a45">01670</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> removeStep(<span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end) {
01671         <span class="keywordflow">if</span> (start &lt; getCompletedSteps() || end &gt;= getSteps()) {
01672             <span class="keywordflow">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();
01673         }
01674         <span class="keywordflow">if</span> (!isSequenceEditEnabled()) {
01675             <span class="keywordflow">return</span> <span class="keyword">false</span>;   <span class="comment">// TODO: maybe its better to throw an exception</span>
01676         }
01677         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = end; i &gt;= start; i--) {
01678             sequence.removeStep(i);
01679         }
01680         fireProjectEvent(DATA_CHANGED);
01681         save();
01682         <span class="keywordflow">return</span> <span class="keyword">true</span>;
01683     }
01684 
<a name="l01688"></a><a class="code" href="classikayaki_1_1_project.html#a46">01688</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">int</span> getSteps() {
01689         <span class="keywordflow">return</span> sequence.getSteps();
01690     }
01691 
<a name="l01696"></a><a class="code" href="classikayaki_1_1_project.html#a47">01696</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">int</span> getCompletedSteps() {
01697         <span class="keywordtype">int</span> i;
01698         <span class="keywordflow">for</span> (i = sequence.getSteps() - 1; i &gt;= 0; i--) {
01699             <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>.State state = sequence.getStep(i).getState();
01700             <span class="keywordflow">if</span> (state == READY) {
01701                 <span class="keywordflow">continue</span>;
01702             } <span class="keywordflow">else</span> {
01703                 <span class="keywordflow">break</span>;
01704             }
01705         }
01706         <span class="keywordflow">return</span> i + 1;
01707     }
01708 
<a name="l01716"></a><a class="code" href="classikayaki_1_1_project.html#a48">01716</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> getStep(<span class="keywordtype">int</span> index) {
01717         <span class="keywordflow">return</span> sequence.getStep(index);
01718     }
01719 
<a name="l01725"></a><a class="code" href="classikayaki_1_1_project.html#a49">01725</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a> getCurrentStep() {
01726         <span class="keywordflow">return</span> currentStep;
01727     }
01728 
<a name="l01739"></a><a class="code" href="classikayaki_1_1_project.html#a50">01739</a>     <span class="keyword">public</span> synchronized &lt;A&gt; A getValue(<span class="keywordtype">int</span> index, MeasurementValue&lt;A&gt; algorithm) {
01740         <span class="keywordflow">return</span> algorithm.getValue(sequence.getStep(index));
01741     }
01742 
<a name="l01750"></a><a class="code" href="classikayaki_1_1_project.html#d4">01750</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> runMeasurement() {
01751         <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; !DEBUG) {
01752             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"Unable to run measurement, squid is: "</span> + getSquid());
01753         }
01754         <span class="keywordflow">if</span> (getState() == IDLE) {
01755             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"Unable to run measurement, state is: "</span> + getState());
01756         }
01757 
01758         <span class="keywordflow">try</span> {
01759             <span class="keywordflow">if</span> (DEBUG) {
01760                 <span class="keyword">synchronized</span> (<a class="code" href="classikayaki_1_1_project_1_1_dummy_measurement.html">DummyMeasurement</a>.class) {
01761                     <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_dummy_measurement.html">DummyMeasurement</a>().run();
01762                 }
01763             } <span class="keywordflow">else</span> {
01764                 <span class="keyword">synchronized</span> (<a class="code" href="classikayaki_1_1_project_1_1_measurement.html">Measurement</a>.class) {
01765                     <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_measurement.html">Measurement</a>().run();
01766                 }
01767             }
01768         } <span class="keywordflow">catch</span> (Exception e) {
01769             e.printStackTrace();
01770         }
01771         setState(IDLE);
01772     }
01773 
<a name="l01778"></a><a class="code" href="classikayaki_1_1_project.html#a51">01778</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isDegaussingEnabled() {
01779         <span class="keywordflow">if</span> (type == CALIBRATION || type == THELLIER || type == THERMAL) {
01780             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01781         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == AF) {
01782             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01783         } <span class="keywordflow">else</span> {
01784             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01785         }
01786     }
01787 
<a name="l01792"></a><a class="code" href="classikayaki_1_1_project.html#a52">01792</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isSequenceEditEnabled() {
01793         <span class="keywordflow">if</span> (type == CALIBRATION) {
01794             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01795         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == AF || type == THELLIER || type == THERMAL) {
01796             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01797         } <span class="keywordflow">else</span> {
01798             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01799         }
01800     }
01801 
<a name="l01806"></a><a class="code" href="classikayaki_1_1_project.html#a53">01806</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isManualControlEnabled() {
01807         <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
01808             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01809         }
01810         <span class="keywordflow">if</span> (getState() == IDLE) {
01811             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01812         } <span class="keywordflow">else</span> {
01813             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01814         }
01815     }
01816 
<a name="l01821"></a><a class="code" href="classikayaki_1_1_project.html#a54">01821</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isAutoStepEnabled() {
01822         <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; !DEBUG) {
01823             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01824         }
01825         <span class="keywordflow">if</span> (type == CALIBRATION || type == THELLIER || type == THERMAL) {
01826             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01827         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == AF) {
01828             <span class="keywordflow">if</span> (getState() == IDLE) {
01829                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01830             } <span class="keywordflow">else</span> {
01831                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01832             }
01833         } <span class="keywordflow">else</span> {
01834             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01835         }
01836     }
01837 
<a name="l01842"></a><a class="code" href="classikayaki_1_1_project.html#a55">01842</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isSingleStepEnabled() {
01843         <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; !DEBUG) {
01844             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01845         }
01846         <span class="keywordflow">if</span> (type == CALIBRATION || type == AF || type == THELLIER || type == THERMAL) {
01847             <span class="keywordflow">if</span> (getState() == IDLE) {
01848                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01849             } <span class="keywordflow">else</span> {
01850                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01851             }
01852         } <span class="keywordflow">else</span> {
01853             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01854         }
01855     }
01856 
<a name="l01861"></a><a class="code" href="classikayaki_1_1_project.html#a56">01861</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isPauseEnabled() {
01862         <span class="keywordflow">if</span> (type == CALIBRATION || type == THELLIER || type == THERMAL) {
01863             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01864         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == AF) {
01865             <span class="keywordflow">if</span> (getState() == MEASURING) {
01866                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
01867             } <span class="keywordflow">else</span> {
01868                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01869             }
01870         } <span class="keywordflow">else</span> {
01871             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01872         }
01873     }
01874 
<a name="l01879"></a><a class="code" href="classikayaki_1_1_project.html#a57">01879</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> isAbortEnabled() {
01880         <span class="keywordflow">if</span> (getState() == MEASURING || getState() == PAUSED) {
01881             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01882         } <span class="keywordflow">else</span> {
01883             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01884         }
01885     }
01886 
<a name="l01896"></a><a class="code" href="classikayaki_1_1_project.html#a58">01896</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doAutoStep() {
01897         <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; !DEBUG) {
01898             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01899         }
01900         <span class="keywordflow">if</span> (getState() == IDLE) {
01901             <span class="keywordflow">if</span> (isAutoStepEnabled()) {
01902                 setState(MEASURING);
01903             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isSingleStepEnabled()) {
01904                 setState(PAUSED);
01905             } <span class="keywordflow">else</span> {
01906                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
01907             }
01908 
01909             <span class="comment">// if there are no unmeasured steps, add one for a measurement without demagnetization</span>
01910             <span class="keywordflow">if</span> (getSteps() == getCompletedSteps()) {
01911                 addStep(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<span class="keyword">this</span>));
01912             }
01913 
01914             <span class="keyword">new</span> Thread() {
01915                 @Override <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
01916                     runMeasurement();
01917                 }
01918             }.start();
01919             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01920         } <span class="keywordflow">else</span> {
01921             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01922         }
01923     }
01924 
<a name="l01932"></a><a class="code" href="classikayaki_1_1_project.html#a59">01932</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doSingleStep() {
01933         <span class="keywordflow">if</span> (!isSingleStepEnabled()) {
01934             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01935         }
01936 
01937         <span class="keywordflow">if</span> (doAutoStep()) {
01938             <span class="keywordflow">return</span> doPause();
01939         } <span class="keywordflow">else</span> {
01940             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01941         }
01942     }
01943 
<a name="l01953"></a><a class="code" href="classikayaki_1_1_project.html#a60">01953</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doPause() {
01954 <span class="comment">//        if (!isPauseEnabled()) {</span>
01955 <span class="comment">//            return false; // will cause problems when singlestepping non-AF projects</span>
01956 <span class="comment">//        }</span>
01957         <span class="keywordflow">if</span> (getState() == IDLE) {
01958             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01959         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getState() == MEASURING) {
01960             setState(PAUSED);
01961             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01962         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getState() == PAUSED) {
01963             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01964         } <span class="keywordflow">else</span> {
01965             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01966         }
01967     }
01968 
<a name="l01977"></a><a class="code" href="classikayaki_1_1_project.html#a61">01977</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doAbort() {
01978         <span class="keywordflow">if</span> (!isAbortEnabled()) {
01979             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01980         }
01981         <span class="keywordflow">if</span> (getState() == IDLE) {
01982             <span class="keywordflow">return</span> <span class="keyword">false</span>;
01983         } <span class="keywordflow">else</span> {
01984             setState(ABORTED);
01985             <span class="keywordflow">return</span> <span class="keyword">true</span>;
01986         }
01987     }
01988 
<a name="l01997"></a><a class="code" href="classikayaki_1_1_project.html#d5">01997</a>     <span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMove(ManualMovePosition position) {
01998         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
01999             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02000         }
02001         setState(PAUSED);
02002         <span class="keyword">new</span> Thread(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_move.html">ManualMove</a>(position)).start();
02003         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02004     }
02005 
<a name="l02013"></a><a class="code" href="classikayaki_1_1_project.html#a62">02013</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveDegausserY() {
02014         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.DEGAUSSER_Y);
02015     }
02016 
<a name="l02024"></a><a class="code" href="classikayaki_1_1_project.html#a63">02024</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveDegausserZ() {
02025         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.DEGAUSSER_Z);
02026     }
02027 
<a name="l02035"></a><a class="code" href="classikayaki_1_1_project.html#a64">02035</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveBackground() {
02036         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.BACKGROUND);
02037     }
02038 
<a name="l02046"></a><a class="code" href="classikayaki_1_1_project.html#a65">02046</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveMeasurement() {
02047         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.MEASUREMENT);
02048     }
02049 
<a name="l02058"></a><a class="code" href="classikayaki_1_1_project.html#a66">02058</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveHome() {
02059         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.HOME);
02060     }
02061 
<a name="l02070"></a><a class="code" href="classikayaki_1_1_project.html#a67">02070</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveRightLimit() {
02071         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.RIGHT_LIMIT);
02072     }
02073 
<a name="l02082"></a><a class="code" href="classikayaki_1_1_project.html#a68">02082</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMoveLeftLimit() {
02083         <span class="keywordflow">return</span> doManualMove(ManualMovePosition.LEFT_LIMIT);
02084     }
02085 
02086 
<a name="l02095"></a><a class="code" href="classikayaki_1_1_project.html#a69">02095</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualRotate(<span class="keywordtype">int</span> angle) {
02096         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02097             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02098         }
02099         setState(PAUSED);
02100         <span class="keyword">new</span> Thread(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html">ManualRotate</a>(angle)).start();
02101         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02102     }
02103 
<a name="l02112"></a><a class="code" href="classikayaki_1_1_project.html#a70">02112</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualMeasure() {
02113         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02114             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02115         }
02116         setState(PAUSED);
02117         <span class="keyword">new</span> Thread(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_measure.html">ManualMeasure</a>()).start();
02118         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02119     }
02120 
02121     <span class="comment">// TODO: is this comment even close?</span>
<a name="l02129"></a><a class="code" href="classikayaki_1_1_project.html#a71">02129</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualReset() {
02130         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02131             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02132         }
02133         setState(PAUSED);
02134         <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {
02135             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02136                 <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02137                     <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02138                 }
02139                 <span class="comment">// TODO: these should be in one Magnetometer method</span>
02140                 getSquid().getMagnetometer().pulseReset(<span class="charliteral">'A'</span>);
02141                 getSquid().getMagnetometer().clearFlux(<span class="charliteral">'A'</span>);
02142                 setState(IDLE);
02143             }
02144         }).start();
02145         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02146     }
02147 
<a name="l02157"></a><a class="code" href="classikayaki_1_1_project.html#a72">02157</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualDemagZ(<span class="keywordtype">double</span> amplitude) {
02158         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02159             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02160         }
02161         setState(PAUSED);
02162         <span class="keyword">new</span> Thread(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html">ManualDemag</a>(ManualDemagAxel.Z, amplitude)).start();
02163         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02164     }
02165 
<a name="l02175"></a><a class="code" href="classikayaki_1_1_project.html#a73">02175</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualDemagY(<span class="keywordtype">double</span> amplitude) {
02176         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02177             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02178         }
02179         setState(PAUSED);
02180         <span class="keyword">new</span> Thread(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html">ManualDemag</a>(ManualDemagAxel.Y, amplitude)).start();
02181         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02182     }
02183 
<a name="l02191"></a><a class="code" href="classikayaki_1_1_project.html#a74">02191</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> doManualStepDone() {
02192         <span class="keywordflow">if</span> (!isManualControlEnabled()) {
02193             <span class="keywordflow">return</span> <span class="keyword">false</span>;
02194         }
02195         <span class="keywordflow">if</span> (currentStep != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02196             currentStep.setDone();
02197             fireMeasurementEvent(currentStep, STEP_END);
02198             currentStep = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
02199         }
02200         <span class="keywordflow">return</span> <span class="keyword">true</span>;
02201     }
02202 
<a name="l02206"></a><a class="code" href="classikayaki_1_1_project.html#w5">02206</a>     <span class="keyword">public</span> <span class="keyword">enum</span> Type {
02207         CALIBRATION(<span class="stringliteral">"Calibration"</span>), AF(<span class="stringliteral">"AF"</span>), THELLIER(<span class="stringliteral">"Thellier"</span>), THERMAL(<span class="stringliteral">"Thermal"</span>);
02208 
02209         <span class="keyword">private</span> String name;
02210 
02211         <span class="keyword">private</span> Type(String name) {
02212             <span class="keyword">this</span>.name = name;
02213         }
02214 
02215         @Override <span class="keyword">public</span> String toString() {
02216             <span class="keywordflow">return</span> name;
02217         }
02218     }
02219 
<a name="l02223"></a><a class="code" href="classikayaki_1_1_project.html#w6">02223</a>     <span class="keyword">public</span> <span class="keyword">enum</span> State {
02224         IDLE, MEASURING, PAUSED, ABORTED
02225     }
02226 
<a name="l02230"></a><a class="code" href="classikayaki_1_1_project.html#w7">02230</a>     <span class="keyword">public</span> <span class="keyword">enum</span> SampleType {
02231         CORE, HAND
02232     }
02233 
<a name="l02237"></a><a class="code" href="classikayaki_1_1_project.html#w8">02237</a>     <span class="keyword">public</span> <span class="keyword">enum</span> Orientation {
02238         PLUS_Z, MINUS_Z
02239     }
02240 
<a name="l02244"></a><a class="code" href="classikayaki_1_1_project.html#w9">02244</a>     <span class="keyword">public</span> <span class="keyword">enum</span> Normalization {
02245         <a class="code" href="namespaceikayaki_1_1gui.html#a26a10">VOLUME</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a11">MASS</a>
02246     }
02247 
<a name="l02252"></a><a class="code" href="classikayaki_1_1_project_1_1_measurement.html">02252</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_measurement.html">Measurement</a> <span class="keyword">implements</span> Runnable {
<a name="l02253"></a><a class="code" href="classikayaki_1_1_project_1_1_measurement.html#a0">02253</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02254             <span class="keywordflow">if</span> (getState() == IDLE) {
02255                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02256             }
02257             <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02258                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02259             }
02260 
02261             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = getCompletedSteps(); i &lt; getSteps(); i++) {
02262 
02263                 <span class="comment">// begin measuring the first uncomplete step</span>
02264                 currentStep = getStep(i);
02265                 currentStep.setMeasuring();
02266                 fireMeasurementEvent(currentStep, STEP_START);
02267 
02268                 <span class="keywordflow">try</span> {
02269                     <span class="comment">// reset the equipment</span>
02270                     <span class="keywordflow">if</span> (getSquid().getHandler().getRotation() != 0) {
02271                         getSquid().getHandler().rotateTo(0);
02272                         getSquid().getHandler().join();
02273                     }
02274                     checkAborted();
02275 
02276                     <span class="comment">// demagnetizing</span>
02277                     <span class="keywordflow">if</span> (currentStep.getStepValue() &gt; 0.05 &amp;&amp; isDegaussingEnabled()) {
02278 
02279                         <span class="comment">// demagnetize Z</span>
02280                         getSquid().getHandler().moveToDegausserZ();
02281                         fireMeasurementEvent(currentStep, HANDLER_MOVE);
02282                         getSquid().getHandler().join();
02283                         fireMeasurementEvent(currentStep, HANDLER_STOP);
02284                         checkAborted();
02285                         fireMeasurementEvent(currentStep, DEMAGNETIZE_START);
02286                         <span class="keywordflow">if</span> (!getSquid().getDegausser().demagnetizeZ(currentStep.getStepValue())) {
02287                             <span class="keywordflow">throw</span> <span class="keyword">new</span> InterruptedException(<span class="stringliteral">"demagnetizeZ = false"</span>);
02288                         }
02289                         fireMeasurementEvent(currentStep, DEMAGNETIZE_END);
02290                         checkAborted();
02291 
02292                         <span class="comment">// demagnetize Y</span>
02293                         getSquid().getHandler().moveToDegausserY();
02294                         fireMeasurementEvent(currentStep, HANDLER_MOVE);
02295                         getSquid().getHandler().join();
02296                         fireMeasurementEvent(currentStep, HANDLER_STOP);
02297                         checkAborted();
02298                         fireMeasurementEvent(currentStep, DEMAGNETIZE_START);
02299                         <span class="keywordflow">if</span> (!getSquid().getDegausser().demagnetizeY(currentStep.getStepValue())) {
02300                             <span class="keywordflow">throw</span> <span class="keyword">new</span> InterruptedException(<span class="stringliteral">"demagnetizeY = false"</span>);
02301                         }
02302                         fireMeasurementEvent(currentStep, DEMAGNETIZE_END);
02303                         checkAborted();
02304 
02305                         <span class="comment">// demagnetize X</span>
02306                         getSquid().getHandler().rotateTo(90);
02307                         fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02308                         getSquid().getHandler().join();
02309                         fireMeasurementEvent(currentStep, HANDLER_STOP);
02310                         checkAborted();
02311                         fireMeasurementEvent(currentStep, DEMAGNETIZE_START);
02312                         <span class="keywordflow">if</span> (!getSquid().getDegausser().demagnetizeY(currentStep.getStepValue())) {
02313                             <span class="keywordflow">throw</span> <span class="keyword">new</span> InterruptedException(<span class="stringliteral">"demagnetizeY = false"</span>);
02314                         }
02315                         fireMeasurementEvent(currentStep, DEMAGNETIZE_END);
02316                         checkAborted();
02317                         getSquid().getHandler().rotateTo(0);
02318                         fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02319                         getSquid().getHandler().join();
02320                         fireMeasurementEvent(currentStep, HANDLER_STOP);
02321                         checkAborted();
02322                     }
02323 
02324                     <span class="comment">// measure first background noise</span>
02325                     getSquid().getHandler().moveToBackground();
02326                     fireMeasurementEvent(currentStep, HANDLER_MOVE);
02327                     getSquid().getHandler().join();
02328                     fireMeasurementEvent(currentStep, HANDLER_STOP);
02329                     checkAborted();
02330                     <span class="comment">// Begin by pulsing feedback loop for each axis And by clearing flux counter for each axis</span>
02331                     <span class="comment">// TODO: these should be in one Magnetometer method</span>
02332                     getSquid().getMagnetometer().pulseReset(<span class="charliteral">'A'</span>);
02333                     getSquid().getMagnetometer().clearFlux(<span class="charliteral">'A'</span>);
02334                     <span class="keywordtype">double</span>[] results = getSquid().getMagnetometer().readData();
02335                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(NOISE, 0, results[0], results[1], results[2]));
02336                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02337                     checkAborted();
02338 
02339                     <span class="comment">// begin measuring the sample</span>
02340                     getSquid().getHandler().moveToMeasurement();
02341                     fireMeasurementEvent(currentStep, HANDLER_MOVE);
02342                     getSquid().getHandler().join();
02343                     fireMeasurementEvent(currentStep, HANDLER_STOP);
02344                     checkAborted();
02345 
02346                     <span class="comment">// measure with the set amount of handler rotations</span>
02347                     <span class="keywordtype">int</span> rotations = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getMeasurementRotations();
02348                     <span class="keywordflow">if</span> (rotations == 0) {
02349 
02350                         <span class="comment">// quick measure with no rotations</span>
02351                         results = getSquid().getMagnetometer().readData();
02352                         currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 0, results[0], results[1], results[2]));
02353                         fireMeasurementEvent(currentStep, VALUE_MEASURED);
02354                         checkAborted();
02355 
02356                     } <span class="keywordflow">else</span> {
02357 
02358                         <span class="comment">// accurate measure with rotations</span>
02359                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; rotations; j++) {
02360 
02361                             <span class="comment">// measure at 0 degrees</span>
02362                             results = getSquid().getMagnetometer().readData();
02363                             currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 0, results[0], results[1], results[2]));
02364                             fireMeasurementEvent(currentStep, VALUE_MEASURED);
02365                             checkAborted();
02366 
02367                             <span class="comment">// measure at 90 degrees</span>
02368                             getSquid().getHandler().rotateTo(90);
02369                             fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02370                             getSquid().getHandler().join();
02371                             fireMeasurementEvent(currentStep, HANDLER_STOP);
02372                             checkAborted();
02373                             results = getSquid().getMagnetometer().readData();
02374                             currentStep.addResult(
02375                                     <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 90, results[0], results[1], results[2]));
02376                             fireMeasurementEvent(currentStep, VALUE_MEASURED);
02377                             checkAborted();
02378 
02379                             <span class="comment">// measure at 180 degrees</span>
02380                             getSquid().getHandler().rotateTo(180);
02381                             fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02382                             getSquid().getHandler().join();
02383                             fireMeasurementEvent(currentStep, HANDLER_STOP);
02384                             checkAborted();
02385                             results = getSquid().getMagnetometer().readData();
02386                             currentStep.addResult(
02387                                     <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 180, results[0], results[1], results[2]));
02388                             fireMeasurementEvent(currentStep, VALUE_MEASURED);
02389                             checkAborted();
02390 
02391                             <span class="comment">// measure at 270 degrees</span>
02392                             getSquid().getHandler().rotateTo(270);
02393                             fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02394                             getSquid().getHandler().join();
02395                             fireMeasurementEvent(currentStep, HANDLER_STOP);
02396                             checkAborted();
02397                             results = getSquid().getMagnetometer().readData();
02398                             currentStep.addResult(
02399                                     <span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 270, results[0], results[1], results[2]));
02400                             fireMeasurementEvent(currentStep, VALUE_MEASURED);
02401                             checkAborted();
02402 
02403                             <span class="comment">// rotate the handler back to 0 degrees</span>
02404                             getSquid().getHandler().rotateTo(0);
02405                             fireMeasurementEvent(currentStep, HANDLER_ROTATE);
02406                             getSquid().getHandler().join();
02407                             fireMeasurementEvent(currentStep, HANDLER_STOP);
02408                             checkAborted();
02409                         }
02410                     }
02411 
02412                     <span class="comment">// measure second background noise</span>
02413                     getSquid().getHandler().moveToBackground();
02414                     fireMeasurementEvent(currentStep, HANDLER_MOVE);
02415                     getSquid().getHandler().join();
02416                     fireMeasurementEvent(currentStep, HANDLER_STOP);
02417                     checkAborted();
02418                     results = getSquid().getMagnetometer().readData();
02419                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(NOISE, 0, results[0], results[1], results[2]));
02420                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02421                     checkAborted();
02422 
02423                 } <span class="keywordflow">catch</span> (InterruptedException e) {
02424 
02425                     <span class="comment">// the measurement was aborted or some error occurred</span>
02426                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02427                         System.err.println(e.getMessage());
02428                     } <span class="keywordflow">else</span> {
02429                         e.printStackTrace();
02430                     }
02431                 } <span class="keywordflow">catch</span> (IllegalStateException e) {
02432                     e.printStackTrace();
02433                 } finally {
02434 
02435                     <span class="comment">// complete the step</span>
02436                     currentStep.setDone();
02437                     fireMeasurementEvent(currentStep, STEP_END);
02438                     currentStep = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
02439                 }
02440 
02441                 <span class="keywordflow">if</span> (getState() == PAUSED || getState() == ABORTED) {
02442                     setState(IDLE);
02443                     <span class="keywordflow">return</span>;
02444                 }
02445             }
02446             setState(IDLE);
02447         }
02448 
<a name="l02455"></a><a class="code" href="classikayaki_1_1_project_1_1_measurement.html#d0">02455</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> checkAborted() throws InterruptedException {
02456             <span class="keywordflow">if</span> (getState() == ABORTED) {
02457                 fireMeasurementEvent(currentStep, STEP_ABORTED);
02458                 <span class="keywordflow">throw</span> <span class="keyword">new</span> InterruptedException(<span class="stringliteral">"Measurement aborted"</span>);
02459             }
02460         }
02461     }
02462 
<a name="l02467"></a><a class="code" href="classikayaki_1_1_project_1_1_dummy_measurement.html">02467</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_dummy_measurement.html">DummyMeasurement</a> <span class="keyword">implements</span> Runnable {
<a name="l02468"></a><a class="code" href="classikayaki_1_1_project_1_1_dummy_measurement.html#a0">02468</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02469             <span class="keywordflow">if</span> (getState() == IDLE) {
02470                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02471             }
02472 
02473             System.out.println(<span class="stringliteral">"Measurement started"</span>);
02474             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = getCompletedSteps(); i &lt; getSteps(); i++) {
02475 
02476                 System.out.println(<span class="stringliteral">"Measuring step "</span> + i + <span class="stringliteral">"..."</span>);
02477                 currentStep = getStep(i);
02478                 currentStep.setMeasuring();
02479                 fireMeasurementEvent(currentStep, STEP_START);
02480 
02481                 <span class="keywordflow">try</span> {
02482                     <span class="comment">// measure BG (1)</span>
02483                     Thread.sleep(500);
02484                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02485                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02486                         setState(IDLE);
02487                         <span class="keywordflow">return</span>;
02488                     }
02489                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(NOISE, 0,
02490                             Math.random() * 0.000001, Math.random() * 0.000001, Math.random() * 0.000001));
02491                     System.out.println(<span class="stringliteral">"Result added"</span>);
02492                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02493 
02494                     <span class="comment">// measure DEG0</span>
02495                     Thread.sleep(500);
02496                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02497                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02498                         setState(IDLE);
02499                         currentStep.setDone();
02500                         <span class="keywordflow">return</span>;
02501                     }
02502                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 0,
02503                             Math.random() * 0.0001, Math.random() * 0.0001, Math.random() * 0.0001));
02504                     System.out.println(<span class="stringliteral">"Result added"</span>);
02505                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02506 
02507                     <span class="comment">// measure DEG90</span>
02508                     Thread.sleep(500);
02509                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02510                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02511                         setState(IDLE);
02512                         currentStep.setDone();
02513                         <span class="keywordflow">return</span>;
02514                     }
02515                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 90,
02516                             Math.random() * 0.0001, Math.random() * 0.0001, Math.random() * 0.0001));
02517                     System.out.println(<span class="stringliteral">"Result added"</span>);
02518                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02519 
02520                     <span class="comment">// measure DEG180</span>
02521                     Thread.sleep(500);
02522                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02523                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02524                         setState(IDLE);
02525                         currentStep.setDone();
02526                         <span class="keywordflow">return</span>;
02527                     }
02528                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 180,
02529                             Math.random() * 0.0001, Math.random() * 0.0001, Math.random() * 0.0001));
02530                     System.out.println(<span class="stringliteral">"Result added"</span>);
02531                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02532 
02533                     <span class="comment">// measure DEG270</span>
02534                     Thread.sleep(500);
02535                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02536                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02537                         setState(IDLE);
02538                         currentStep.setDone();
02539                         <span class="keywordflow">return</span>;
02540                     }
02541                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(SAMPLE, 270,
02542                             Math.random() * 0.0001, Math.random() * 0.0001, Math.random() * 0.0001));
02543                     System.out.println(<span class="stringliteral">"Result added"</span>);
02544                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02545 
02546                     <span class="comment">// measure BG (2)</span>
02547                     Thread.sleep(500);
02548                     <span class="keywordflow">if</span> (getState() == ABORTED) {
02549                         System.out.println(<span class="stringliteral">"Measurement aborted"</span>);
02550                         setState(IDLE);
02551                         currentStep.setDone();
02552                         <span class="keywordflow">return</span>;
02553                     }
02554                     currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(NOISE, 0,
02555                             Math.random() * 0.000001, Math.random() * 0.000001, Math.random() * 0.000001));
02556                     System.out.println(<span class="stringliteral">"Result added"</span>);
02557                     fireMeasurementEvent(currentStep, VALUE_MEASURED);
02558 
02559                 } <span class="keywordflow">catch</span> (InterruptedException e) {
02560                     e.printStackTrace();
02561                 } finally {
02562                     <span class="comment">// complete step</span>
02563                     currentStep.setDone();
02564                     System.out.println(<span class="stringliteral">"Step "</span> + i + <span class="stringliteral">" completed"</span>);
02565                     fireMeasurementEvent(currentStep, STEP_END);
02566                     currentStep = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
02567                 }
02568 
02569                 <span class="keywordflow">if</span> (getState() == PAUSED) {
02570                     System.out.println(<span class="stringliteral">"Measurement ended (paused)"</span>);
02571                     setState(IDLE);
02572                     <span class="keywordflow">return</span>;
02573                 }
02574             }
02575             System.out.println(<span class="stringliteral">"Measurement ended"</span>);
02576             setState(IDLE);
02577         }
02578     }
02579 
<a name="l02580"></a><a class="code" href="classikayaki_1_1_project.html#y2">02580</a>     <span class="keyword">private</span> <span class="keyword">enum</span> ManualMovePosition {
02581         DEGAUSSER_Y,
02582         DEGAUSSER_Z,
02583         BACKGROUND,
02584         MEASUREMENT,
02585         HOME,
02586         RIGHT_LIMIT,
02587         LEFT_LIMIT
02588     }
02589 
<a name="l02593"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_move.html">02593</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_manual_move.html">ManualMove</a> <span class="keyword">implements</span> Runnable {
02594 
<a name="l02595"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_move.html#r0">02595</a>         <span class="keyword">private</span> ManualMovePosition pos;
02596 
<a name="l02597"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_move.html#a0">02597</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_move.html">ManualMove</a>(ManualMovePosition pos) {
02598             <span class="keyword">this</span>.pos = pos;
02599         }
02600 
<a name="l02601"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_move.html#a1">02601</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02602             <span class="keywordflow">if</span> (getState() == IDLE) {
02603                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02604             }
02605             <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02606                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02607             }
02608 
02609             <span class="keywordflow">switch</span> (pos) {
02610             <span class="keywordflow">case</span> DEGAUSSER_Y:
02611                 getSquid().getHandler().moveToDegausserY();
02612                 <span class="keywordflow">break</span>;
02613             <span class="keywordflow">case</span> DEGAUSSER_Z:
02614                 getSquid().getHandler().moveToDegausserZ();
02615                 <span class="keywordflow">break</span>;
02616             <span class="keywordflow">case</span> BACKGROUND:
02617                 getSquid().getHandler().moveToBackground();
02618                 <span class="keywordflow">break</span>;
02619             <span class="keywordflow">case</span> MEASUREMENT:
02620                 getSquid().getHandler().moveToMeasurement();
02621                 <span class="keywordflow">break</span>;
02622             <span class="keywordflow">case</span> HOME:
02623                 getSquid().getHandler().moveToSampleLoad();
02624                 <span class="keywordflow">break</span>;
02625             <span class="keywordflow">case</span> RIGHT_LIMIT:
02626                 getSquid().getHandler().moveToRightLimit();
02627                 <span class="keywordflow">break</span>;
02628             <span class="keywordflow">case</span> LEFT_LIMIT:
02629                 getSquid().getHandler().moveToLeftLimit();
02630                 <span class="keywordflow">break</span>;
02631             <span class="keywordflow">default</span>:
02632                 System.err.println(<span class="stringliteral">"Invalid pos: "</span> + pos);
02633                 assert <span class="keyword">false</span>;
02634                 <span class="keywordflow">break</span>;
02635             }
02636             fireMeasurementEvent(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, HANDLER_MOVE);
02637 
02638             <span class="keywordflow">try</span> {
02639                 getSquid().getHandler().join();
02640             } <span class="keywordflow">catch</span> (InterruptedException e) {
02641                 e.printStackTrace();
02642             }
02643             fireMeasurementEvent(null, HANDLER_STOP);
02644             setState(IDLE);
02645         }
02646     }
02647 
<a name="l02651"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html">02651</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html">ManualRotate</a> <span class="keyword">implements</span> Runnable {
02652 
<a name="l02653"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html#r0">02653</a>         <span class="keyword">private</span> <span class="keywordtype">int</span> angle;
02654 
<a name="l02655"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html#a0">02655</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html">ManualRotate</a>(<span class="keywordtype">int</span> angle) {
02656             <span class="keyword">this</span>.angle = angle;
02657         }
02658 
<a name="l02659"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_rotate.html#a1">02659</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02660             <span class="keywordflow">if</span> (getState() == IDLE) {
02661                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02662             }
02663             <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02664                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02665             }
02666 
02667             getSquid().getHandler().rotateTo(angle);
02668             fireMeasurementEvent(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, HANDLER_ROTATE);
02669 
02670             <span class="keywordflow">try</span> {
02671                 getSquid().getHandler().join();
02672             } <span class="keywordflow">catch</span> (InterruptedException e) {
02673                 e.printStackTrace();
02674             }
02675             fireMeasurementEvent(null, HANDLER_STOP);
02676 
02677             setState(IDLE);
02678         }
02679     }
02680 
<a name="l02685"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_measure.html">02685</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_manual_measure.html">ManualMeasure</a> <span class="keyword">implements</span> Runnable {
<a name="l02686"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_measure.html#a0">02686</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02687             <span class="keywordflow">if</span> (getState() == IDLE) {
02688                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02689             }
02690             <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02691                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException();
02692             }
02693 
02694             <span class="comment">// select the first unfinished step or add a new one</span>
02695             <span class="keywordflow">if</span> (currentStep == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02696                 <span class="keywordtype">int</span> i = getCompletedSteps();
02697                 <span class="keywordflow">if</span> (i == getSteps()) {
02698                     addStep(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<a class="code" href="classikayaki_1_1_project.html">Project</a>.this));
02699                 }
02700                 currentStep = getStep(i);
02701                 currentStep.setMeasuring();
02702                 fireMeasurementEvent(currentStep, STEP_START);
02703             }
02704 
02705             <span class="keywordtype">double</span>[] results = getSquid().getMagnetometer().readData();
02706 
02707             <span class="comment">// check where we are</span>
02708             <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>.Type resultType;
02709             <span class="keywordtype">int</span> rotation;
02710             <span class="keywordflow">if</span> (getSquid().getHandler().getPosition() == <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getHandlerMeasurementPosition()) {
02711                 resultType = SAMPLE;
02712                 rotation = getSquid().getHandler().getRotation();
02713             } <span class="keywordflow">else</span> {
02714                 resultType = NOISE;
02715                 rotation = 0;
02716             }
02717             currentStep.addResult(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_result.html">MeasurementResult</a>(resultType, rotation, results[0], results[1], results[2]));
02718             fireMeasurementEvent(currentStep, VALUE_MEASURED);
02719 
02720             setState(IDLE);
02721         }
02722     }
02723 
<a name="l02724"></a><a class="code" href="classikayaki_1_1_project.html#y3">02724</a>     <span class="keyword">private</span> <span class="keyword">enum</span> ManualDemagAxel {
02725         Z,
02726         Y
02727     }
02728 
<a name="l02733"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html">02733</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html">ManualDemag</a> <span class="keyword">implements</span> Runnable {
02734 
<a name="l02735"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html#r0">02735</a>         <span class="keyword">private</span> ManualDemagAxel axel;
<a name="l02736"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html#r1">02736</a>         <span class="keyword">private</span> <span class="keywordtype">double</span> amplitude;
02737 
<a name="l02738"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html#a0">02738</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html">ManualDemag</a>(ManualDemagAxel axel, <span class="keywordtype">double</span> amplitude) {
02739             <span class="keywordflow">if</span> (axel == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02740                 <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
02741             }
02742             <span class="keyword">this</span>.axel = axel;
02743             <span class="keyword">this</span>.amplitude = amplitude;
02744         }
02745 
<a name="l02746"></a><a class="code" href="classikayaki_1_1_project_1_1_manual_demag.html#a1">02746</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
02747             <span class="keywordflow">if</span> (getState() == IDLE) {
02748                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"getState() == IDLE"</span>);
02749             }
02750             <span class="keywordflow">if</span> (getSquid() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02751                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"getSquid() == null"</span>);
02752             }
02753             <span class="keywordflow">if</span> (!isDegaussingEnabled()) {
02754                 <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="stringliteral">"!isDegaussingEnabled()"</span>);
02755             }
02756 
02757             amplitude = Math.max(amplitude, <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumField());
02758             amplitude = Math.min(amplitude, <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMaximumField());
02759 
02760             <span class="comment">// finish any previous measurement</span>
02761             <span class="keywordflow">if</span> (currentStep != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
02762                 currentStep.setDone();
02763                 fireMeasurementEvent(currentStep, STEP_END);
02764                 currentStep = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
02765             }
02766 
02767             <span class="comment">// select the first unfinished step or add a new one</span>
02768             <span class="keywordtype">int</span> i = getCompletedSteps();
02769             <span class="keywordflow">if</span> (i == getSteps()) {
02770                 addStep(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1_measurement_step.html">MeasurementStep</a>(<a class="code" href="classikayaki_1_1_project.html">Project</a>.this));
02771             }
02772             currentStep = getStep(i);
02773             currentStep.setStepValue(amplitude);
02774             currentStep.setMeasuring();
02775             fireMeasurementEvent(currentStep, STEP_START);
02776 
02777             <span class="comment">// demagnetize the sample</span>
02778             fireMeasurementEvent(currentStep, DEMAGNETIZE_START);
02779             <span class="keywordflow">switch</span> (axel) {
02780             <span class="keywordflow">case</span> Y:
02781                 getSquid().getDegausser().demagnetizeY(amplitude);
02782                 <span class="keywordflow">break</span>;
02783             <span class="keywordflow">case</span> Z:
02784                 getSquid().getDegausser().demagnetizeZ(amplitude);
02785                 <span class="keywordflow">break</span>;
02786             <span class="keywordflow">default</span>:
02787                 System.err.println(<span class="stringliteral">"Invalid axel: "</span> + axel);
02788                 assert <span class="keyword">false</span>;
02789                 <span class="keywordflow">break</span>;
02790             }
02791             fireMeasurementEvent(currentStep, DEMAGNETIZE_END);
02792 
02793             setState(IDLE);
02794         }
02795     }
02796 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed May 4 13:11:05 2005 for Squid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
