<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Squid: My Documents/squid/src/ikayaki/squid/Degausser.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">My Documents</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">squid</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ikayaki</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">squid</a></div>
<h1>Degausser.java</h1><a href="_degausser_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Degausser.java</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (C) 2005 Project SQUID, http://www.cs.helsinki.fi/group/squid/</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This file is part of Ikayaki.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * Ikayaki is free software; you can redistribute it and/or modify</span>
00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00011 <span class="comment"> * (at your option) any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Ikayaki is distributed in the hope that it will be useful,</span>
00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
00016 <span class="comment"> * GNU General Public License for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> * along with Ikayaki; if not, write to the Free Software</span>
00020 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
00021 <span class="comment"> */</span>
00022 
<a name="l00023"></a><a class="code" href="namespaceikayaki_1_1squid.html">00023</a> <span class="keyword">package </span>ikayaki.squid;
00024 
00025 <span class="keyword">import</span> ikayaki.Settings;
00026 
00027 <span class="keyword">import</span> java.util.Stack;
00028 <span class="keyword">import</span> java.util.concurrent.SynchronousQueue;
00029 <span class="keyword">import</span> java.util.concurrent.TimeUnit;
00030 
<a name="l00038"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html">00038</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1squid_1_1_degausser.html">Degausser</a> <span class="keyword">implements</span> <a class="code" href="interfaceikayaki_1_1squid_1_1_serial_i_o_listener.html">SerialIOListener</a> {
00039 
<a name="l00043"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r0">00043</a>     <span class="keyword">private</span> Stack&lt;String&gt; <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r0">messageBuffer</a>;
00044 
<a name="l00048"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">00048</a>     <span class="keyword">private</span> SynchronousQueue&lt;String&gt; <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>;
<a name="l00049"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">00049</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a> = 60;
00050 
<a name="l00054"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#p0">00054</a>     <span class="keyword">protected</span> <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html">SerialIO</a> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#p0">serialIO</a>;
00055 
<a name="l00059"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r3">00059</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r3">degausserDelay</a>;
00060 
<a name="l00064"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r4">00064</a>     <span class="keyword">private</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r4">degausserRamp</a>;
00065 
<a name="l00066"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">00066</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
<a name="l00067"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r6">00067</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r6">minimumField</a>;
<a name="l00068"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r7">00068</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r7">maximumField</a>;
00069 
<a name="l00070"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">00070</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a> = <span class="keyword">false</span>;
00071 
<a name="l00076"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a0">00076</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a0">Degausser</a>() throws <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> {
00077         <span class="keyword">this</span>.serialIO = <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html">SerialIO</a>.openPort(<span class="keyword">new</span> <a class="code" href="classikayaki_1_1squid_1_1_serial_parameters.html">SerialParameters</a>(<a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserPort()));
00078         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a3">addSerialIOListener</a>(<span class="keyword">this</span>);
00079         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r0">messageBuffer</a> = <span class="keyword">new</span> Stack&lt;String&gt;();
00080         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a> = <span class="keyword">new</span> SynchronousQueue&lt;String&gt;();
00081         <span class="keyword">this</span>.degausserDelay = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserDelay();
00082         <span class="keyword">this</span>.degausserRamp = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserRamp();
00083         <span class="keyword">this</span>.minimumField = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumField();
00084         <span class="keyword">this</span>.maximumField = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMaximumField();
00085 
00086         <span class="comment">//needs to call new functions setDelay() and setRamp(). TODO</span>
00087         <span class="comment">//TODO: do we need to check values? (original does)</span>
00088         <span class="keywordflow">try</span> {
00089             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCD"</span> + <span class="keyword">this</span>.<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r3">degausserDelay</a>);
00090         } <span class="keywordflow">catch</span> (SerialIOException ex1) {
00091             System.err.println(<span class="stringliteral">"Error using port in degausser:"</span> + ex1);
00092         }
00093         <span class="keywordflow">try</span> {
00094             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCR"</span> + <span class="keyword">this</span>.<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r4">degausserRamp</a>);
00095         } <span class="keywordflow">catch</span> (SerialIOException ex1) {
00096             System.err.println(<span class="stringliteral">"Error using port in degausser:"</span> + ex1);
00097         }
00098     }
00099 
<a name="l00104"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a1">00104</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a1">updateSettings</a>() {
00105         <span class="comment">// No check, only two options. Doesnt matter.</span>
00106         <span class="keyword">this</span>.degausserDelay = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserDelay();
00107         <span class="keyword">this</span>.degausserRamp = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserRamp();
00108         <span class="keyword">this</span>.minimumField = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumField();
00109         <span class="keyword">this</span>.maximumField = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMaximumField();
00110         <span class="keywordflow">try</span> {
00111             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCD"</span> + <span class="keyword">this</span>.<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r3">degausserDelay</a>);
00112         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex1) {
00113             System.err.println(<span class="stringliteral">"Error using port in degausser:"</span> + ex1);
00114         }
00115         <span class="keywordflow">try</span> {
00116             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCR"</span> + <span class="keyword">this</span>.<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r4">degausserRamp</a>);
00117         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> ex1) {
00118             System.err.println(<span class="stringliteral">"Error using port in degausser:"</span> + ex1);
00119         }
00120     }
00121 
<a name="l00127"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b0">00127</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b0">setCoil</a>(<span class="keywordtype">char</span> coil) {
00128         <span class="keywordflow">if</span> (coil == <span class="charliteral">'X'</span> || coil == <span class="charliteral">'Y'</span> || coil == <span class="charliteral">'Z'</span>) {
00129             <span class="keywordflow">try</span> {
00130                 <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCC"</span> + coil);
00131             } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00132                 e.printStackTrace();
00133             }
00134         } <span class="keywordflow">else</span> {
00135             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"coil = "</span> + coil);
00136         }
00137     }
00138 
<a name="l00146"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b1">00146</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b1">setAmplitude</a>(<span class="keywordtype">double</span> amplitude) {
00147         <span class="keywordflow">if</span> (amplitude &gt;= <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r6">minimumField</a> &amp;&amp; amplitude &lt;= <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r7">maximumField</a>) {
00148             <span class="keywordflow">try</span> {
00149                 String amps = Integer.toString((<span class="keywordtype">int</span>) Math.round(amplitude * 10.0));
00150                 <span class="keywordflow">while</span> (amps.length() &lt; 4) {
00151                     amps = <span class="stringliteral">"0"</span> + amps;
00152                 }
00153                 <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DCA"</span> + amps);
00154                 Thread.sleep(1500);     <span class="comment">// needs to wait for the degausser to process the command</span>
00155 
00156             } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00157                 e.printStackTrace();
00158             } <span class="keywordflow">catch</span> (InterruptedException e) {
00159                 e.printStackTrace();
00160             }
00161         } <span class="keywordflow">else</span> {
00162             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"amplitude = "</span> + amplitude);
00163         }
00164     }
00165 
<a name="l00169"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b2">00169</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b2">executeRampUp</a>() {
00170         <span class="keywordflow">try</span> {
00171             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DERU"</span>);
00172         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00173             e.printStackTrace();
00174         }
00175     }
00176 
<a name="l00180"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b3">00180</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b3">executeRampDown</a>() {
00181         <span class="keywordflow">try</span> {
00182             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DERD"</span>);
00183         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00184             e.printStackTrace();
00185         }
00186     }
00187 
<a name="l00191"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b4">00191</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b4">executeRampCycle</a>() {
00192         <span class="keywordflow">try</span> {
00193             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DERC"</span>);
00194         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00195             e.printStackTrace();
00196         }
00197     }
00198 
<a name="l00199"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">00199</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(String command) <span class="keywordflow">throws</span> <a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> {
00200         <span class="keywordflow">try</span> {
00201             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#p0">serialIO</a>.<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o.html#a0">writeMessage</a>(command + <span class="stringliteral">"\r"</span>);
00202 
00203             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00204             String answer = <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.take();
00205             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00206 
00207             <span class="keywordflow">if</span> (!command.equals(answer)) {
00208 <span class="comment">//                for (int i = 0; i &lt; answer.length(); i++) {</span>
00209 <span class="comment">//                    System.out.println((int) answer.charAt(i));</span>
00210 <span class="comment">//                }</span>
00211 <span class="comment">//                throw new IllegalArgumentException("sent: " + command + " recieved: " + answer);</span>
00212                 System.err.println(<span class="stringliteral">"Degausser.blockingWrite() sent: "</span> + command + <span class="stringliteral">" recieved: "</span> + answer);
00213             }
00214 
00215         } <span class="keywordflow">catch</span> (InterruptedException e) {
00216             e.printStackTrace();
00217         }
00218     }
00219 
<a name="l00226"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a2">00226</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a2">demagnetizeZ</a>(<span class="keywordtype">double</span> amp) {
00227         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b1">setAmplitude</a>(amp);
00228         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b0">setCoil</a>(<span class="charliteral">'Z'</span>);
00229         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a> = <span class="keyword">true</span>;
00230         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b4">executeRampCycle</a>();
00231 
00232         <span class="comment">// need to wait for DONE message or TRACK ERROR message</span>
00233         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00234         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00235         <span class="keywordflow">try</span> {
00236             answer = <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.take();
00237         } <span class="keywordflow">catch</span> (InterruptedException e) {
00238             e.printStackTrace();
00239         }
00240         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00241         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a> = <span class="keyword">false</span>;
00242 
00243         <span class="keywordflow">if</span> (answer.equals(<span class="stringliteral">"DONE"</span>)) {
00244             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00245         } <span class="keywordflow">else</span> {
00246             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00247         }
00248 
00249     }
00250 
<a name="l00257"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a3">00257</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a3">demagnetizeY</a>(<span class="keywordtype">double</span> amp) {
00258         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b1">setAmplitude</a>(amp);
00259         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b0">setCoil</a>(<span class="charliteral">'Y'</span>);
00260         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a> = <span class="keyword">true</span>;
00261         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b4">executeRampCycle</a>();
00262 
00263         <span class="comment">// need to wait for DONE message or TRACK ERROR message</span>
00264         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00265         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00266         <span class="keywordflow">try</span> {
00267             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.take();
00268         } <span class="keywordflow">catch</span> (InterruptedException e) {
00269             e.printStackTrace();
00270         }
00271         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00272         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a> = <span class="keyword">false</span>;
00273 
00274         <span class="keywordflow">if</span> (answer.equals(<span class="stringliteral">"DONE"</span>)) {
00275             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00276         } <span class="keywordflow">else</span> {
00277             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00278         }
00279     }
00280 
<a name="l00281"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a4">00281</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a4">isDemagnetizing</a>() {
00282         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r8">demagnetizing</a>;
00283     }
00284 
<a name="l00290"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a5">00290</a>     <span class="keyword">public</span> <span class="keywordtype">char</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a5">getRampStatus</a>() {
00291         <span class="keywordflow">try</span> {
00292             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DSS"</span>);
00293         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00294             e.printStackTrace();
00295         }
00296         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00297         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00298         <span class="keywordflow">try</span> {
00299             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00300         } <span class="keywordflow">catch</span> (InterruptedException e) {
00301             e.printStackTrace();
00302         }
00303         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00304         <span class="keywordflow">return</span> answer.charAt(1);
00305     }
00306 
<a name="l00312"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a6">00312</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a6">getRamp</a>() {
00313         <span class="keywordflow">try</span> {
00314             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DSS"</span>);
00315         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00316             e.printStackTrace();
00317         }
00318         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00319         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00320         <span class="keywordflow">try</span> {
00321             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00322         } <span class="keywordflow">catch</span> (InterruptedException e) {
00323             e.printStackTrace();
00324         }
00325         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00326         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) answer.charAt(4);
00327     }
00328 
<a name="l00334"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a7">00334</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a7">getDelay</a>() {
00335         <span class="keywordflow">try</span> {
00336             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DSS"</span>);
00337         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00338             e.printStackTrace();
00339         }
00340         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00341         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00342         <span class="keywordflow">try</span> {
00343             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00344         } <span class="keywordflow">catch</span> (InterruptedException e) {
00345             e.printStackTrace();
00346         }
00347         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00348         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) answer.charAt(7);
00349     }
00350 
<a name="l00356"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a8">00356</a>     <span class="keyword">public</span> <span class="keywordtype">char</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a8">getCoil</a>() {
00357         <span class="keywordflow">try</span> {
00358             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DSS"</span>);
00359         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00360             e.printStackTrace();
00361         }
00362         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00363         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00364         <span class="keywordflow">try</span> {
00365             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00366         } <span class="keywordflow">catch</span> (InterruptedException e) {
00367             e.printStackTrace();
00368         }
00369         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00370         <span class="keywordflow">return</span> answer.charAt(10);
00371     }
00372 
<a name="l00378"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a9">00378</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a9">getAmplitude</a>() {
00379         <span class="keywordflow">try</span> {
00380             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#b5">blockingWrite</a>(<span class="stringliteral">"DSS"</span>);
00381         } <span class="keywordflow">catch</span> (<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_exception.html">SerialIOException</a> e) {
00382             e.printStackTrace();
00383         }
00384         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">true</span>;
00385         String answer = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00386         <span class="keywordflow">try</span> {
00387             answer = (String) <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.poll(<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r2">pollTimeout</a>, TimeUnit.SECONDS);
00388         } <span class="keywordflow">catch</span> (InterruptedException e) {
00389             e.printStackTrace();
00390         }
00391         <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a> = <span class="keyword">false</span>;
00392 
00393         <span class="keywordflow">return</span> Integer.parseInt(answer.substring(13, 17));
00394     }
00395 
<a name="l00401"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a10">00401</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a10">isOK</a>() {
00402         <span class="keywordflow">if</span> (<span class="keyword">this</span>.<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#p0">serialIO</a> != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00403             <span class="keywordflow">return</span> <span class="keyword">true</span>;
00404         } <span class="keywordflow">else</span> {
00405             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00406         }
00407     }
00408 
<a name="l00409"></a><a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a11">00409</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#a11">serialIOEvent</a>(<a class="code" href="classikayaki_1_1squid_1_1_serial_i_o_event.html">SerialIOEvent</a> event) {
00410         <span class="comment">//TODO: problem when Degausser and Magnetometer uses same port :/</span>
00411         String message = event.getCleanMessage();
00412         <span class="keywordflow">if</span> (message != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00413             <span class="keywordflow">if</span> (<a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r5">waitingForMessage</a>) {
00414                 <span class="keywordflow">try</span> {
00415                     <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r1">queue</a>.put(message);
00416                 } <span class="keywordflow">catch</span> (InterruptedException e) {
00417                     System.err.println(<span class="stringliteral">"Interrupted Degausser message event"</span>);
00418                 } <span class="keywordflow">catch</span> (NullPointerException e) {
00419                     System.err.println(<span class="stringliteral">"Null from SerialEvent in Degausser"</span>);
00420                 }
00421             }
00422             <a class="code" href="classikayaki_1_1squid_1_1_degausser.html#r0">messageBuffer</a>.add(message);
00423         }
00424     }
00425 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed May 4 13:11:05 2005 for Squid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
