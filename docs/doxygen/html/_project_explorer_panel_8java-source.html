<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Squid: My Documents/squid/src/ikayaki/gui/ProjectExplorerPanel.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">My Documents</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">squid</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ikayaki</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">gui</a></div>
<h1>ProjectExplorerPanel.java</h1><a href="_project_explorer_panel_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * ProjectExplorerPanel.java</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (C) 2005 Project SQUID, http://www.cs.helsinki.fi/group/squid/</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This file is part of Ikayaki.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * Ikayaki is free software; you can redistribute it and/or modify</span>
00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00011 <span class="comment"> * (at your option) any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Ikayaki is distributed in the hope that it will be useful,</span>
00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
00016 <span class="comment"> * GNU General Public License for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> * along with Ikayaki; if not, write to the Free Software</span>
00020 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="keyword">package </span>ikayaki.gui;
00024 
00025 <span class="keyword">import</span> ikayaki.Ikayaki;
00026 <span class="keyword">import</span> ikayaki.Project;
00027 <span class="keyword">import</span> ikayaki.Settings;
00028 <span class="keyword">import</span> ikayaki.util.LastExecutor;
00029 
00030 <span class="keyword">import</span> javax.swing.*;
00031 <span class="keyword">import</span> javax.swing.event.PopupMenuEvent;
00032 <span class="keyword">import</span> javax.swing.event.PopupMenuListener;
00033 <span class="keyword">import</span> java.awt.*;
00034 <span class="keyword">import</span> java.awt.event.ActionEvent;
00035 <span class="keyword">import</span> java.awt.event.ActionListener;
00036 <span class="keyword">import</span> java.awt.event.KeyAdapter;
00037 <span class="keyword">import</span> java.awt.event.KeyEvent;
00038 <span class="keyword">import</span> java.io.File;
00039 <span class="keyword">import</span> java.io.FileFilter;
00040 <span class="keyword">import</span> java.util.Arrays;
00041 
<a name="l00050"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html">00050</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html">ProjectExplorerPanel</a> <span class="keyword">extends</span> <a class="code" href="classikayaki_1_1gui_1_1_project_component.html">ProjectComponent</a> {
<a name="l00054"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r0">00054</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1gui_1_1_project_component.html">ProjectComponent</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r0">parent</a>;
00055 
<a name="l00059"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">00059</a>     <span class="keyword">private</span> <span class="keyword">final</span> JPanel <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">browsePanel</a> = <span class="keyword">new</span> JPanel();
00060 
<a name="l00066"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">00066</a>     <span class="keyword">private</span> <span class="keyword">final</span> JComboBox <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>;
<a name="l00067"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r3">00067</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1gui_1_1_fitted_combo_box_renderer.html">FittedComboBoxRenderer</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r3">browserFieldRenderer</a>;
<a name="l00068"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r4">00068</a>     <span class="keyword">private</span> <span class="keyword">final</span> JTextField <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r4">browserFieldEditor</a>; <span class="comment">// WARNING: look-and-feel-dependant code</span>
<a name="l00069"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r5">00069</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r5">browserFieldFlasher</a>;
00070 
<a name="l00074"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#q0">00074</a>     <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#q0">browserFieldPopupIsAutocomplete</a> = <span class="keyword">false</span>;
00075 
00079     <span class="comment">// private boolean browserFieldNextPopupIsAutocomplete = false;</span>
00080 
<a name="l00084"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#q1">00084</a>     <span class="keywordtype">boolean</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#q1">browserFieldUpdatingPopup</a> = <span class="keyword">false</span>;
00085 
<a name="l00086"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">00086</a>     <span class="keyword">private</span> <span class="keyword">final</span> JButton <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">browseButton</a>;
00087 
<a name="l00088"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r7">00088</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_table.html">ProjectExplorerTable</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r7">explorerTable</a>;
<a name="l00089"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r8">00089</a>     <span class="keyword">private</span> <span class="keyword">final</span> JScrollPane <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r8">explorerTableScrollPane</a>;
00090 
<a name="l00091"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r9">00091</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html">NewProjectPanel</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r9">newProjectPanel</a>;
00092 
<a name="l00096"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r10">00096</a>     <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1util_1_1_last_executor.html">LastExecutor</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r10">autocompleteExecutor</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1util_1_1_last_executor.html">LastExecutor</a>(100, <span class="keyword">true</span>);
00097 
<a name="l00101"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r11">00101</a>     <span class="keyword">private</span> File <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r11">directory</a> = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00102 
<a name="l00108"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#a0">00108</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#a0">ProjectExplorerPanel</a>(<a class="code" href="classikayaki_1_1gui_1_1_project_component.html">ProjectComponent</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r0">parent</a>) {
00109         <span class="keyword">this</span>(parent, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00110     }
00111 
<a name="l00119"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#a1">00119</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#a0">ProjectExplorerPanel</a>(<a class="code" href="classikayaki_1_1gui_1_1_project_component.html">ProjectComponent</a> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r0">parent</a>, <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="classikayaki_1_1gui_1_1_project_component.html#r0">project</a>) {
00120         <span class="keyword">this</span>.parent = parent;
00121 
00122         <span class="comment">// combo box / text field</span>
00123         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a> = <span class="keyword">new</span> JComboBox(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d1">getDirectoryHistory</a>());
00124         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>.setEditable(<span class="keyword">true</span>);
00125         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>.setBackground(Color.WHITE);
00126         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r4">browserFieldEditor</a> = (JTextField) <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>.getEditor().getEditorComponent();
00127         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r5">browserFieldFlasher</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a>(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r4">browserFieldEditor</a>);
00128         browserFieldEditor.setFocusTraversalKeysEnabled(<span class="keyword">false</span>); <span class="comment">// disable tab-exiting from browserField</span>
00129 
00130         <span class="comment">// custom renderer for browserField's items so that long path names in the popup menu are made shorter</span>
00131         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r3">browserFieldRenderer</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_fitted_combo_box_renderer.html">FittedComboBoxRenderer</a>(browserFieldEditor);
00132         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>.setRenderer(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r3">browserFieldRenderer</a>);
00133 
00134         <span class="comment">// browse button</span>
00135         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">browseButton</a> = <span class="keyword">new</span> JButton(<span class="stringliteral">"Browse..."</span>);
00136 
00137         <span class="comment">// add both into this</span>
00138         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">browsePanel</a>.setLayout(<span class="keyword">new</span> BorderLayout());
00139         <span class="comment">//browsePanel.setBorder(BorderFactory.createEmptyBorder(0, 0, 4, 0));</span>
00140         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">browsePanel</a>.add(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r2">browserField</a>, BorderLayout.CENTER);
00141         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">browsePanel</a>.add(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">browseButton</a>, BorderLayout.EAST);
00142 
00143         <span class="comment">// project file table and its ScrollPane</span>
00144         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r7">explorerTable</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_table.html">ProjectExplorerTable</a>(<span class="keyword">this</span>.parent);
00145         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r8">explorerTableScrollPane</a> = <span class="keyword">new</span> JScrollPane(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r7">explorerTable</a>);
00146         <span class="comment">// explorerTableScrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);</span>
00147         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r8">explorerTableScrollPane</a>.getViewport().setBackground(Color.WHITE);
00148 
00149         <span class="comment">// new project panel</span>
00150         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r9">newProjectPanel</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html">NewProjectPanel</a>();
00151 
00152         <span class="keyword">this</span>.setLayout(<span class="keyword">new</span> BorderLayout());
00153         <span class="keyword">this</span>.add(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r1">browsePanel</a>, BorderLayout.NORTH);
00154         <span class="keyword">this</span>.add(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r8">explorerTableScrollPane</a>, BorderLayout.CENTER);
00155         <span class="keyword">this</span>.add(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r9">newProjectPanel</a>, BorderLayout.SOUTH);
00156 
00157         <span class="comment">// set current directory to project dir or latest directory history dir</span>
00158         <span class="keywordflow">if</span> (project != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00159             <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d0">setDirectory</a>(project.<a class="code" href="classikayaki_1_1_project.html#a7">getFile</a>().getParentFile());
00160         } <span class="keywordflow">else</span> {
00161             <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d0">setDirectory</a>(<a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getLastDirectory());
00162         }
00163 
00164         <span class="comment">// scroll to the end of the combo box's text field (after setting directory) -- seems to happen anyway</span>
00165         <span class="comment">// setBrowserFieldCursorToEnd();</span>
00166 
00167         <span class="comment">// ProjectExplorer events</span>
00168 
00173         <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">browseButton</a>.addActionListener(<span class="keyword">new</span> ActionListener() {
00174             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00175                 JFileChooser fc = <span class="keyword">new</span> JFileChooser(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r11">directory</a>);
00176                 fc.setDialogTitle(<span class="stringliteral">"Change directory"</span>);
00177                 fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
00178 
00179                 <span class="keywordflow">if</span> (fc.showOpenDialog(<a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#r6">browseButton</a>) == JFileChooser.APPROVE_OPTION) {
00180                     <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d0">setDirectory</a>(fc.getSelectedFile());
00181                 }
00182             }
00183         });
00184 
00189         browserField.addActionListener(<span class="keyword">new</span> ActionListener() {
00190             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00191                 <span class="comment">// check if event is caused by popup menu update</span>
00192                 <span class="keywordflow">if</span> (browserFieldUpdatingPopup) <span class="keywordflow">return</span>;
00193 
00194                 <span class="comment">// JComboBox event types:</span>
00195                 <span class="comment">// Edited -- pressed enter in the text field or selected an item by pressing enter</span>
00196                 <span class="comment">// Changed -- cycled item list with up/down, selected item with mouse or pressed enter in text field</span>
00197                 <span class="comment">// System.out.println(e.getActionCommand() + ": " + browserField.getSelectedItem());</span>
00198 
00199                 <span class="comment">// we only want changed-events, not duplicate edited-events -- actually, we want those too,</span>
00200                 <span class="comment">// so that multiple tries to change to an invalid directory with enter will flash text field</span>
00201                 <span class="comment">// if (!e.getActionCommand().equals("comboBoxChanged")) return;</span>
00202 
00203                 <span class="comment">// TODO: cycling through popup menu list with up/down keys changes directory;</span>
00204                 <span class="comment">// it shouldn't, but can't recognize those changed-events from mouse clicks</span>
00205 
00206                 <span class="comment">// item is File if selected from list, String if written to text field</span>
00207                 Object item = browserField.getEditor().getItem();
00208                 File dir = item instanceof File ? (File) item : <span class="keyword">new</span> File((String) item).getAbsoluteFile();
00209 
00210                 <span class="comment">// try to set directory, flash browserField red if error</span>
00211                 <span class="keywordflow">if</span> (!setDirectory(dir)) browserFieldFlasher.flash();
00212             }
00213         });
00214 
00218         browserField.addPopupMenuListener(<span class="keyword">new</span> PopupMenuListener() {
00219             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuWillBecomeInvisible(PopupMenuEvent e) {
00220                 <span class="comment">// set popup menu as directory history when closing popup, unless it's already dir history</span>
00221                 <span class="keywordflow">if</span> (browserFieldPopupIsAutocomplete) {
00222                     browserFieldPopupIsAutocomplete = <span class="keyword">false</span>;
00223                     <span class="comment">// TODO: when mouseclicking autocomplete list item, textfield gets cleared because of this</span>
00224                     <span class="comment">//Object item = browserField.getSelectedItem();</span>
00225                     setBrowserFieldPopup(getDirectoryHistory(), <span class="keyword">false</span>);
00226                     <span class="comment">//browserField.setSelectedItem(item);</span>
00227                 }
00228             }
00229 
00230             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuWillBecomeVisible(PopupMenuEvent e) {
00231             }
00232 
00233             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuCanceled(PopupMenuEvent e) {
00234             }
00235         });
00236 
00242         browserFieldEditor.addKeyListener(<span class="keyword">new</span> KeyAdapter() {
00243             <span class="keyword">public</span> <span class="keywordtype">void</span> keyPressed(KeyEvent e) {
00244                 <span class="keywordflow">if</span> (e.getKeyCode() == KeyEvent.VK_TAB) {
00245                     <span class="comment">// change to down- or up-arrow event</span>
00246                     <span class="keywordflow">if</span> ((e.getModifiers() &amp; KeyEvent.SHIFT_MASK) != 0) {
00247                         <span class="comment">// this deprecation is required for shift-tab to work</span>
00248                         e.setModifiers(e.getModifiers() ^ KeyEvent.SHIFT_MASK);
00249                         e.setKeyCode(KeyEvent.VK_UP);
00250                     } <span class="keywordflow">else</span> {
00251                         e.setKeyCode(KeyEvent.VK_DOWN);
00252                     }
00253                 }
00254             }
00255 
00256             <span class="keyword">public</span> <span class="keywordtype">void</span> keyTyped(KeyEvent e) {
00257                 <span class="keywordflow">if</span> (e.getKeyChar() == KeyEvent.VK_ESCAPE) {
00258                     browserField.setSelectedItem(directory);
00259                     <span class="comment">// browserField.getEditor().selectAll();</span>
00260                     <span class="keywordflow">return</span>;
00261                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e.getKeyChar() == KeyEvent.VK_ENTER) {
00262                     <span class="keywordflow">return</span>;
00263                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e.getKeyChar() == KeyEvent.VK_TAB) <span class="keywordflow">return</span>;
00264 
00265                 <span class="keywordflow">if</span> (e.getModifiers() == KeyEvent.CTRL_MASK &amp;&amp; e.getKeyChar() == KeyEvent.VK_DELETE) {
00266                     <span class="comment">// delete one directory name at a time</span>
00267                     <span class="keywordtype">int</span> pos = browserFieldEditor.getCaretPosition();
00268                     String text = browserFieldEditor.getText();
00269                     String textA = text.substring(0, pos);
00270                     String textB = text.substring(pos);
00271                     textA = textA.substring(0, Math.max(0, textA.lastIndexOf(System.getProperty(<span class="stringliteral">"file.separator"</span>))));
00272                     browserFieldEditor.setText(textA + textB);
00273                     browserFieldEditor.setCaretPosition(textA.length());
00274 
00275                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((e.getModifiers() &amp; KeyEvent.ALT_MASK) != 0 || (e.getModifiers() &amp; KeyEvent.CTRL_MASK) != 0) {
00276                     <span class="comment">// avoid the popup menu from showing, when the Project Explorer tab is hidden with ALT+P</span>
00277                     browserField.hidePopup();
00278                     <span class="keywordflow">return</span>;
00279                 }
00280 
00281                 autocompleteExecutor.execute(<span class="keyword">new</span> Runnable() {
00282                     <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00283                         doAutoComplete();
00284                     }
00285                 });
00286             }
00287         });
00288     }
00289 
<a name="l00295"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#a2">00295</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> setProject(<a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a>) {
00296         super.setProject(project);
00297 
00298         <span class="comment">// update directory history, as it might have changed</span>
00299         browserField.hidePopup();
00300         setBrowserFieldPopup(getDirectoryHistory(), <span class="keyword">false</span>);
00301 
00302         <span class="comment">// change directory, if not calibration project; in that case just update selected project in explorerTable</span>
00303         <span class="keywordflow">if</span> (project != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; project.getType() != <a class="code" href="classikayaki_1_1_project.html">Project</a>.Type.CALIBRATION) {
00304             setDirectory(project.getFile().getParentFile());
00305         } <span class="keywordflow">else</span> {
00306             explorerTable.setDirectory(directory);
00307         }
00308 
00309         <span class="comment">// add explorerTable as a ProjectListener so it can update current project's timestamps</span>
00310         <span class="keywordflow">if</span> (project != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) project.addProjectListener(explorerTable);
00311     }
00312 
<a name="l00319"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d0">00319</a>     <span class="keyword">private</span> <span class="keywordtype">boolean</span> setDirectory(File directory) {
00320         <span class="keywordflow">if</span> (directory == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !directory.isDirectory()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00321 
00322         <span class="keyword">this</span>.directory = directory;
00323 
00324         <span class="comment">// update browserField and explorerTable with new directory</span>
00325         browserField.setSelectedItem(<span class="keyword">this</span>.directory);
00326         explorerTable.setDirectory(<span class="keyword">this</span>.directory);
00327 
00328         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00329     }
00330 
<a name="l00336"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d1">00336</a>     <span class="keyword">private</span> File[] getDirectoryHistory() {
00337         <span class="keywordflow">return</span> <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDirectoryHistory();
00338     }
00339 
<a name="l00346"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d2">00346</a>     <span class="keyword">private</span> File[] getAutocompleteFiles(String dirmatch) {
00347         File dirfile = <span class="keyword">new</span> File(dirmatch);
00348         <span class="keywordflow">if</span> (!dirfile.isAbsolute()) <span class="keywordflow">return</span> File.listRoots();
00349         File dir = dirfile.isDirectory() ? dirfile : dirfile.getParentFile();
00350 
00351         <span class="comment">// protect against no-parent-null and invalid-dir-list-null</span>
00352         <span class="keywordflow">if</span> (dir == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00353             dir = directory;
00354         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dir.isDirectory()) <span class="keywordflow">return</span> <span class="keyword">new</span> File[0];
00355 
00356         <span class="keyword">final</span> String match = dirfile.isDirectory() ? <span class="stringliteral">""</span> : dirfile.getName();
00357 
00358         File[] files = dir.listFiles(<span class="keyword">new</span> FileFilter() {
00359             <span class="keyword">public</span> <span class="keywordtype">boolean</span> accept(File file) {
00360                 <span class="keywordflow">return</span> (file.isDirectory() &amp;&amp; file.getName().toLowerCase().startsWith(match.toLowerCase()));
00361             }
00362         });
00363 
00364         <span class="comment">// listFiles() does not guarantee any order for the returned files, so they must be sorted first</span>
00365         Arrays.sort(files);
00366         <span class="keywordflow">return</span> files;
00367     }
00368 
<a name="l00372"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d3">00372</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> doAutoComplete() {
00373         <span class="keyword">final</span> File[] files = getAutocompleteFiles(browserField.getEditor().getItem().toString());
00374 
00375         <span class="comment">// gui updating must be done from event-dispatching thread</span>
00376         SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
00377             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00378                 <span class="comment">// when the popup is hidden before showing, it will be automatically resized</span>
00379                 <span class="comment">// (disable change-to-dirhistory-on-popup-hide for this)</span>
00380                 browserFieldPopupIsAutocomplete = <span class="keyword">false</span>;
00381                 browserField.hidePopup();
00382 
00383                 browserFieldPopupIsAutocomplete = <span class="keyword">true</span>;
00384                 setBrowserFieldPopup(files, <span class="keyword">true</span>);
00385                 <span class="keywordflow">if</span> (files.length &gt; 0) browserField.showPopup();
00386             }
00387         });
00388     }
00389 
<a name="l00396"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d4">00396</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> setBrowserFieldPopup(File[] files, <span class="keywordtype">boolean</span> uniformFit) {
00397         <span class="comment">// purkkaillaan -- some hardcore bubblegum stitching (the whole method)</span>
00398         browserFieldUpdatingPopup = <span class="keyword">true</span>;
00399 
00400         String browserFieldEditorText = browserFieldEditor.getText();
00401         <span class="keywordtype">int</span> browserFieldEditorCursorPosition = browserFieldEditor.getCaretPosition();
00402 
00403         browserField.removeAllItems();
00404         <span class="keywordflow">for</span> (File file : files) browserField.addItem(file);
00405 
00406         <span class="comment">// fit the contents of the menu list</span>
00407         <span class="keywordflow">if</span> (uniformFit) {
00408             <span class="keywordtype">int</span> maxFitValue = 0;
00409             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; browserField.getItemCount(); i++) {
00410                 Object item = browserField.getItemAt(i);
00411                 <span class="keywordtype">int</span> fitValue = browserFieldRenderer.fitValue(item);
00412                 maxFitValue = Math.max(maxFitValue, fitValue);
00413             }
00414             browserFieldRenderer.setFitLimit(maxFitValue);
00415         } <span class="keywordflow">else</span> {
00416             browserFieldRenderer.setFitLimit(-1);
00417         }
00418 
00419         browserField.setSelectedIndex(-1);
00420         browserFieldEditor.setText(browserFieldEditorText);
00421         browserFieldEditor.setCaretPosition(browserFieldEditorCursorPosition);
00422 
00423         browserFieldUpdatingPopup = <span class="keyword">false</span>;
00424     }
00425 
<a name="l00431"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel.html#d5">00431</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> setBrowserFieldCursorToEnd() {
00432         browserFieldEditor.setCaretPosition(browserFieldEditor.getDocument().getLength());
00433     }
00434 
<a name="l00438"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html">00438</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html">NewProjectPanel</a> <span class="keyword">extends</span> JPanel {
00439 
<a name="l00440"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#r0">00440</a>         <span class="keyword">private</span> <span class="keyword">final</span> JTextField newProjectName;
<a name="l00441"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#r1">00441</a>         <span class="keyword">private</span> <span class="keyword">final</span> JComboBox newProjectType;
<a name="l00442"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#r2">00442</a>         <span class="keyword">private</span> <span class="keyword">final</span> JButton createNewProjectButton;
<a name="l00443"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#r3">00443</a>         <span class="keyword">private</span> <span class="keyword">final</span> JPanel flowPanel;
<a name="l00444"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#r4">00444</a>         <span class="keyword">private</span> <span class="keyword">final</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a> newProjectNameFlasher;
00445 
<a name="l00446"></a><a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html#a0">00446</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_project_explorer_panel_1_1_new_project_panel.html">NewProjectPanel</a>() {
00447             super(<span class="keyword">new</span> BorderLayout());
00448 
00449             newProjectName = <span class="keyword">new</span> JTextField();
00450             newProjectType = <span class="keyword">new</span> JComboBox(<a class="code" href="classikayaki_1_1_project.html">Project</a>.Type.values());
00451             newProjectType.removeItem(<a class="code" href="classikayaki_1_1_project.html">Project</a>.Type.CALIBRATION); <span class="comment">// calibration projects are created from the File menu</span>
00452             newProjectType.setSelectedItem(<a class="code" href="classikayaki_1_1_project.html">Project</a>.Type.AF);
00453             newProjectType.setBackground(Color.WHITE);
00454             createNewProjectButton = <span class="keyword">new</span> JButton(<span class="stringliteral">"Create New"</span>);
00455 
00456             flowPanel = <span class="keyword">new</span> JPanel(<span class="keyword">new</span> BorderLayout());
00457             flowPanel.add(newProjectType, BorderLayout.WEST);
00458             flowPanel.add(createNewProjectButton, BorderLayout.EAST);
00459 
00460             <span class="keyword">this</span>.add(newProjectName, BorderLayout.CENTER);
00461             <span class="keyword">this</span>.add(flowPanel, BorderLayout.EAST);
00462 
00463             newProjectNameFlasher = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a>(newProjectName);
00464 
00471             createNewProjectButton.addActionListener(<span class="keyword">new</span> ActionListener() {
00472                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00473                     String name = newProjectName.getText();
00474                     <span class="keywordflow">if</span> (name.length() &gt; 0 &amp;&amp; !name.toLowerCase().endsWith(<a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.FILE_TYPE)) {
00475                         name += <a class="code" href="classikayaki_1_1_ikayaki.html">Ikayaki</a>.FILE_TYPE;
00476                     }
00477 
00478                     <a class="code" href="classikayaki_1_1_project.html">Project</a>.Type type = (<a class="code" href="classikayaki_1_1_project.html">Project</a>.Type) newProjectType.getSelectedItem();
00479 
00480                     File file = <span class="keyword">new</span> File(directory, name);
00481 
00482                     <span class="comment">// TODO: should we check here if the file is legitimate? or does Project.createProject check it already?</span>
00483 
00484                     <a class="code" href="classikayaki_1_1_project.html">Project</a> created = <a class="code" href="classikayaki_1_1_project.html">Project</a>.createProject(file, type);
00485 
00486                     <span class="keywordflow">if</span> (created == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00487                         newProjectNameFlasher.flash();
00488                         newProjectName.requestFocusInWindow();
00489                     } <span class="keywordflow">else</span> {
00490                         parent.setProject(created);
00491                         newProjectName.setText(<span class="stringliteral">""</span>);
00492                     }
00493                 }
00494             });
00495 
00499             newProjectName.addActionListener(<span class="keyword">new</span> ActionListener() {
00500                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00501                     createNewProjectButton.doClick();
00502                 }
00503             });
00504         }
00505     }
00506 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed May 4 13:11:04 2005 for Squid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
