<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Squid: My Documents/squid/src/ikayaki/gui/MeasurementSequencePanel.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">My Documents</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">squid</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">src</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ikayaki</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">gui</a></div>
<h1>MeasurementSequencePanel.java</h1><a href="_measurement_sequence_panel_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * MeasurementSequencePanel.java</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright (C) 2005 Project SQUID, http://www.cs.helsinki.fi/group/squid/</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * This file is part of Ikayaki.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * Ikayaki is free software; you can redistribute it and/or modify</span>
00009 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00010 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
00011 <span class="comment"> * (at your option) any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Ikayaki is distributed in the hope that it will be useful,</span>
00014 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00015 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
00016 <span class="comment"> * GNU General Public License for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> * along with Ikayaki; if not, write to the Free Software</span>
00020 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
00021 <span class="comment"> */</span>
00022 
00023 <span class="keyword">package </span>ikayaki.gui;
00024 
00025 <span class="keyword">import</span> com.intellij.uiDesigner.core.GridConstraints;
00026 <span class="keyword">import</span> com.intellij.uiDesigner.core.GridLayoutManager;
00027 <span class="keyword">import</span> com.intellij.uiDesigner.core.Spacer;
00028 <span class="keyword">import</span> ikayaki.*;
00029 
00030 <span class="keyword">import</span> javax.swing.*;
00031 <span class="keyword">import</span> javax.swing.event.*;
00032 <span class="keyword">import</span> javax.swing.table.TableColumnModel;
00033 <span class="keyword">import</span> javax.swing.text.NumberFormatter;
00034 <span class="keyword">import</span> java.awt.*;
00035 <span class="keyword">import</span> java.awt.event.*;
00036 <span class="keyword">import</span> java.text.DecimalFormat;
00037 <span class="keyword">import</span> java.util.ArrayList;
00038 <span class="keyword">import</span> java.util.List;
00039 
00040 <span class="keyword">import</span> <span class="keyword">static</span> ikayaki.gui.SequenceColumn.*;
00041 
<a name="l00047"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html">00047</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html">MeasurementSequencePanel</a> <span class="keyword">extends</span> <a class="code" href="classikayaki_1_1gui_1_1_project_component.html">ProjectComponent</a> {
00048 
00049     <span class="comment">/* Measurement Sequence Table */</span>
<a name="l00050"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">00050</a>     <span class="keyword">private</span> JTable <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>;
<a name="l00051"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r1">00051</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_table_model.html">MeasurementSequenceTableModel</a> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r1">sequenceTableModel</a>;
00052 
00053     <span class="comment">/* Add Sequence Controls */</span>
<a name="l00054"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r2">00054</a>     <span class="keyword">private</span> JFormattedTextField <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r2">sequenceStartField</a>;
<a name="l00055"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r3">00055</a>     <span class="keyword">private</span> JFormattedTextField <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r3">sequenceStepField</a>;
<a name="l00056"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r4">00056</a>     <span class="keyword">private</span> JFormattedTextField <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r4">sequenceStopField</a>;
<a name="l00057"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r5">00057</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r5">sequenceStartFieldFlasher</a>;
<a name="l00058"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r6">00058</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r6">sequenceStepFieldFlasher</a>;
<a name="l00059"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r7">00059</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r7">sequenceStopFieldFlasher</a>;
<a name="l00060"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r8">00060</a>     <span class="keyword">private</span> JButton <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r8">addSequenceButton</a>;
<a name="l00061"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r9">00061</a>     <span class="keyword">private</span> JComboBox <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r9">loadSequenceBox</a>;
00062 
<a name="l00063"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r10">00063</a>     <span class="keyword">private</span> JLabel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r10">stepValueTypeLabel</a>;  <span class="comment">// stepValue's type depends on the project's type</span>
<a name="l00064"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r11">00064</a>     <span class="keyword">private</span> JLabel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r11">sequenceStartLabel</a>;
<a name="l00065"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r12">00065</a>     <span class="keyword">private</span> JLabel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r12">sequenceStepLabel</a>;
<a name="l00066"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r13">00066</a>     <span class="keyword">private</span> JLabel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r13">sequenceStopLabel</a>;
<a name="l00067"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r14">00067</a>     <span class="keyword">private</span> JLabel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r14">loadSequenceLabel</a>;
00068 
<a name="l00069"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r15">00069</a>     <span class="keyword">private</span> JPanel <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r15">controlsPane</a>;
00070 
00071     <span class="comment">/* Details Panel */</span>
<a name="l00072"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r16">00072</a>     <span class="keyword">private</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_details_panel.html">MeasurementDetailsPanel</a> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r16">detailsPanel</a>;
00073 
00074 
<a name="l00078"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a0">00078</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a0">MeasurementSequencePanel</a>() {
00079 
00080         <span class="comment">/* Sequence Table */</span>
00081         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r1">sequenceTableModel</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_table_model.html">MeasurementSequenceTableModel</a>();
00082         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a> = <span class="keyword">new</span> JTable(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r1">sequenceTableModel</a>);
00083         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getTableHeader().setReorderingAllowed(<span class="keyword">false</span>);
00084         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getTableHeader().setResizingAllowed(<span class="keyword">false</span>);
00085         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.setDefaultRenderer(<a class="code" href="classikayaki_1_1gui_1_1_styled_wrapper.html">StyledWrapper</a>.class, <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_styled_table_cell_renderer.html">StyledTableCellRenderer</a>());
00086         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.setDefaultEditor(<a class="code" href="classikayaki_1_1gui_1_1_styled_wrapper.html">StyledWrapper</a>.class, <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_styled_cell_editor.html">StyledCellEditor</a>(<span class="keyword">new</span> JTextField()));
00087 
00088         <span class="comment">/* Add Sequence Controls */</span>
00089         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_my_formatter_factory.html">MyFormatterFactory</a> factory = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_my_formatter_factory.html">MyFormatterFactory</a>();
00090         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r2">sequenceStartField</a>.setFormatterFactory(factory);
00091         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r3">sequenceStepField</a>.setFormatterFactory(factory);
00092         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r4">sequenceStopField</a>.setFormatterFactory(factory);
00093         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r5">sequenceStartFieldFlasher</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a>(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r2">sequenceStartField</a>);
00094         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r6">sequenceStepFieldFlasher</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a>(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r3">sequenceStepField</a>);
00095         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r7">sequenceStopFieldFlasher</a> = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_component_flasher.html">ComponentFlasher</a>(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r4">sequenceStopField</a>);
00096 
00097         <span class="comment">/* Build Layout */</span>
00098         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r15">controlsPane</a>.setBorder(BorderFactory.createEmptyBorder(0, 4, 4, 4));
00099         JScrollPane scrollPane = <span class="keyword">new</span> JScrollPane(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>);
00100         scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED);
00101         scrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
00102         scrollPane.getViewport().setBackground(Color.WHITE);
00103 
00104         setLayout(<span class="keyword">new</span> BorderLayout());
00105         add(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r15">controlsPane</a>, <span class="stringliteral">"North"</span>);
00106         add(scrollPane);
00107 
00108         <span class="comment">/* Event Listeners */</span>
00109 
00110         <span class="comment">// resize the table columns to be always the right size</span>
00111         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getColumnModel().addColumnModelListener(<span class="keyword">new</span> TableColumnModelListener() {
00112             <span class="keyword">public</span> <span class="keywordtype">void</span> columnAdded(TableColumnModelEvent e) {
00113                 <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d1">updateColumns</a>();
00114             }
00115 
00116             <span class="keyword">public</span> <span class="keywordtype">void</span> columnRemoved(TableColumnModelEvent e) {
00117                 <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d1">updateColumns</a>();
00118             }
00119 
00120             <span class="keyword">public</span> <span class="keywordtype">void</span> columnMoved(TableColumnModelEvent e) {
00121                 <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d1">updateColumns</a>();
00122             }
00123 
00124             <span class="keyword">public</span> <span class="keywordtype">void</span> columnMarginChanged(ChangeEvent e) {
00125                 <span class="comment">// DO NOTHING</span>
00126             }
00127 
00128             <span class="keyword">public</span> <span class="keywordtype">void</span> columnSelectionChanged(ListSelectionEvent e) {
00129                 <span class="comment">// DO NOTHING</span>
00130             }
00131         });
00132 
00133         <span class="comment">// show the column's description in the header as a tooltip</span>
00134         <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getTableHeader().addMouseMotionListener(<span class="keyword">new</span> MouseMotionAdapter() {
00135 
00136             <span class="keyword">private</span> <span class="keywordtype">int</span> currentColumn;
00137 
00138             @Override <span class="keyword">public</span> <span class="keywordtype">void</span> mouseMoved(MouseEvent e) {
00139                 <span class="keywordtype">int</span> column = <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getColumnModel().getColumnIndexAtX(e.getX());
00140 
00141                 <span class="keywordflow">if</span> (column != currentColumn) {
00142                     <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r0">sequenceTable</a>.getTableHeader().setToolTipText(<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#r1">sequenceTableModel</a>.<a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_table_model.html#a14">getColumnToolTip</a>(column));
00143                     currentColumn = column;     <span class="comment">// avoin unnecessary setToolTipText() calls</span>
00144                 }
00145             }
00146         });
00147 
00148         <span class="comment">// show the details of the selected step in the details panel</span>
00149         sequenceTable.getSelectionModel().addListSelectionListener(<span class="keyword">new</span> ListSelectionListener() {
00150             <span class="keyword">public</span> <span class="keywordtype">void</span> valueChanged(ListSelectionEvent e) {
00151                 <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00152                     <span class="keywordflow">return</span>;
00153                 }
00154 
00155                 <span class="comment">// if there is exactly one step selected, show that one</span>
00156                 <span class="keywordflow">if</span> (sequenceTable.getSelectedRowCount() == 1) {
00157                     <span class="keywordtype">int</span> index = sequenceTable.getSelectedRow();
00158                     <span class="keywordflow">if</span> (index &lt; getProject().getSteps()) {
00159                         getDetailsPanel().setStep(getProject().getStep(index));
00160                         <span class="keywordflow">return</span>;
00161                     }
00162                 }
00163 
00164                 <span class="comment">// if it is unclear that which step to show, show the measuring step (might be null)</span>
00165                 getDetailsPanel().setStep(getProject().getCurrentStep());
00166             }
00167         });
00168 
00169         <span class="comment">// adding a sequence with the add sequence controls</span>
00170         addSequenceButton.addActionListener(<span class="keyword">new</span> ActionListener() {
00171             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00172                 addSequence();
00173             }
00174         });
00175         KeyListener keyListener = <span class="keyword">new</span> KeyAdapter() {
00176             @Override <span class="keyword">public</span> <span class="keywordtype">void</span> keyTyped(KeyEvent e) {
00177                 <span class="keywordflow">if</span> (e.getKeyChar() == KeyEvent.VK_ENTER) {
00178                     addSequence();
00179                 }
00180             }
00181         };
00182         sequenceStartField.addKeyListener(keyListener);
00183         sequenceStepField.addKeyListener(keyListener);
00184         sequenceStopField.addKeyListener(keyListener);
00185 
00186         <span class="comment">// reset the add sequence controls when new rows are added, removed or stepValues are changed</span>
00187         sequenceTableModel.addTableModelListener(<span class="keyword">new</span> TableModelListener() {
00188             <span class="keyword">public</span> <span class="keywordtype">void</span> tableChanged(TableModelEvent e) {
00189                 resetAddSequence();
00190             }
00191         });
00192 
00193         <span class="comment">// drop down menu for adding preset sequences</span>
00194         loadSequenceBox.addActionListener(<span class="keyword">new</span> ActionListener() {
00195             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00196                 <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !getProject().isSequenceEditEnabled()) {
00197                     <span class="keywordflow">return</span>;
00198                 }
00199 
00200                 <span class="comment">// append saved sequences when they are selected from the list</span>
00201                 Object obj = loadSequenceBox.getSelectedItem();
00202                 <span class="keywordflow">if</span> (obj != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> &amp;&amp; obj instanceof MeasurementSequence) {
00203                     MeasurementSequence sequence = (MeasurementSequence) obj;
00204                     getProject().addSequence(sequence);
00205 
00206                     <span class="comment">// select the just added steps</span>
00207                     <span class="keyword">final</span> <span class="keywordtype">int</span> addedSteps = sequence.getSteps();
00208                     SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
00209                         <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00210                             scrollToRow(getProject().getSteps());
00211                             <span class="keywordtype">int</span> start = getProject().getSteps() - addedSteps;
00212                             <span class="keywordtype">int</span> end = getProject().getSteps() - 1;
00213                             sequenceTable.getSelectionModel().clearSelection();
00214                             sequenceTable.getSelectionModel().setSelectionInterval(start, end);
00215                         }
00216                     });
00217                 }
00218             }
00219         });
00220         loadSequenceBox.addPopupMenuListener(<span class="keyword">new</span> PopupMenuListener() {
00221             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuWillBecomeVisible(PopupMenuEvent e) {
00222 
00223                 <span class="comment">// clear the previous selection when the menu is opened</span>
00224                 <span class="keywordflow">if</span> (loadSequenceBox.getSelectedItem() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00225                     loadSequenceBox.setSelectedItem(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00226                 }
00227             }
00228 
00229             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuWillBecomeInvisible(PopupMenuEvent e) {
00230                 <span class="comment">// DO NOTHING</span>
00231             }
00232 
00233             <span class="keyword">public</span> <span class="keywordtype">void</span> popupMenuCanceled(PopupMenuEvent e) {
00234                 <span class="comment">// DO NOTHING</span>
00235             }
00236         });
00237 
00238         <span class="comment">// on table cell right-click: show a popup menu for adding/removing steps and saving sequences</span>
00239         sequenceTable.addMouseListener(<span class="keyword">new</span> MouseAdapter() {
00240             @Override <span class="keyword">public</span> <span class="keywordtype">void</span> mouseClicked(MouseEvent e) {
00241                 <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00242                     <span class="keywordflow">return</span>;
00243                 }
00244                 <span class="keywordflow">if</span> (e.getButton() == MouseEvent.BUTTON3) {
00245                     <span class="keywordtype">int</span>[] rows = sequenceTable.getSelectedRows();
00246                     List&lt;MeasurementStep&gt; steps = <span class="keyword">new</span> ArrayList&lt;MeasurementStep&gt;();
00247                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i : rows) {
00248                         <span class="keywordflow">if</span> (i &lt; getProject().getSteps()) {
00249                             steps.add(getProject().getStep(i));
00250                         }
00251                     }
00252                     JPopupMenu popup = <span class="keyword">new</span> SequencePopupMenu(steps.toArray(<span class="keyword">new</span> MeasurementStep[steps.size()]));
00253                     popup.show(e.getComponent(), e.getX(), e.getY());
00254                 }
00255             }
00256         });
00257 
00258         <span class="comment">// on table header right-click: show a popup menu for choosing the table columns</span>
00259         sequenceTable.getTableHeader().addMouseListener(<span class="keyword">new</span> MouseAdapter() {
00260             @Override <span class="keyword">public</span> <span class="keywordtype">void</span> mouseClicked(MouseEvent e) {
00261                 <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00262                     <span class="keywordflow">return</span>;
00263                 }
00264                 <span class="keywordflow">if</span> (e.getButton() == MouseEvent.BUTTON3) {
00265                     JPopupMenu popup = <span class="keyword">new</span> HeaderPopupMenu();
00266                     popup.show(e.getComponent(), e.getX(), e.getY());
00267                 }
00268             }
00269         });
00270 
00271         <span class="comment">// initialize with no project</span>
00272         setProject(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00273     }
00274 
<a name="l00278"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a1">00278</a>     <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_details_panel.html">MeasurementDetailsPanel</a> getDetailsPanel() {
00279         <span class="keywordflow">if</span> (detailsPanel == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00280             detailsPanel = <span class="keyword">new</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_details_panel.html">MeasurementDetailsPanel</a>();
00281         }
00282         <span class="keywordflow">return</span> detailsPanel;
00283     }
00284 
<a name="l00288"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a2">00288</a>     <span class="keyword">public</span> JTable getSequenceTable() {
00289         <span class="keywordflow">return</span> <span class="keyword">this</span>.sequenceTable;
00290     }
00291 
<a name="l00295"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d0">00295</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> resetLoadSequenceBox() {
00296         <span class="comment">// remove old and get new items</span>
00297         loadSequenceBox.removeAllItems();
00298         MeasurementSequence[] sequences = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getSequences();
00299 
00300         <span class="comment">// insert new items and restore old selection</span>
00301         loadSequenceBox.addItem(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);  <span class="comment">// the first item is empty</span>
00302         <span class="keywordflow">for</span> (MeasurementSequence sequence : sequences) {
00303             loadSequenceBox.addItem(sequence);
00304         }
00305     }
00306 
<a name="l00310"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d1">00310</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> updateColumns() {
00311         TableColumnModel columnModel = sequenceTable.getColumnModel();
00312         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; columnModel.getColumnCount(); col++) {
00313             <span class="keywordflow">if</span> (columnModel.getColumn(col).getHeaderValue().equals(<a class="code" href="namespaceikayaki_1_1gui.html#a26a8">COUNT</a>.getColumnName(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>))) {
00314 
00315                 <span class="comment">// find out the column's preferred width using the actual cell contents</span>
00316                 <span class="keywordtype">int</span> width = 20;
00317                 Component comp;
00318                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; sequenceTable.getRowCount(); row++) {
00319                     comp = sequenceTable.getCellRenderer(row, col).getTableCellRendererComponent(sequenceTable,
00320                             sequenceTable.getValueAt(row, col), <span class="keyword">false</span>, <span class="keyword">false</span>, row, col);
00321                     width = Math.max(width, comp.getPreferredSize().width);
00322                 }
00323                 width += 5;
00324                 columnModel.getColumn(col).setMinWidth(width);
00325                 columnModel.getColumn(col).setMaxWidth(width);
00326                 <span class="keywordflow">return</span>;
00327             }
00328         }
00329     }
00330 
<a name="l00334"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d2">00334</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> getLastPositiveStepValue() {
00335         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = getProject().getSteps() - 1; i &gt;= 0; i--) {
00336             <span class="keywordtype">double</span> stepValue = getProject().getStep(i).getStepValue();
00337             <span class="keywordflow">if</span> (stepValue &gt; 0.0) {
00338                 <span class="keywordflow">return</span> stepValue;
00339             }
00340         }
00341         <span class="keywordflow">return</span> 0.0;
00342     }
00343 
<a name="l00347"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d3">00347</a>     <span class="keyword">private</span> <span class="keywordtype">double</span> getLastStepValue() {
00348         <span class="keywordtype">double</span> stepValue = 0.0;
00349         <span class="keywordflow">if</span> (getProject().getSteps() &gt; 0) {
00350             stepValue = getProject().getStep(getProject().getSteps() - 1).getStepValue();
00351         }
00352         <span class="keywordflow">return</span> Math.max(0.0, stepValue);
00353     }
00354 
<a name="l00358"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d4">00358</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> resetAddSequence() {
00359         sequenceStartField.setValue(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00360         sequenceStepField.setValue(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00361         sequenceStopField.setValue(null);
00362         <span class="keywordflow">if</span> (getProject() == null) {
00363             <span class="keywordflow">return</span>;
00364         }
00365 
00366         <span class="comment">// set the latest step value to the Start field</span>
00367         <span class="keywordtype">double</span> stepValue = getLastPositiveStepValue();
00368         sequenceStartField.setValue(<span class="keyword">new</span> Double(stepValue));
00369     }
00370 
<a name="l00375"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d5">00375</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> addSequence() {
00376         <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !getProject().isSequenceEditEnabled()) {
00377             <span class="keywordflow">return</span>;
00378         }
00379 
00380         <span class="comment">// verify the values of the fields, flash them red if errors are found</span>
00381         <span class="keywordtype">double</span> startVal;
00382         <span class="keywordtype">double</span> stepVal;
00383         <span class="keywordtype">double</span> stopVal;
00384         <span class="keywordflow">if</span> (sequenceStartField.getValue() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>
00385                 &amp;&amp; sequenceStepField.getValue() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>
00386                 &amp;&amp; sequenceStopField.getValue() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00387             <span class="comment">// only start entered, add only one step</span>
00388             startVal = Math.max(((Number) sequenceStartField.getValue()).doubleValue(), 0.0);
00389             startVal = Math.min(startVal, <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMaximumField());
00390             stepVal = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumFieldIncrement();
00391             stopVal = startVal;
00392 
00393         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sequenceStartField.getValue() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>
00394                 &amp;&amp; sequenceStepField.getValue() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>
00395                 &amp;&amp; sequenceStopField.getValue() != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00396             <span class="comment">// all values entered, check their sizes</span>
00397             startVal = Math.max(((Number) sequenceStartField.getValue()).doubleValue(), 0.0);
00398             stepVal = Math.max(((Number) sequenceStepField.getValue()).doubleValue(),
00399                     <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumFieldIncrement());
00400             stopVal = Math.min(((Number) sequenceStopField.getValue()).doubleValue(),
00401                     <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMaximumField());
00402 
00403             JTextField fixThisField = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00404             <span class="keywordflow">if</span> (startVal &gt; stopVal) {
00405                 sequenceStopFieldFlasher.flash();
00406                 fixThisField = sequenceStopField;
00407             }
00408             <span class="keywordflow">if</span> (stepVal &lt; <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumFieldIncrement()) {
00409                 sequenceStepFieldFlasher.flash();
00410                 fixThisField = sequenceStepField;
00411             }
00412             <span class="keywordflow">if</span> (fixThisField != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00413                 fixThisField.grabFocus();
00414                 <span class="keyword">final</span> JTextField f = fixThisField;
00415                 SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
00416                     <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00417                         <span class="comment">// needs to use invokeLater because it won't be possible to select text from a field which has no focus</span>
00418                         f.setSelectionStart(0);
00419                         f.setSelectionEnd(f.getText().length());
00420                     }
00421                 });
00422                 <span class="keywordflow">return</span>;
00423             }
00424 
00425         } <span class="keywordflow">else</span> {
00426             <span class="comment">// some required values have not been entered, so flash them</span>
00427             <span class="keywordflow">if</span> (sequenceStopField.getValue() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00428                 sequenceStopFieldFlasher.flash();
00429                 sequenceStopField.grabFocus();
00430             }
00431             <span class="keywordflow">if</span> (sequenceStepField.getValue() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00432                 sequenceStepFieldFlasher.flash();
00433                 sequenceStepField.grabFocus();
00434             }
00435             <span class="keywordflow">if</span> (sequenceStartField.getValue() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00436                 sequenceStartFieldFlasher.flash();
00437                 sequenceStartField.grabFocus();
00438             }
00439             <span class="keywordflow">return</span>;
00440         }
00441 
00442         <span class="comment">// must use integers for added accuracy</span>
00443         <span class="keyword">final</span> <span class="keywordtype">double</span> ratio = Settings.getDegausserMinimumFieldIncrement();
00444         <span class="keywordtype">int</span> istartVal = (int) Math.round(startVal / ratio);
00445         <span class="keywordtype">int</span> istepVal = (int) Math.round(stepVal / ratio);
00446         <span class="keywordtype">int</span> istopVal = (int) Math.round(stopVal / ratio);
00447         <span class="keywordtype">int</span> imin = (int) Math.round(Settings.getDegausserMinimumField() / ratio);
00448         <span class="keywordtype">int</span> imax = (int) Math.round(Settings.getDegausserMaximumField() / ratio);
00449 
00450         <span class="comment">// add the steps to the sequence</span>
00451         MeasurementStep step = <span class="keyword">new</span> MeasurementStep();
00452         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = istartVal; i &lt;= istopVal; i += istepVal) {
00453             <span class="keywordtype">int</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a3">value</a> = i;
00454             <span class="keywordflow">if</span> (value &gt; 0 &amp;&amp; value &lt; imin) {
00455                 value = imin;
00456             }
00457             <span class="keywordflow">if</span> (getLastStepValue() &gt; 0 &amp;&amp; Math.abs(value - (<span class="keywordtype">int</span>) Math.round(getLastStepValue() / ratio)) &lt; 1) {
00458                 <span class="keywordflow">continue</span>;
00459             }
00460             step.setStepValue(value * ratio);
00461             getProject().addStep(step);
00462         }
00463 
00464         <span class="comment">// finally reset the fields, move focus to the Start field and show the added steps</span>
00465         resetAddSequence();
00466         sequenceStartField.grabFocus();
00467         SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
00468             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00469                 scrollToRow(sequenceTableModel.getRowCount() - 1);
00470                 sequenceStartField.setSelectionStart(0);
00471                 sequenceStartField.setSelectionEnd(sequenceStartField.getText().length());
00472             }
00473         });
00474     }
00475 
<a name="l00481"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a3">00481</a>     @Override <span class="keyword">public</span> <span class="keywordtype">void</span> setEnabled(<span class="keywordtype">boolean</span> enabled) {
00482         super.setEnabled(enabled);
00483 
00484         sequenceStartField.setEnabled(enabled);
00485         sequenceStepField.setEnabled(enabled);
00486         sequenceStopField.setEnabled(enabled);
00487         addSequenceButton.setEnabled(enabled);
00488         loadSequenceBox.setEnabled(enabled);
00489 
00490         stepValueTypeLabel.setEnabled(enabled);
00491         sequenceStartLabel.setEnabled(enabled);
00492         sequenceStepLabel.setEnabled(enabled);
00493         sequenceStopLabel.setEnabled(enabled);
00494         loadSequenceLabel.setEnabled(enabled);
00495     }
00496 
<a name="l00501"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a4">00501</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> setProject(<span class="keyword">final</span> <a class="code" href="classikayaki_1_1_project.html">Project</a> <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a>) {
00502 
00503         <span class="comment">// either select the last row, or keep the old selection</span>
00504         <span class="keyword">final</span> <span class="keywordtype">boolean</span> autoSelect = getProject() != project;
00505         <span class="keyword">final</span> <span class="keywordtype">int</span>[] selectedRows = sequenceTable.getSelectedRows();
00506 
00507         super.setProject(project);
00508         sequenceTableModel.setProject(project);
00509         loadSequenceBox.setSelectedItem(<a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>);
00510         setEnabled(project != null &amp;&amp; project.isSequenceEditEnabled());
00511         resetAddSequence();
00512         resetLoadSequenceBox();
00513 
00514         <span class="comment">/* HACK:</span>
00515 <span class="comment">         * Must use invokeLater or otherwise the scrolling does not work at the start of the program, when the sizes</span>
00516 <span class="comment">         * of the components are not known. Causes the GUI to blink some.</span>
00517 <span class="comment">         */</span>
00518         SwingUtilities.invokeLater(<span class="keyword">new</span> Runnable() {
00519             <span class="keyword">public</span> <span class="keywordtype">void</span> run() {
00520 
00521                 <span class="comment">// scroll the table so that as many measuments as possible are visible, plus a couple of empty rows</span>
00522                 scrollToRow(0);
00523                 <span class="keywordflow">if</span> (project != null) {
00524                     scrollToRow(Math.min(project.getCompletedSteps() + 5, sequenceTableModel.getRowCount() - 1));
00525                 } <span class="keywordflow">else</span> {
00526                     scrollToRow(sequenceTableModel.getRowCount() - 1);
00527                 }
00528 
00529                 <span class="keywordflow">if</span> (<a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a> != <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00530                     <span class="keywordflow">if</span> (autoSelect) {
00531                         <span class="comment">// automatically select the last completed step</span>
00532                         <span class="keywordtype">int</span> i = <a class="code" href="namespaceikayaki_1_1gui.html#a26a1">project</a>.getCompletedSteps() - 1;
00533                         <span class="keywordflow">if</span> (i &gt;= 0) {
00534                             sequenceTable.getSelectionModel().clearSelection();
00535                             sequenceTable.getSelectionModel().setSelectionInterval(i, i);
00536                         }
00537                     } <span class="keywordflow">else</span> {
00538                         <span class="comment">// restore the old selection</span>
00539                         sequenceTable.getSelectionModel().clearSelection();
00540                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i : selectedRows) {
00541                             sequenceTable.getSelectionModel().addSelectionInterval(i, i);
00542                         }
00543                     }
00544                 }
00545             }
00546         });
00547     }
00548 
<a name="l00552"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d6">00552</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> scrollToRow(<span class="keywordtype">int</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a0">rowIndex</a>) {
00553         sequenceTable.scrollRectToVisible(sequenceTable.getCellRect(rowIndex, rowIndex, <span class="keyword">true</span>));
00554     }
00555 
<a name="l00559"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a5">00559</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> projectUpdated(<a class="code" href="classikayaki_1_1_project_event.html">ProjectEvent</a> event) {
00560         <span class="keywordflow">if</span> (event.getType() == <a class="code" href="classikayaki_1_1_project_event.html">ProjectEvent</a>.Type.DATA_CHANGED) {
00561 
00562             <span class="comment">// refresh the table header, in case the header names have changed.</span>
00563             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; sequenceTable.getColumnCount(); i++) {
00564                 sequenceTable.getColumnModel().getColumn(i).setHeaderValue(sequenceTableModel.getColumnName(i));
00565             }
00566             sequenceTable.getTableHeader().repaint();
00567 
00568             <span class="comment">// save the selected rows and update the table data</span>
00569             <span class="keywordtype">int</span>[] rows = sequenceTable.getSelectedRows();
00570             sequenceTableModel.fireTableDataChanged();
00571             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i : rows) {
00572                 sequenceTable.getSelectionModel().addSelectionInterval(i, i);
00573             }
00574         }
00575     }
00576 
<a name="l00577"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#a6">00577</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> measurementUpdated(<a class="code" href="classikayaki_1_1_measurement_event.html">MeasurementEvent</a> event) {
00578         <span class="keywordflow">if</span> (event.getType() == <a class="code" href="classikayaki_1_1_measurement_event.html">MeasurementEvent</a>.Type.STEP_START) {
00579 
00580             <span class="comment">// scroll the row visible, and select it to show the measurement's details</span>
00581             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = getProject().getSteps() - 1; i &gt;= 0; i--) {
00582                 <span class="keywordflow">if</span> (getProject().getStep(i) == event.getStep()) {
00583                     sequenceTable.getSelectionModel().setSelectionInterval(i, i);
00584                     scrollToRow(i);
00585                     scrollToRow(Math.min(i + 2, sequenceTableModel.getRowCount() - 1));
00586                     <span class="keywordflow">break</span>;
00587                 }
00588             }
00589 <span class="comment">//        } else if (event.getType() == MeasurementEvent.Type.VALUE_MEASURED) {</span>
00590 <span class="comment">//</span>
00591 <span class="comment">//            // show the details of the latest measurement</span>
00592 <span class="comment">//            getDetailsPanel().setStep(event.getStep());</span>
00593         }
00594     }
00595 
00596     {
00597 <span class="comment">// GUI initializer generated by IntelliJ IDEA GUI Designer</span>
00598 <span class="comment">// !!! IMPORTANT !!!</span>
00599 <span class="comment">// DO NOT EDIT OR ADD ANY CODE HERE!</span>
00600         $$$setupUI$$$();
00601     }
00602 
<a name="l00607"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel.html#d7">00607</a>     <span class="keyword">private</span> <span class="keywordtype">void</span> $$$setupUI$$$() {
00608         controlsPane = <span class="keyword">new</span> JPanel();
00609         controlsPane.setLayout(<span class="keyword">new</span> GridLayoutManager(2, 7, <span class="keyword">new</span> Insets(0, 0, 0, 0), 5, 0));
00610         sequenceStartField = <span class="keyword">new</span> JFormattedTextField();
00611         sequenceStartField.setHorizontalAlignment(11);
00612         controlsPane.add(sequenceStartField,
00613                 <span class="keyword">new</span> GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL,
00614                         GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>,
00615                         <span class="keyword">new</span> Dimension(35, -1), <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00616         sequenceStepField = <span class="keyword">new</span> JFormattedTextField();
00617         sequenceStepField.setHorizontalAlignment(11);
00618         controlsPane.add(sequenceStepField,
00619                 <span class="keyword">new</span> GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL,
00620                         GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>,
00621                         <span class="keyword">new</span> Dimension(35, -1), <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00622         sequenceStopField = <span class="keyword">new</span> JFormattedTextField();
00623         sequenceStopField.setHorizontalAlignment(11);
00624         controlsPane.add(sequenceStopField,
00625                 <span class="keyword">new</span> GridConstraints(1, 2, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL,
00626                         GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>,
00627                         <span class="keyword">new</span> Dimension(35, -1), <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00628         sequenceStartLabel = <span class="keyword">new</span> JLabel();
00629         sequenceStartLabel.setText(<span class="stringliteral">"Start"</span>);
00630         controlsPane.add(sequenceStartLabel,
00631                 <span class="keyword">new</span> GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
00632                         GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00633         sequenceStepLabel = <span class="keyword">new</span> JLabel();
00634         sequenceStepLabel.setText(<span class="stringliteral">"Step"</span>);
00635         controlsPane.add(sequenceStepLabel,
00636                 <span class="keyword">new</span> GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
00637                         GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00638         sequenceStopLabel = <span class="keyword">new</span> JLabel();
00639         sequenceStopLabel.setText(<span class="stringliteral">"Stop"</span>);
00640         controlsPane.add(sequenceStopLabel,
00641                 <span class="keyword">new</span> GridConstraints(0, 2, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
00642                         GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00643         addSequenceButton = <span class="keyword">new</span> JButton();
00644         addSequenceButton.setText(<span class="stringliteral">"Add Sequence"</span>);
00645         controlsPane.add(addSequenceButton,
00646                 <span class="keyword">new</span> GridConstraints(1, 4, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_HORIZONTAL,
00647                         GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW,
00648                         GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00649         stepValueTypeLabel = <span class="keyword">new</span> JLabel();
00650         stepValueTypeLabel.setText(<span class="stringliteral">"mT"</span>);
00651         controlsPane.add(stepValueTypeLabel,
00652                 <span class="keyword">new</span> GridConstraints(1, 3, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
00653                         GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00654         <span class="keyword">final</span> Spacer spacer1 = <span class="keyword">new</span> Spacer();
00655         controlsPane.add(spacer1,
00656                 <span class="keyword">new</span> GridConstraints(1, 5, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_HORIZONTAL,
00657                         GridConstraints.SIZEPOLICY_FIXED, 1, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <span class="keyword">new</span> Dimension(30, -1), <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00658         loadSequenceBox = <span class="keyword">new</span> JComboBox();
00659         controlsPane.add(loadSequenceBox,
00660                 <span class="keyword">new</span> GridConstraints(1, 6, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_HORIZONTAL,
00661                         GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00662         loadSequenceLabel = <span class="keyword">new</span> JLabel();
00663         loadSequenceLabel.setText(<span class="stringliteral">"Load Set"</span>);
00664         controlsPane.add(loadSequenceLabel,
00665                 <span class="keyword">new</span> GridConstraints(0, 6, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE,
00666                         GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>));
00667     }
00668 
<a name="l00674"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_my_formatter_factory.html">00674</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_my_formatter_factory.html">MyFormatterFactory</a> <span class="keyword">extends</span> JFormattedTextField.AbstractFormatterFactory {
<a name="l00675"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_my_formatter_factory.html#a0">00675</a>         <span class="keyword">public</span> JFormattedTextField.AbstractFormatter getFormatter(JFormattedTextField tf) {
00676             DecimalFormat format = <span class="keyword">new</span> DecimalFormat();
00677             format.setGroupingUsed(<span class="keyword">false</span>);
00678             format.setMaximumFractionDigits(1);
00679 
00680             NumberFormatter formatter = <span class="keyword">new</span> NumberFormatter(format);
00681             <span class="keywordflow">if</span> (tf == sequenceStepField) {
00682                 formatter.setMinimum(<span class="keyword">new</span> Double(<a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getDegausserMinimumFieldIncrement()));
00683             } <span class="keywordflow">else</span> {
00684                 formatter.setMinimum(<span class="keyword">new</span> Double(0.0));
00685             }
00686             formatter.setMaximum(<span class="keyword">new</span> Double(999.0));
00687             <span class="keywordflow">return</span> formatter;
00688         }
00689     }
00690 
<a name="l00697"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html">00697</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html">SequencePopupMenu</a> <span class="keyword">extends</span> JPopupMenu {
00698 
<a name="l00702"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#r0">00702</a>         <span class="keyword">private</span> MeasurementStep[] steps;
00703 
<a name="l00710"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#a0">00710</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html">SequencePopupMenu</a>(MeasurementStep[] steps) {
00711             <span class="keywordflow">if</span> (steps == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00712                 <span class="keywordflow">throw</span> <span class="keyword">new</span> NullPointerException();
00713             }
00714             <span class="keyword">this</span>.steps = steps;
00715 
00716             add(getInsertBeforeAction());
00717             add(getInsertAfterAction());
00718             add(getDeleteSelectedAction());
00719             add(<span class="keyword">new</span> JSeparator());
00720             add(getSaveSelectedAsAction());
00721             add(getSaveAllAsAction());
00722         }
00723 
00724         <span class="comment">// TODO: Put these same actions to the program's main menu. Each action might then need to find out the selected rows itself and monitor the ListSelectionModel.</span>
00725 
<a name="l00726"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d0">00726</a>         <span class="keyword">private</span> Action getInsertBeforeAction() {
00727             Action action = <span class="keyword">new</span> AbstractAction() {
00728                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00729                     <span class="keywordtype">int</span> index = getFirstIndex();
00730                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; steps.length; i++) {
00731                         getProject().addStep(index, <span class="keyword">new</span> MeasurementStep());
00732                     }
00733                     <span class="comment">// the new steps are get automatically selected, if we just leave the selection untouched</span>
00734                 }
00735             };
00736             action.putValue(Action.NAME, <span class="stringliteral">"Insert Before"</span>);
00737             action.putValue(Action.SHORT_DESCRIPTION,
00738                     <span class="stringliteral">"Inserts the selected number of new steps "</span> +
00739                     <span class="stringliteral">"in front of the selected steps."</span>);
00740             action.putValue(Action.MNEMONIC_KEY, KeyEvent.VK_I);
00741 
00742             <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !getProject().isSequenceEditEnabled()) {
00743                 action.setEnabled(<span class="keyword">false</span>);
00744             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (steps.length == 0 || getFirstIndex() &lt; getProject().getCompletedSteps()) {
00745                 action.setEnabled(<span class="keyword">false</span>);
00746             }
00747             <span class="keywordflow">return</span> action;
00748         }
00749 
<a name="l00750"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d1">00750</a>         <span class="keyword">private</span> Action getInsertAfterAction() {
00751             Action action = <span class="keyword">new</span> AbstractAction() {
00752                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00753                     <span class="keywordtype">int</span> index = getLastIndex() + 1;
00754                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; steps.length; i++) {
00755                         getProject().addStep(index, <span class="keyword">new</span> MeasurementStep());
00756                     }
00757                     sequenceTable.clearSelection();
00758                     sequenceTable.getSelectionModel().addSelectionInterval(index, index + steps.length - 1);
00759                 }
00760             };
00761             action.putValue(Action.NAME, <span class="stringliteral">"Insert After"</span>);
00762             action.putValue(Action.SHORT_DESCRIPTION,
00763                     <span class="stringliteral">"Inserts the selected number of new steps "</span> +
00764                     <span class="stringliteral">"after the selected steps."</span>);
00765             action.putValue(Action.MNEMONIC_KEY, KeyEvent.VK_N);
00766 
00767             <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !getProject().isSequenceEditEnabled()) {
00768                 action.setEnabled(<span class="keyword">false</span>);
00769             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (steps.length == 0 || getLastIndex() &lt; getProject().getCompletedSteps() - 1) {
00770                 action.setEnabled(<span class="keyword">false</span>);
00771             }
00772             <span class="keywordflow">return</span> action;
00773         }
00774 
<a name="l00775"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d2">00775</a>         <span class="keyword">private</span> Action getDeleteSelectedAction() {
00776             Action action = <span class="keyword">new</span> AbstractAction() {
00777                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00778                     <span class="comment">// can not use removeStep(int,int) here because the selection might not be contiguous</span>
00779                     <span class="keywordtype">int</span> index;
00780                     <span class="keywordflow">while</span> ((index = getLastIndex()) &gt;= 0) {
00781                         getProject().removeStep(index);
00782                     }
00783                     sequenceTable.clearSelection();
00784                 }
00785             };
00786             action.putValue(Action.NAME, <span class="stringliteral">"Delete Selected"</span>);
00787             action.putValue(Action.SHORT_DESCRIPTION,
00788                     <span class="stringliteral">"Removes the selected steps from the sequence."</span>);
00789             action.putValue(Action.MNEMONIC_KEY, KeyEvent.VK_D);
00790 
00791             <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || !getProject().isSequenceEditEnabled()) {
00792                 action.setEnabled(<span class="keyword">false</span>);
00793             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (steps.length == 0 || getFirstIndex() &lt; getProject().getCompletedSteps()) {
00794                 action.setEnabled(<span class="keyword">false</span>);
00795             }
00796             <span class="keywordflow">return</span> action;
00797         }
00798 
<a name="l00799"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d3">00799</a>         <span class="keyword">private</span> Action getSaveSelectedAsAction() {
00800             Action action = <span class="keyword">new</span> AbstractAction() {
00801                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00802 
00803                     <span class="comment">// make a copy of the selected steps</span>
00804                     MeasurementSequence sequence = <span class="keyword">new</span> MeasurementSequence();
00805                     <span class="keywordflow">for</span> (MeasurementStep step : steps) {
00806                         MeasurementStep copy = <span class="keyword">new</span> MeasurementStep();
00807                         copy.<a class="code" href="classikayaki_1_1_measurement_step.html#a10">setStepValue</a>(step.getStepValue());
00808                         sequence.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a9">addStep</a>(copy);
00809                     }
00810 
00811                     <span class="comment">// ask for a name for the sequence</span>
00812                     String name = showSequenceNameDialog(<span class="stringliteral">"Enter a name for the sequence"</span>, <span class="stringliteral">"Save Selected As..."</span>);
00813                     <span class="keywordflow">if</span> (name == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00814                         <span class="keywordflow">return</span>;
00815                     }
00816 
00817                     <span class="comment">// save the sequence</span>
00818                     sequence.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a6">setName</a>(name);
00819                     <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.addSequence(sequence);
00820                     resetLoadSequenceBox();
00821                 }
00822             };
00823             action.putValue(Action.NAME, <span class="stringliteral">"Save Selected As..."</span>);
00824             action.putValue(Action.SHORT_DESCRIPTION,
00825                     <span class="stringliteral">"Saves the selected steps as a new preset sequence."</span>);
00826             action.putValue(Action.MNEMONIC_KEY, KeyEvent.VK_S);
00827 
00828             <span class="keywordflow">if</span> (steps.length == 0) {
00829                 action.setEnabled(<span class="keyword">false</span>);
00830             }
00831             <span class="keywordflow">return</span> action;
00832         }
00833 
<a name="l00834"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d4">00834</a>         <span class="keyword">private</span> Action getSaveAllAsAction() {
00835             Action action = <span class="keyword">new</span> AbstractAction() {
00836                 <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00837 
00838                     <span class="comment">// make a copy of all the steps</span>
00839                     MeasurementSequence sequence = getProject().copySequence(0, getProject().getSteps() - 1);
00840 
00841                     <span class="comment">// ask for a name for the sequence</span>
00842                     String name = showSequenceNameDialog(<span class="stringliteral">"Enter a name for the sequence"</span>, <span class="stringliteral">"Save All As..."</span>);
00843                     <span class="keywordflow">if</span> (name == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00844                         <span class="keywordflow">return</span>;
00845                     }
00846 
00847                     <span class="comment">// save the sequence</span>
00848                     sequence.<a class="code" href="classikayaki_1_1_measurement_sequence.html#a6">setName</a>(name);
00849                     <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.addSequence(sequence);
00850                     resetLoadSequenceBox();
00851                 }
00852             };
00853             action.putValue(Action.NAME, <span class="stringliteral">"Save All As..."</span>);
00854             action.putValue(Action.SHORT_DESCRIPTION,
00855                     <span class="stringliteral">"Saves all of the steps as a new preset sequence."</span>);
00856             action.putValue(Action.MNEMONIC_KEY, KeyEvent.VK_A);
00857 
00858             <span class="keywordflow">if</span> (getProject() == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a> || getProject().getSteps() == 0) {
00859                 action.setEnabled(<span class="keyword">false</span>);
00860             }
00861             <span class="keywordflow">return</span> action;
00862         }
00863 
<a name="l00864"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d5">00864</a>         <span class="keyword">private</span> String showSequenceNameDialog(String message, String title) {
00865             String name = <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00866             <span class="keywordtype">boolean</span> ok = <span class="keyword">false</span>;
00867 
00868             <span class="keywordflow">while</span> (!ok) {
00869 
00870                 <span class="comment">// ask for a name for the sequence</span>
00871                 name = (String) JOptionPane.showInputDialog(getParentFrame(),
00872                         message, title, JOptionPane.PLAIN_MESSAGE, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>, name);
00873                 <span class="keywordflow">if</span> (name == <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>) {
00874                     <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00875                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (name.equals(<span class="stringliteral">""</span>)) {
00876                     <span class="keywordflow">continue</span>;
00877                 }
00878 
00879                 <span class="comment">// check for a duplicate name</span>
00880                 ok = <span class="keyword">true</span>;
00881                 MeasurementSequence[] savedSequences = <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.getSequences();
00882                 <span class="keywordflow">for</span> (MeasurementSequence savedSequence : savedSequences) {
00883 
00884                     <span class="keywordflow">if</span> (savedSequence.getName().equals(name)) {
00885 
00886                         <span class="comment">// duplicate name found, ask for how to continue</span>
00887                         <span class="keywordtype">int</span> response = JOptionPane.showConfirmDialog(getParentFrame(),
00888                                 <span class="stringliteral">"Another sequence with the name \""</span> + name + <span class="stringliteral">"\" exists. Do you wish to overwrite it?"</span>,
00889                                 <span class="stringliteral">"Overwrite?"</span>, JOptionPane.YES_NO_CANCEL_OPTION);
00890 
00891                         <span class="keywordflow">if</span> (response == JOptionPane.YES_OPTION) {
00892                             <span class="comment">// overwrite the old sequence</span>
00893                             <a class="code" href="classikayaki_1_1_settings.html">Settings</a>.removeSequence(savedSequence);
00894                             ok = <span class="keyword">true</span>;
00895                             <span class="keywordflow">break</span>;
00896 
00897                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (response == JOptionPane.NO_OPTION) {
00898                             <span class="comment">// ask for a new name</span>
00899                             ok = <span class="keyword">false</span>;
00900                             <span class="keywordflow">break</span>;
00901 
00902                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (response == JOptionPane.CANCEL_OPTION) {
00903                             <span class="comment">// cancel the operation</span>
00904                             <span class="keywordflow">return</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26a2">null</a>;
00905 
00906                         } <span class="keywordflow">else</span> {
00907                             <span class="keywordflow">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="stringliteral">"response = "</span> + response);
00908                         }
00909                     }
00910                 }
00911             }
00912             <span class="keywordflow">return</span> name;
00913         }
00914 
<a name="l00918"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d6">00918</a>         <span class="keyword">private</span> <span class="keywordtype">int</span> getFirstIndex() {
00919             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; getProject().getSteps(); i++) {
00920                 MeasurementStep current = getProject().getStep(i);
00921                 <span class="keywordflow">for</span> (MeasurementStep step : steps) {
00922                     <span class="keywordflow">if</span> (current == step) {
00923                         <span class="keywordflow">return</span> i;
00924                     }
00925                 }
00926             }
00927             <span class="keywordflow">return</span> -1;
00928         }
00929 
<a name="l00933"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_sequence_popup_menu.html#d7">00933</a>         <span class="keyword">private</span> <span class="keywordtype">int</span> getLastIndex() {
00934             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = getProject().getSteps() - 1; i &gt;= 0; i--) {
00935                 MeasurementStep current = getProject().getStep(i);
00936                 <span class="keywordflow">for</span> (MeasurementStep step : steps) {
00937                     <span class="keywordflow">if</span> (current == step) {
00938                         <span class="keywordflow">return</span> i;
00939                     }
00940                 }
00941             }
00942             <span class="keywordflow">return</span> -1;
00943         }
00944     }
00945 
<a name="l00952"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_header_popup_menu.html">00952</a>     <span class="keyword">private</span> <span class="keyword">class </span><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_header_popup_menu.html">HeaderPopupMenu</a> <span class="keyword">extends</span> JPopupMenu {
00953 
<a name="l00954"></a><a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_header_popup_menu.html#a0">00954</a>         <span class="keyword">public</span> <a class="code" href="classikayaki_1_1gui_1_1_measurement_sequence_panel_1_1_header_popup_menu.html">HeaderPopupMenu</a>() {
00955             JMenuItem header = <span class="keyword">new</span> JMenuItem(<span class="stringliteral">"Visible Columns"</span>);
00956             header.setFont(header.getFont().deriveFont(Font.BOLD));
00957             header.setEnabled(<span class="keyword">false</span>);
00958             add(header);
00959 
00960             <a class="code" href="namespaceikayaki_1_1gui.html#a26">SequenceColumn</a>[] columns = sequenceTableModel.getPossibleColumns();
00961             <span class="keywordflow">for</span> (<span class="keyword">final</span> <a class="code" href="namespaceikayaki_1_1gui.html#a26">SequenceColumn</a> column : columns) {
00962 
00963                 <span class="comment">// add all of the columns to the menu as checkboxes</span>
00964                 <span class="keyword">final</span> JCheckBox checkBox = <span class="keyword">new</span> JCheckBox(column.getColumnName(getProject()));
00965                 checkBox.addActionListener(<span class="keyword">new</span> ActionListener() {
00966                     <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
00967                         sequenceTableModel.setColumnVisible(column, checkBox.isSelected());
00968                     }
00969                 });
00970                 checkBox.setSelected(sequenceTableModel.isColumnVisible(column));
00971                 checkBox.setToolTipText(column.getToolTipText(getProject()));
00972                 add(checkBox);
00973             }
00974         }
00975     }
00976 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed May 4 13:11:04 2005 for Squid by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
