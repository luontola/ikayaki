% est‰mme ihme "underfull \hbox (badness 10000)" -varoitukset (ei hajua mist‰ tulevat)
\hbadness=10000

% makrot dokumentoinnin generoimiseksi
\input{docmacro}

% nopsa pikkuluokkakaavioiden lis‰ysmakro
% pois figuren sis‰lt‰ niin kuvat tulee minne pit‰‰kin, ilman kuvateksti‰ ja kuvanumerointia tosin
\newcommand{\insertdia}[1] {
	% \begin{figure}[h]
	\begin{center}
	\includegraphics[scale=0.33]{dia/#1.eps}
	% \includegraphics[width=#2]{dia/#1.eps}
	% \caption{#3}
	% \label{fig:#1}
	\end{center}
	% \end{figure}
}

\section{Introduction}
\label{sec:intro}

This document describes planned architecture for the SQUID magnetometer program that will be implemented as a software engineering student project at University of Helsinki, Department of Computer Science. The clients are Lauri Pesonen with his assistants Fabio Donadini and Tomas Kohout from Department of Geophysics.

The document serves as an internal guide to the project team for aiding implementation phase, and describes the software at about level of accuracy which allows to implement the software based on this document and requirements document (version 1.1), which has user interface prototypes as appendices, and on which this document is based.

\subsection{Structure of the document}

\par Section~\ref{sec:intro} (this section) describes the meaning and structure of the document.
\par Section~\ref{sec:code} describes coding conventions used by the project group in this sowtware.
\par Section~\ref{sec:over} describes the software and architecture at high abstarction.
\par Section~\ref{sec:arch} describes planned architecture at lower abstarction, including class diagrams and a short description of each subsystem.
\par Section~\ref{sec:data} describes planned data classes.
\par Section~\ref{sec:gui} describes planned gui classes.


\section{Code conventions}
\label{sec:code}

Everybody will follow the Code Conventions for the Java Programming Language set by Sun, with the following refinements.

\begin{itemize}
\item Line length will be set to 120 characters, because we prefer coding in high resolutions.
\item If possible, set your IDE to use spaces instead of tabs (to avoid problems if somebody has set tab to 4 spaces, although it should be 8). Indentation is 4 spaces, as set by Sun.
\item Every method and non-trivial field must have Javadoc comments. Every parameter, return value and exception of methods must be mentioned (except for trivial getters and setters).
\item Every if, for and while loop must use braces \texttt{\{\}}, even when there will be only one statement in the block, as set by Sun.
\item The @author comment for every class should have the name of the person who wrote (and designed) the class. Then we will know who to ask, if there are some questions about the code.
\item Every source file is subject to automatic code reformatting by a Java IDE, in which case the reformatter must follow these code conventions.
\item TODO-comments should be set by the programmer, if there is some part that needs more work. The format is \texttt{"// TODO: comments"}
\end{itemize}

The Code Conventions are available at \\
\texttt{http://java.sun.com/docs/codeconv/}

This program will be written with Java 1.5. Every programmer should have a look at the new features that were introduced to the Java language. Especially noteworthy are Generics, Foreach-loop and Enums. The following article will explain them in a nutshell. \\
\texttt{http://java.sun.com/developer/technicalArticles/releases/j2se15/}

It is recommendable for everybody to have a quick glance at Design Patterns. Here are some useful links. \\
\texttt{http://sern.ucalgary.ca/courses/SENG/609.04/W98/notes/} \\
\texttt{http://www.dofactory.com/Patterns/Patterns.aspx}


\section{Overview of the system}
\label{sec:over}

This system has two different separete project, Ikayaki-program and Squid Emulator which is subproject. Ikayaki, as main project, has graphical user interface (see requirements-document) and interface for communicating with SQUID magnetometer (Superconducting Quantum Interference Device) to measusure magnetization of minerals and rocks. Squid Emulator is vital for testing Ikayaki and it will be simple command-line program which emulates only data flow with random data and communication.

Software is split in two main parts in this document. Data section includes files needed for project-management, data flow in software and interface to control SQUID-system. There is also Settings for whole system and a subproject squid emulator. User Interface section documents all graphical interface classes, nothing more. There will be no graphical user interface for squid emulator.


\section{Architecture description}
\label{sec:arch}

Here we describe each subsystem shortly, and present a class diagram of each, as well as the whole system divided roughly into data and gui parts.

Note that the structure of this section is exactly the same as sections \ref{sec:data}-\ref{sec:gui}, but with only first two sectioning levels.


\subsection{Data classes and methods}

\begin{figure}
\begin{center}
\hspace{-1cm}\includegraphics[width=17cm]{dia/core.eps}
\caption{Squid class diagram: data classes}
\label{fig:core}
\end{center}
\end{figure}

Class diagram of data classes is in Figure~\ref{fig:core}.

Data classes are in packages ikayaki, ikayaki.squid and ikayaki.util.

Package ikayaki holds generic data classes, ikayaki.squid holds classes loosely related to the squid interface, and ikayaki.util has utilities (\ref{sec:utilities}).

\subsubsection{Project data}

Responsible for holding all the measurement data and controlling the SQUID. Most of the GUI classes use the Project class. When the state of the project changes, the Project class fires ProjectEvents and MeasurementEvents to the GUI classes, which in turn will call the Project class to get the changed information.

\subsubsection{Squid interface}
\insertdia{core-squid}

Squid Interface offers the Project class an interface to safely control the SQUID magnetometer. It holds three subclasses that handle communication to to three separate parts of the SQUID (Handler, Degausser and Magnetometer).

Classes are Squid, Handler, Magnetometer, Degausser.

\subsubsection{Squid emulator}
\insertdia{core-squidemu}

This is separate from other and is used only for testing the Squid Interface that it works correctly.

\subsubsection{Serial communication}
\insertdia{core-serial}

SerialIO and classes related to it takes care of the harware layer of serial communication. Using these classes Ikayaki communicates with the Degausser, Samplehandler and Magnetometer. SerialIO represents one serial port and when it's created it reserves the port to itself. SerialProperties class includes all the configuration data for the serial port.

\subsubsection{Global settings}

Global properties that are used all around the program. The Settings class provides a global point for retrieving and modifying the properties.

\subsubsection{Utilities}
\label{sec:utilities}

Miscellaneous classes that are used nowhere in particular.


\subsection{GUI classes and methods}

\begin{figure}
\begin{center}
\includegraphics[angle=90,width=12cm]{dia/gui.eps}
\caption{Squid class diagram: GUI classes}
\label{fig:gui}
\end{center}
\end{figure}

Class diagram of gui classes is in Figure~\ref{fig:gui}. This section is divided into sections by gui components, each of which has one or more classes.

All gui classes are in package ikayaki.gui.

\subsubsection{Generic GUI components}

ProjectComponent, a generic gui base class which handles registering Project- and MeasurementListeners to new projects, and which every gui component subclasses.

\subsubsection{Main window}
\insertdia{gui-main}

\subsubsection{Configuration window}

\subsubsection{Project Explorer}
\insertdia{gui-explorer}

Located at middle left side of main window.

ProjectExplorerPanel handles loading existing projects and creating new ones. Shows a listing of project files in current directory, which can be changed by typing new directory into ComboBox text field, or using the browse-button and standars dir chooser dialog. ComboBox also holds directory history, and, when typing text into it's text field, automatically shows autocomplete results.

NewProjectPanel has components for creating a new project.

ProjectExplorerTable is a JTable with the project file listing, including "filename", "type" and "last modified" columns.

ProjectExplorerPopupMenu has options for exporting project files into different formats.

\subsubsection{Calibration}
\insertdia{gui-calibration}

Located at upper left corner of main window.

CalibrationPanel holds predefined "Holder noise" and "Standard sample" projects for calibration in a similar table as Project Explorer. Also has a "Calibrate" button, which executes selected calibration project, similarly to clicking "Single step" in normal projects.

\subsubsection{Project information}

\subsubsection{Sequence and measurement data}

\subsubsection{Measurement details}

\subsubsection{Measurement controls}
\insertdia{gui-mcontrols}

Located at upper right corner of main window.

MeasurementControlsPanel holds the buttons for controlling measurements, a help picture for sample inserting, radiobuttons for changing +z/-z orientation of sample, magnetometer status picture and manual controlling components.

MagnetometerStatusPanel shows an image of current magnetometer status, as in sample holder position and rotation. Image is updated according to MeasurementEvents received.

ManualControlsPanel has controls for fully manual measuring, which are enabled when no "normal" measurements are happening.

\subsubsection{Graphs}
\insertdia{gui-graphs}

Graph panels visualize the measurement data. They are located at the lower right corner in the UI. MeasurementGraphsPanel listens to MeasurementEvents to update the measurement data in plots. AbstractPlot is an abstract class which implements all the general features of graph plots. IntensityPlot and StereoPlot extend the functionality of AbstractPlot and implement their special drawing features accordingly.


\section{Data classes and methods}
\label{sec:data}

\subsection{Project data}
\input{core-project}

\subsection{Squid interface}
\input{core-squid}

\subsection{Squid emulator}
\input{core-squidemu}

\subsection{Serial communication}
\input{core-serial}

\subsection{Global settings}
\input{core-settings}

\subsection{Utilities}
\input{core-util}


\section{GUI classes and methods}
\label{sec:gui}

\subsection{Generic GUI components}
\input{gui-generic}

\subsection{Main window}
\input{gui-main}
\input{gui-menubar}
\input{gui-statusbar}

\subsection{Configuration window}
\input{gui-configuration}

\subsection{Project Explorer}
\input{gui-explorer}

\subsection{Calibration}
\input{gui-calibration}

\subsection{Project information}
\input{gui-projectinfo}

\subsection{Sequence and measurement data}
\input{gui-sequence}

\subsection{Measurement details}
\input{gui-mdetails}

\subsection{Measurement controls}
\input{gui-mcontrols}

\subsection{Graphs}
\input{gui-graphs}
