% est‰mme ihme "underfull \hbox (badness 10000)" -varoitukset (ei hajua mist‰ tulevat)
\hbadness=10000

% nopsa pikkuluokkakaavioiden lis‰ysmakro
% pois figuren sis‰lt‰ niin kuvat tulee minne pit‰‰kin, feikataan kuvanumerointi ja kuvateksti
\newcommand{\insertdia}[1] {
	% \begin{figure}[h!]
	\begin{center}
	\includegraphics[scale=0.33]{dia/#1.eps}
	% \caption{#1}
	\refstepcounter{figure}
	\label{fig:#1}
	\nopagebreak \\ \medskip Figure \arabic{figure}: #1 \\
	\addcontentsline{lof}{figure}{#1}
	\end{center}
	% \end{figure}
}

\section{Introduction}
\label{sec:intro}

Blablabla balalaalllblaaaaaaa aaaaarrggrgghh.


\section{Overview of changes from Design document}
\label{sec:overview}

The big picture.


\section{Specific changes from Design document}
\label{sec:changes}

Here we describe how the implementation/production differs from that planned in Design document.


\subsection{Data classes and methods}

Class diagram of data classes is in Figure~\ref{fig:core}.

\subsubsection{Project data}

\insertdia{project_graph}.

Responsible for holding all the measurement data and controlling the SQUID. Most of the GUI classes use the Project class. When the state of the project changes, the Project class fires ProjectEvents and MeasurementEvents to the GUI classes, which in turn will call the Project class to get the changed information.

\subsubsection{Squid interface}

Squid Interface offers the Project class an interface to safely control the SQUID magnetometer. The Squid class holds three classes that handle communication to to three separate parts of the SQUID (Handler, Degausser and Magnetometer).

Classes are Squid, Handler, Magnetometer, Degausser.

\subsubsection{Squid emulator}

Squid Emulator is separate from the rest of the program and it is used only for testing that the Squid Interface works correctly. Biggest change was that this wasnt developed much and its not working as planned. Mainly was used to test that commands are sended correctly and Squid Interface gets answers.

\subsubsection{Serial communication}

SerialIO and classes related to it takes care of the harware layer of serial communication. Using these classes the program communicates with the Degausser, Samplehandler and Magnetometer. SerialIO represents one serial port and when it's created it reserves the port to itself. SerialProperties class includes all the configuration data for the serial port.

\subsubsection{Global settings}

Global properties that are used all around the program. The Settings class provides a global point for retrieving and modifying the properties.

\subsubsection{Utilities}

Utility classes that are used in the program, but do not fit any of the other packages. At the moment includes only the LastExecutor class for thread management, but more classes can be added as necessary.


\subsection{GUI classes and methods}

Class diagram of gui classes is in Figure~\ref{fig:gui}. This section is divided into sections by gui components, each of which has one or more classes.

\subsubsection{Generic GUI components}

ProjectComponent, a generic gui base class which handles registering Project- and MeasurementListeners to new projects, and which every project-dependant gui component subclasses. See Figure~\ref{fig:gui}.

\subsubsection{Main window}

\insertdia{main_view_panel_graph}

Creates main view for GUI. Menubar at top, Statusbar at bottom and makes panels and splitpanels for other GUI components to middle. This also tells other GUI components if someone changes project file.

\subsubsection{Configuration window}

Separate window which is opened from menubar and it updates settings for Squid interface. Used usually only when system is installed to setup it.

\subsubsection{Project Explorer}

Nothing much here; some internal private field renames. Oh and a lot more stuff than planning suggests :)

ProjectExplorerTable is now its own class (as Calibration uses it too), and ProjectExplorerPopupMenu is its inner class. Also has inner class ProjectExplorerTableModel, which, unlike normally (as in the standard way), is quite empty and most of the stuff is in ProjectExplorerTable. Uses StyledWrapper for table row background colors (and Calibration boldface-reminder).

NewProjectPanel is inner class of ProjectExplorerPanel.

\subsubsection{Calibration}

Uses ProjectExplorerTable, which makes Calibration.java really short.

\subsubsection{Project information}

Located at lower left corner of main window.

Contains and allows editing of basic information of sample. Includes
such fields as volume, strike and dip, which are used to make
calculations. Includes also fields whose information is only for users
benefit.

\subsubsection{Sequence and measurement data}

Located at center of main window.

Contains and allows editing of measurement sequence. Whenever
measurement step is finished its data is added here. This data is also
recalculated whenever some field affecting it in project infromation is
changed.

\subsubsection{Measurement details}

Located at middle bottom of main window.

Contains details of ongoing measurement or of row selected in measrurement
sequence. If details of ongoing measurement is shown, they are updated
whenever new measurement data is received and when measurement step is
finished next steps details are shown.

\subsubsection{Measurement controls}

Sadly, ManualControlsPanel had to go into MagnetometerStatusPanel as an inner class, since they share some data and move-radiobuttons.

MagnetometerStatusPanel's updateStatus takes no parameters, as it asks position and rotation directly from Handler. Also, status image is updated at all times once in 50 ms (positions asked with getEstimatedPosition and getEstimatedRotation in Handler).

Here too, a lot more stuff than what planning imply.

ManualControlsPanel's manual control components are disabled whenever there's \textit{any} Squid action, to keep those fragile equipments from messing up.

\subsubsection{Graphs}

Located at lower right corner of main window.

Graph panels visualize the measurement data. MeasurementGraphsPanel listens to MeasurementEvents to update the measurement data in plots. AbstractPlot is an abstract class which implements all the general features of graph plots. IntensityPlot and StereoPlot extend the functionality of AbstractPlot and implement their special drawing features accordingly.


\section{TODO-list from source code}
\label{sec:todo}

\input{todolist}


\section{Improvement suggestions}
\label{sec:improv}

What's left for the program to make it perfect :)

\subsection{...}

\subsection{Porting to linux}
